[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15014385","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15014385","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15014385,"user":{"login":"tanghus","id":533222,"avatar_url":"https://gravatar.com/avatar/e625b634822713b2e346ff7c67d26775?d=https%3a%2f%2fidenticons.github.com%2f6d9c90af1c12f5a88e4d5f216bbc1979.png&r=x","gravatar_id":"e625b634822713b2e346ff7c67d26775","url":"https://api.github.com/users/tanghus","html_url":"https://github.com/tanghus","followers_url":"https://api.github.com/users/tanghus/followers","following_url":"https://api.github.com/users/tanghus/following{/other_user}","gists_url":"https://api.github.com/users/tanghus/gists{/gist_id}","starred_url":"https://api.github.com/users/tanghus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tanghus/subscriptions","organizations_url":"https://api.github.com/users/tanghus/orgs","repos_url":"https://api.github.com/users/tanghus/repos","events_url":"https://api.github.com/users/tanghus/events{/privacy}","received_events_url":"https://api.github.com/users/tanghus/received_events","type":"user","site_admin":false},"created_at":"2013-03-16t23:50:03z","updated_at":"2013-03-16t23:50:03z","body":"isn't current user lost when the session is closed, and isn't that needed for finding the right principals?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15014479","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15014479","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15014479,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2013-03-16t23:58:31z","updated_at":"2013-03-16t23:58:31z","body":"afaik, the $_session variable is still writable, it just won't be saved back into the session file.\r\n\r\nnot maintaining the session between webdav requests shouldn't have any effect since webdav client don't keep the session id anyway"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15015410","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15015410","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15015410,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t01:23:38z","updated_at":"2013-03-17t01:23:48z","body":"a litmus test run will tell us if anything is broken with webdav ...."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15019232","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15019232","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15019232,"user":{"login":"flemaitr","id":3882276,"avatar_url":"https://gravatar.com/avatar/4ddcc701d9176359f059d3df64d9cebb?d=https%3a%2f%2fidenticons.github.com%2f74ede93aa511b5a4e5abc39fcaff6ec6.png&r=x","gravatar_id":"4ddcc701d9176359f059d3df64d9cebb","url":"https://api.github.com/users/flemaitr","html_url":"https://github.com/flemaitr","followers_url":"https://api.github.com/users/flemaitr/followers","following_url":"https://api.github.com/users/flemaitr/following{/other_user}","gists_url":"https://api.github.com/users/flemaitr/gists{/gist_id}","starred_url":"https://api.github.com/users/flemaitr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flemaitr/subscriptions","organizations_url":"https://api.github.com/users/flemaitr/orgs","repos_url":"https://api.github.com/users/flemaitr/repos","events_url":"https://api.github.com/users/flemaitr/events{/privacy}","received_events_url":"https://api.github.com/users/flemaitr/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t08:29:50z","updated_at":"2013-03-17t08:53:03z","body":"as @icewind1991 says session_write_close(); does not close the session, it just makes the $_session variables not written on the server filesystem anymore. and you can always make them writable again with session_start();, cf my latest comment on #2372 and the first user comment on http://php.net/manual/en/function.session-start.php"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15019510","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15019510","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15019510,"user":{"login":"tanghus","id":533222,"avatar_url":"https://gravatar.com/avatar/e625b634822713b2e346ff7c67d26775?d=https%3a%2f%2fidenticons.github.com%2f6d9c90af1c12f5a88e4d5f216bbc1979.png&r=x","gravatar_id":"e625b634822713b2e346ff7c67d26775","url":"https://api.github.com/users/tanghus","html_url":"https://github.com/tanghus","followers_url":"https://api.github.com/users/tanghus/followers","following_url":"https://api.github.com/users/tanghus/following{/other_user}","gists_url":"https://api.github.com/users/tanghus/gists{/gist_id}","starred_url":"https://api.github.com/users/tanghus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tanghus/subscriptions","organizations_url":"https://api.github.com/users/tanghus/orgs","repos_url":"https://api.github.com/users/tanghus/repos","events_url":"https://api.github.com/users/tanghus/events{/privacy}","received_events_url":"https://api.github.com/users/tanghus/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t09:01:30z","updated_at":"2013-03-17t09:01:30z","body":"in theory this sounds like an excellent idea, but has it been tested? there was another thread where doing a session_write_close() was *not* that good once tested."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15019524","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15019524","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15019524,"user":{"login":"dragotin","id":1070214,"avatar_url":"https://gravatar.com/avatar/af829234b31fb915704c1c65ef48eee0?d=https%3a%2f%2fidenticons.github.com%2f3392afab7f424e10623ba95a941f4d34.png&r=x","gravatar_id":"af829234b31fb915704c1c65ef48eee0","url":"https://api.github.com/users/dragotin","html_url":"https://github.com/dragotin","followers_url":"https://api.github.com/users/dragotin/followers","following_url":"https://api.github.com/users/dragotin/following{/other_user}","gists_url":"https://api.github.com/users/dragotin/gists{/gist_id}","starred_url":"https://api.github.com/users/dragotin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dragotin/subscriptions","organizations_url":"https://api.github.com/users/dragotin/orgs","repos_url":"https://api.github.com/users/dragotin/repos","events_url":"https://api.github.com/users/dragotin/events{/privacy}","received_events_url":"https://api.github.com/users/dragotin/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t09:02:42z","updated_at":"2013-03-17t09:02:42z","body":"hmm, i was implementing session handling in the client a couple of month ago because the common opinion was that maintaining a valid session speeds up traffic. i think the client can live without, but why does that make sense?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15019951","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15019951","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15019951,"user":{"login":"flemaitr","id":3882276,"avatar_url":"https://gravatar.com/avatar/4ddcc701d9176359f059d3df64d9cebb?d=https%3a%2f%2fidenticons.github.com%2f74ede93aa511b5a4e5abc39fcaff6ec6.png&r=x","gravatar_id":"4ddcc701d9176359f059d3df64d9cebb","url":"https://api.github.com/users/flemaitr","html_url":"https://github.com/flemaitr","followers_url":"https://api.github.com/users/flemaitr/followers","following_url":"https://api.github.com/users/flemaitr/following{/other_user}","gists_url":"https://api.github.com/users/flemaitr/gists{/gist_id}","starred_url":"https://api.github.com/users/flemaitr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flemaitr/subscriptions","organizations_url":"https://api.github.com/users/flemaitr/orgs","repos_url":"https://api.github.com/users/flemaitr/repos","events_url":"https://api.github.com/users/flemaitr/events{/privacy}","received_events_url":"https://api.github.com/users/flemaitr/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t09:45:57z","updated_at":"2013-03-17t09:45:57z","body":"@tanghus on my installation it works well, i just added three lines in base.php as described in #2372."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15021531","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15021531","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15021531,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t11:59:56z","updated_at":"2013-03-17t11:59:56z","body":"as i understand this the session is no destroyed. so this means that the desktop client still has a valid session. this is important so that we don't have to contact authentication servers for every single webdav request.\r\nso sounds like a good idea but needs proper testing from the clients."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15022479","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15022479","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15022479,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t13:14:09z","updated_at":"2013-03-17t13:14:09z","body":"if the sync client uses/will use sessions then this should not be merged and instead do something like @flemaitr described"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15023360","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15023360","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15023360,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t14:17:44z","updated_at":"2013-03-17t14:17:44z","body":"we could also create a custom session handler using either the database or xcache/apc/memcache to solve the issue once and for all."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15025715","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15025715","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15025715,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t16:32:33z","updated_at":"2013-03-17t16:32:33z","body":"@icewind1991 a custom session handler is a good idea."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15029404","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15029404","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15029404,"user":{"login":"ewildgoose","id":13366,"avatar_url":"https://gravatar.com/avatar/3229eee09659ae30fe728c1759cc5d53?d=https%3a%2f%2fidenticons.github.com%2f4643dd49216b67d9c617ceb260e45684.png&r=x","gravatar_id":"3229eee09659ae30fe728c1759cc5d53","url":"https://api.github.com/users/ewildgoose","html_url":"https://github.com/ewildgoose","followers_url":"https://api.github.com/users/ewildgoose/followers","following_url":"https://api.github.com/users/ewildgoose/following{/other_user}","gists_url":"https://api.github.com/users/ewildgoose/gists{/gist_id}","starred_url":"https://api.github.com/users/ewildgoose/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ewildgoose/subscriptions","organizations_url":"https://api.github.com/users/ewildgoose/orgs","repos_url":"https://api.github.com/users/ewildgoose/repos","events_url":"https://api.github.com/users/ewildgoose/events{/privacy}","received_events_url":"https://api.github.com/users/ewildgoose/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t19:50:22z","updated_at":"2013-03-17t19:50:22z","body":"i'm just working on a cookie based custom session handler.  for that i *need* all code paths to close the session before the html body is generated.  so far i only found 3 places i needed to do this though (so not too large a patch)\r\n\r\nis there a reason that the session is closed in the particular spot? you really want to close it both as early as is sensible, but not too early that you might still want to write to it? \r\n\r\ni presume any delay that is noticed is because sessions are locked when opened and concurrent requests operating on a session are blocked.  db/memcache sessions aren't usually much of a solution because either you have locking still or you turn off locking and the various sessions trample each other when written... the solution is still to reduce the amount of time a session is locked\r\n\r\nso, i'm working on putting the sessions into the cookie. this has some advantages and disadvantages. i guess i need to create a new issue to discuss.  however, it is potentially nearly as fast as memcache, whilst implicitly supports multi-server cluster without any further complexity. disadvantage is that you need to be careful about replay attacks and you have no way to force expiry of a session in the face of a hostile user (although obviously you can put timeouts into the session cookie)\r\n\r\ni think the most useful thing would be to find the change which triggers the slowdown?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15029540","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15029540","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15029540,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-03-17t19:57:51z","updated_at":"2013-03-17t19:57:51z","body":"@ewildgoose not sure what you mean with a cookie based session handler. the default php one that we use is cookie based with storing the session variables in the session file on the server.\r\ncan you please explain what you want to do differently?\r\nstoring session variable itself in the cookie is not an option because of security reasons.\r\nwe use output buffering by the way. so you can set cookies anytime."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/15045426","html_url":"https://github.com/owncloud/core/pull/2386#issuecomment-15045426","issue_url":"https://api.github.com/repos/owncloud/core/issues/2386","id":15045426,"user":{"login":"ewildgoose","id":13366,"avatar_url":"https://gravatar.com/avatar/3229eee09659ae30fe728c1759cc5d53?d=https%3a%2f%2fidenticons.github.com%2f4643dd49216b67d9c617ceb260e45684.png&r=x","gravatar_id":"3229eee09659ae30fe728c1759cc5d53","url":"https://api.github.com/users/ewildgoose","html_url":"https://github.com/ewildgoose","followers_url":"https://api.github.com/users/ewildgoose/followers","following_url":"https://api.github.com/users/ewildgoose/following{/other_user}","gists_url":"https://api.github.com/users/ewildgoose/gists{/gist_id}","starred_url":"https://api.github.com/users/ewildgoose/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ewildgoose/subscriptions","organizations_url":"https://api.github.com/users/ewildgoose/orgs","repos_url":"https://api.github.com/users/ewildgoose/repos","events_url":"https://api.github.com/users/ewildgoose/events{/privacy}","received_events_url":"https://api.github.com/users/ewildgoose/received_events","type":"user","site_admin":false},"created_at":"2013-03-18t09:28:11z","updated_at":"2013-03-18t09:28:11z","body":"cookie based sessions mean approximately that you store the session data \n*in* the cookie.  it's an excellent solution to the problem of session \nstorage and very fast, but it does have some disadvantages (which i will \nreview quickly below because i sense you are about to claim some which \naren't really a problem?)\n\nfirstly you hmac your session contents so that people can't fake their \nsession contents.  optionally you will also encrypt the session contents \nso that the user can't see them - some people feel encryption is \noptional because they only access the site over ssl and the session \ncontents are therefore only visible to that user - however, its a \ncontroversial topic so lets assume we encrypt them.\n\na well thought draft rfc is here:\nhttps://tools.ietf.org/html/draft-secure-cookie-session-protocol-02\n\nrails is an example user of such a session storage protocol, but there \nare other php examples such as the lithium framework and codeignitor.\n\nthe weaknesses are mainly:\n- max storage is circa 4k (this seems not to be a problem based on \nempirical observation of ownclouds session requirements)\n- session replay. you have no way to *force* expiry of a given session \nvariable. a malicious user could save their cookie and send it back to \nyou later. although this looks terrible on the surface, it's largely a \nmanageable situation, and why it's mandatory to have an expiry baked \ninto the session hmac. in practice it mainly means don't store say \n\"account balances\" in the session, or \"prices\" or other information that \nshouldn't be represented. the biggest practical limitation would be \nsomeone trying to misuse the \"am i logged in\" information, but \nappropriately short session timeouts seem to mitigate this\n\n\nthe benefits are:\n- don't need server side storage\n- very fast (no io required)\n- no problems implementing a cluster of owncloud servers, state is \nmagically replicated amongst them without needing shared memcached, etc\n\n\nhowever, i observe that output buffering isn't implemented in all areas \nfor example, so i do need to explicitly close the session in some \nplaces. i will post a working patch under a new bug report and we can \nfiddle there."}]