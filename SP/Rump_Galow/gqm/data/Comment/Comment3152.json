[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/17132174","html_url":"https://github.com/owncloud/core/pull/3152#issuecomment-17132174","issue_url":"https://api.github.com/repos/owncloud/core/issues/3152","id":17132174,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-04-28t10:52:11z","updated_at":"2013-04-28t10:52:11z","body":"@icewind1991 "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/17294973","html_url":"https://github.com/owncloud/core/pull/3152#issuecomment-17294973","issue_url":"https://api.github.com/repos/owncloud/core/issues/3152","id":17294973,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2013-05-01t17:49:12z","updated_at":"2013-05-01t17:49:12z","body":"hmmm - the issue should not be related to the mapper class.\r\ni'll dig into this asap.\r\nplease extend the unit tests as well where a folder contains a dot - thx"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/17311592","html_url":"https://github.com/owncloud/core/pull/3152#issuecomment-17311592","issue_url":"https://api.github.com/repos/owncloud/core/issues/3152","id":17311592,"user":{"login":"infoneo","id":4140590,"avatar_url":"https://gravatar.com/avatar/bc0a26326f8748680a48ed4ccc64a15b?d=https%3a%2f%2fidenticons.github.com%2ffbb06d5e5e769ae263f1c887fd5eadff.png&r=x","gravatar_id":"bc0a26326f8748680a48ed4ccc64a15b","url":"https://api.github.com/users/infoneo","html_url":"https://github.com/infoneo","followers_url":"https://api.github.com/users/infoneo/followers","following_url":"https://api.github.com/users/infoneo/following{/other_user}","gists_url":"https://api.github.com/users/infoneo/gists{/gist_id}","starred_url":"https://api.github.com/users/infoneo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/infoneo/subscriptions","organizations_url":"https://api.github.com/users/infoneo/orgs","repos_url":"https://api.github.com/users/infoneo/repos","events_url":"https://api.github.com/users/infoneo/events{/privacy}","received_events_url":"https://api.github.com/users/infoneo/received_events","type":"user","site_admin":false},"created_at":"2013-05-01t22:55:54z","updated_at":"2013-05-01t22:55:54z","body":"i will try to explain step by step. i suppose that issue is platform independent.\r\n\r\n1. when the directory with a dot within the name is created function logictophysical is executed.\r\n\r\n2. then resolvelogicpath($logicpath) is executed //no matter\r\n\r\n3. then \"create($logicpath, $create)\" is executed\r\n\r\n4. then inside \"create\" we have striplast($logicpath) //no matter\r\n\r\n6.  then inside \"create\" slugifypath($logicpath) is executed\r\n\r\n7. the problem starts inside slugifypath($logicpath) function:\r\n\r\n$path = $this->striprootfolder($path, $this->unchangedphysicalroot); //ok\r\n$pathelements = explode('/', $path); //ok\r\n$sluggedelements = array(); //ok\r\n\r\n// rip off the extension ext from last element //not ok\r\n$last= end($pathelements); //not ok\r\n$parts = pathinfo($last); //not ok - we try to pass wrong argument to the pathinfo() function.\r\n$filename = $parts['filename']; // not ok - we have got as result wrong foldername - pathinfo() thought, that we have given filename+extension as input and resulted just left part of foldername.\r\n\r\nforeach function\r\n[..... slugify($pathelement) .... ]\r\n\r\n// add back the extension\r\nif (isset($parts['extension'])) {\r\n$last= array_pop($sluggedelements);\r\narray_push($sluggedelements, $last.'.'.$parts['extension']); //not ok directory with a dot isn't a file\r\n}\r\n\r\nfolder with dot is recognized as file with the extension. the part of foldername before dot is \"cleaned\" by the \"slugify\" function and put back adding fake \"extension\" with the format \"leftpart.rightpart\".\r\n\r\nsuch foldername (\"leftpart.rightpart\") is created on the disk and added to the database...\r\n\r\nnext what happens when we try to create a file for example \"test.txt\" within \"leftpart.rightpart\" folder:\r\n\r\nthe same steps as above mentioned are done, but...\r\n\r\ninside slugifypath we have foreach loop:\r\n\r\ninside foreach loop we have \"$sluggedelements[] = self::slugify($pathelement);\"\r\n\r\none of the parameters passed to the slugifiy inside the loop is a part of the path - \"leftpart.rightpart\"\r\nslugify changes it to \"leftpart_rightpart\"\r\n\r\nthen the full filename is \"leftpart_rightpart/test.txt\"\r\n\r\nof course such filename couldn't be created (especially on windows), because leftpart_rightpart doesn't exit.\r\n\r\ni think, that during folder creation (no matter via webdav or webapi) it should be recognized, that folder isn't file and shouldn't be spitted (and putted back) as \"filename+dot+extension\" but should be \"slugified\" as full foldername. - during creation real foldername shoud be \"leftpart_rightpart\".\r\n\r\nalternative solution could be done in the slugify() function. i think the dots could be accepted generally (there is no need to change to underline). for security reasons only \"/../\" or \"/./\" should be checked and removed.\r\n\r\nregards,\r\ninfoneo"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/17515186","html_url":"https://github.com/owncloud/core/pull/3152#issuecomment-17515186","issue_url":"https://api.github.com/repos/owncloud/core/issues/3152","id":17515186,"user":{"login":"mtgap","id":1097106,"avatar_url":"https://gravatar.com/avatar/454a73ee5feeb428d0c163a48903332c?d=https%3a%2f%2fidenticons.github.com%2f52d29a66f285a1d61125dd69ac0766b2.png&r=x","gravatar_id":"454a73ee5feeb428d0c163a48903332c","url":"https://api.github.com/users/mtgap","html_url":"https://github.com/mtgap","followers_url":"https://api.github.com/users/mtgap/followers","following_url":"https://api.github.com/users/mtgap/following{/other_user}","gists_url":"https://api.github.com/users/mtgap/gists{/gist_id}","starred_url":"https://api.github.com/users/mtgap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtgap/subscriptions","organizations_url":"https://api.github.com/users/mtgap/orgs","repos_url":"https://api.github.com/users/mtgap/repos","events_url":"https://api.github.com/users/mtgap/events{/privacy}","received_events_url":"https://api.github.com/users/mtgap/received_events","type":"user","site_admin":false},"created_at":"2013-05-06t23:44:50z","updated_at":"2013-05-06t23:44:50z","body":"@infoneo could you fix the indentation and add the unit tests as @deepdiver1975 requested?\r\n\r\n#2875 "}]