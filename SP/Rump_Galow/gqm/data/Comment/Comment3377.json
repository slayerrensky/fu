[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/18020678","html_url":"https://github.com/owncloud/core/issues/3377#issuecomment-18020678","issue_url":"https://api.github.com/repos/owncloud/core/issues/3377","id":18020678,"user":{"login":"landkeks","id":877258,"avatar_url":"https://identicons.github.com/3f6dd950678a8bcdd0077eab31629f32.png","gravatar_id":null,"url":"https://api.github.com/users/landkeks","html_url":"https://github.com/landkeks","followers_url":"https://api.github.com/users/landkeks/followers","following_url":"https://api.github.com/users/landkeks/following{/other_user}","gists_url":"https://api.github.com/users/landkeks/gists{/gist_id}","starred_url":"https://api.github.com/users/landkeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/landkeks/subscriptions","organizations_url":"https://api.github.com/users/landkeks/orgs","repos_url":"https://api.github.com/users/landkeks/repos","events_url":"https://api.github.com/users/landkeks/events{/privacy}","received_events_url":"https://api.github.com/users/landkeks/received_events","type":"user","site_admin":false},"created_at":"2013-05-16t18:42:06z","updated_at":"2013-05-16t18:42:06z","body":"i'm getting a similar error message (\"rule_date\" instead of \"track_date\")."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/18456122","html_url":"https://github.com/owncloud/core/issues/3377#issuecomment-18456122","issue_url":"https://api.github.com/repos/owncloud/core/issues/3377","id":18456122,"user":{"login":"landkeks","id":877258,"avatar_url":"https://identicons.github.com/3f6dd950678a8bcdd0077eab31629f32.png","gravatar_id":null,"url":"https://api.github.com/users/landkeks","html_url":"https://github.com/landkeks","followers_url":"https://api.github.com/users/landkeks/followers","following_url":"https://api.github.com/users/landkeks/following{/other_user}","gists_url":"https://api.github.com/users/landkeks/gists{/gist_id}","starred_url":"https://api.github.com/users/landkeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/landkeks/subscriptions","organizations_url":"https://api.github.com/users/landkeks/orgs","repos_url":"https://api.github.com/users/landkeks/repos","events_url":"https://api.github.com/users/landkeks/events{/privacy}","received_events_url":"https://api.github.com/users/landkeks/received_events","type":"user","site_admin":false},"created_at":"2013-05-26t00:26:56z","updated_at":"2013-05-26t01:47:32z","body":"wow, what a stupid bug.\r\nappearantly, in `mdb2_schema::getdefinitionfromdatabase()` – which is called from `oc_db::updatedbfromstructure($file)` – all fields of all tables in the database are \"validated\" (whatever that's supposed to mean), regardless of whether the tables belong to owncloud or some other application (i.e. it does not check the table prefix). if mdb2 finds a field it does not like, it returns an error object which causes an exception to be thrown. (which makes absolutely no sense, since mdb2 basically claims that an existing field is invalid.)"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/18456673","html_url":"https://github.com/owncloud/core/issues/3377#issuecomment-18456673","issue_url":"https://api.github.com/repos/owncloud/core/issues/3377","id":18456673,"user":{"login":"landkeks","id":877258,"avatar_url":"https://identicons.github.com/3f6dd950678a8bcdd0077eab31629f32.png","gravatar_id":null,"url":"https://api.github.com/users/landkeks","html_url":"https://github.com/landkeks","followers_url":"https://api.github.com/users/landkeks/followers","following_url":"https://api.github.com/users/landkeks/following{/other_user}","gists_url":"https://api.github.com/users/landkeks/gists{/gist_id}","starred_url":"https://api.github.com/users/landkeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/landkeks/subscriptions","organizations_url":"https://api.github.com/users/landkeks/orgs","repos_url":"https://api.github.com/users/landkeks/repos","events_url":"https://api.github.com/users/landkeks/events{/privacy}","received_events_url":"https://api.github.com/users/landkeks/received_events","type":"user","site_admin":false},"created_at":"2013-05-26t01:44:26z","updated_at":"2013-05-26t01:44:26z","body":"patch that fixes the problem:\r\n```patch\r\nindex: lib/db.php\r\n<+>utf-8\r\n===================================================================\r\n--- lib/db.php\t(revision 0c621ff6a93fe1b34c77257d83fd344489f59bab)\r\n+++ lib/db.php\t(revision )\r\n@@ -551,7 +551,7 @@\r\n \t\t// read file\r\n \t\t$content = file_get_contents( $file );\r\n \r\n-\t\t$previousschema = self::$schema->getdefinitionfromdatabase();\r\n+\t\t$previousschema = self::$schema->getdefinitionfromdatabase($config_dbtableprefix);\r\n \t\tif (pear::iserror($previousschema)) {\r\n \t\t\t$error = $previousschema->getmessage();\r\n \t\t\t$detail = $previousschema->getdebuginfo();\r\nindex: 3rdparty/mdb2/schema.php\r\n<+>utf-8\r\n===================================================================\r\n--- 3rdparty/mdb2/schema.php\t(date 1365544919000)\r\n+++ 3rdparty/mdb2/schema.php\t(revision )\r\n@@ -424,10 +424,11 @@\r\n      * this method can be used if no xml schema file exists yet.\r\n      * the resulting xml schema file may need some manual adjustments.\r\n      *\r\n+     * @param string|null $prefix if not null, only tables with this prefix will be included\r\n      * @return array|mdb2_error array with definition or error object\r\n      * @access public\r\n      */\r\n-    function getdefinitionfromdatabase()\r\n+    function getdefinitionfromdatabase($prefix = null)\r\n     {\r\n         $database = $this->db->database_name;\r\n         if (empty($database)) {\r\n@@ -471,6 +472,10 @@\r\n         }\r\n \r\n         foreach ($tables as $table_name) {\r\n+            if (is_string($prefix) && substr($table_name, 0, strlen($prefix)) !== $prefix) {\r\n+    \t        continue;\r\n+            }\r\n+\r\n             $fields = $this->db->manager->listtablefields($table_name);\r\n             if (pear::iserror($fields)) {\r\n                 return $fields;\r\n\r\n```\r\n\r\nunfortunately, i don't know how to create a useful pull request since those files are in different repositories."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/18460784","html_url":"https://github.com/owncloud/core/issues/3377#issuecomment-18460784","issue_url":"https://api.github.com/repos/owncloud/core/issues/3377","id":18460784,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-05-26t10:02:30z","updated_at":"2013-05-26t10:02:30z","body":"@bartv2 what do you think?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/18463720","html_url":"https://github.com/owncloud/core/issues/3377#issuecomment-18463720","issue_url":"https://api.github.com/repos/owncloud/core/issues/3377","id":18463720,"user":{"login":"landkeks","id":877258,"avatar_url":"https://identicons.github.com/3f6dd950678a8bcdd0077eab31629f32.png","gravatar_id":null,"url":"https://api.github.com/users/landkeks","html_url":"https://github.com/landkeks","followers_url":"https://api.github.com/users/landkeks/followers","following_url":"https://api.github.com/users/landkeks/following{/other_user}","gists_url":"https://api.github.com/users/landkeks/gists{/gist_id}","starred_url":"https://api.github.com/users/landkeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/landkeks/subscriptions","organizations_url":"https://api.github.com/users/landkeks/orgs","repos_url":"https://api.github.com/users/landkeks/repos","events_url":"https://api.github.com/users/landkeks/events{/privacy}","received_events_url":"https://api.github.com/users/landkeks/received_events","type":"user","site_admin":false},"created_at":"2013-05-26t14:18:53z","updated_at":"2013-05-26t14:22:25z","body":"just to clarify, there are actually two issues:\r\n- the mdb2 validation logic is flawed, as it reports existing field definitions as invalid. the patch does not fix that.\r\n- during an update (and possibly on other occasions as well), owncloud calls mdb2 functions which scan the entire database. this may be a performance issue on installations where many applications use the same database and should be fixed (imo). (anecdotal evidence: it took the updater >1 min to produce the error message mentioned above on my server, whereas after applying my patch the whole update took <10 s.) my patch only fixes one part of the code where this flaw produces a visible, critical error on some installations due to the mdb2 bug. you may want to check whether similar mdb2 functions are called elsewhere in owncloud and patch those functions and function calls in the same manner."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20758608","html_url":"https://github.com/owncloud/core/issues/3377#issuecomment-20758608","issue_url":"https://api.github.com/repos/owncloud/core/issues/3377","id":20758608,"user":{"login":"vicdeo","id":991300,"avatar_url":"https://gravatar.com/avatar/57b8c1e26d502d5414e4b2fb875d2994?d=https%3a%2f%2fidenticons.github.com%2fe8357fefe8bad5436de368fa5a419461.png&r=x","gravatar_id":"57b8c1e26d502d5414e4b2fb875d2994","url":"https://api.github.com/users/vicdeo","html_url":"https://github.com/vicdeo","followers_url":"https://api.github.com/users/vicdeo/followers","following_url":"https://api.github.com/users/vicdeo/following{/other_user}","gists_url":"https://api.github.com/users/vicdeo/gists{/gist_id}","starred_url":"https://api.github.com/users/vicdeo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vicdeo/subscriptions","organizations_url":"https://api.github.com/users/vicdeo/orgs","repos_url":"https://api.github.com/users/vicdeo/repos","events_url":"https://api.github.com/users/vicdeo/events{/privacy}","received_events_url":"https://api.github.com/users/vicdeo/received_events","type":"user","site_admin":false},"created_at":"2013-07-10t17:26:26z","updated_at":"2013-07-10t17:26:26z","body":"closing as duplicate of #2916 "}]