[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10449054","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-10449054","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":10449054,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-11-16t14:46:29z","updated_at":"2012-11-16t14:46:29z","body":"how do you upload? webdav? miral? wi?\r\njust tried it via webdav and wi and the file shows up after upload has been finished."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10580257","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-10580257","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":10580257,"user":{"login":"blizzz","id":2184312,"avatar_url":"https://gravatar.com/avatar/1898b25a9cb3aa1a0f0febd1359910b9?d=https%3a%2f%2fidenticons.github.com%2fca03acec6deadf508b75eb0cf9ba036c.png&r=x","gravatar_id":"1898b25a9cb3aa1a0f0febd1359910b9","url":"https://api.github.com/users/blizzz","html_url":"https://github.com/blizzz","followers_url":"https://api.github.com/users/blizzz/followers","following_url":"https://api.github.com/users/blizzz/following{/other_user}","gists_url":"https://api.github.com/users/blizzz/gists{/gist_id}","starred_url":"https://api.github.com/users/blizzz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blizzz/subscriptions","organizations_url":"https://api.github.com/users/blizzz/orgs","repos_url":"https://api.github.com/users/blizzz/repos","events_url":"https://api.github.com/users/blizzz/events{/privacy}","received_events_url":"https://api.github.com/users/blizzz/received_events","type":"user","site_admin":false},"created_at":"2012-11-21t00:07:37z","updated_at":"2012-11-21t00:07:37z","body":"put (and thus client) is via webdav. i suppose it's also the case when uploading via wi, no?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10655574","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-10655574","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":10655574,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2012-11-23t10:28:54z","updated_at":"2012-11-23t10:28:54z","body":"this is very strange. currently uploads are done in one piece via put. i donâ´t understand how they can show up during  transfer. have you tried the big file chunking perhaps? @bartv2 do you have an idea what happens here?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11268906","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11268906","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11268906,"user":{"login":"msrex","id":2625328,"avatar_url":"https://gravatar.com/avatar/24738c0908dad69b83af9cc534bcca80?d=https%3a%2f%2fidenticons.github.com%2ff02814cb1648a9552774c0f932619e91.png&r=x","gravatar_id":"24738c0908dad69b83af9cc534bcca80","url":"https://api.github.com/users/msrex","html_url":"https://github.com/msrex","followers_url":"https://api.github.com/users/msrex/followers","following_url":"https://api.github.com/users/msrex/following{/other_user}","gists_url":"https://api.github.com/users/msrex/gists{/gist_id}","starred_url":"https://api.github.com/users/msrex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msrex/subscriptions","organizations_url":"https://api.github.com/users/msrex/orgs","repos_url":"https://api.github.com/users/msrex/repos","events_url":"https://api.github.com/users/msrex/events{/privacy}","received_events_url":"https://api.github.com/users/msrex/received_events","type":"user","site_admin":false},"created_at":"2012-12-11t23:02:54z","updated_at":"2012-12-11t23:02:54z","body":"guys, i want this fixed for 5.0. this leads to a very unacceptable user experience as per https://github.com/owncloud/mirall/issues/84.\r\n\r\nwith v4.5.4 daily and v1.2.0pre uploading via webdav it is very reproducable:\r\n- set up a syncing folder\r\n- stop the sync client\r\n- kill all owncloud processes :)\r\n- outside the syncing folder create a large file (100+mb)\r\n- start the sync client in a terminal in the foreground\r\n- in a different terminal move the large file into the syncing folder\r\n- while the client is syncing, kill it\r\n- kill all owncloud processes\r\n- using the webfrontend find the partially uploaded large file\r\n- restart the sync\r\n\r\n=> on the local disc you'll get a conflict (which is the original large file!) and the partially uploaded file from the server is downloaded and named as the original file."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11269294","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11269294","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11269294,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2012-12-11t23:13:14z","updated_at":"2012-12-11t23:13:33z","body":"hmm, i think this happens when the folder that is being upload to is loaded in the wi during upload, oc will detect that that folder has changed and index the new, partially uploaded file.\r\n\r\ni can't think of any way for the scanner to detect whether or not a file is fully uploaded.\r\nuploading the file to a temporarily location and moving it when the upload is done is also not an option since it only work correctly with the local storage backend.\r\n\r\ni don't have any idea how to solve this atm"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11288654","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11288654","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11288654,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2012-12-12t13:28:10z","updated_at":"2012-12-12t13:28:10z","body":"@icewind1991 i notice that we use \"w+\" with fopen which allows read request during writing from a different process. this can lead to a lot of strange effects as the same described here. is there a reason to not just use \"w\" which blocks reading while writing?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11354638","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11354638","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11354638,"user":{"login":"mtrichards","id":1818977,"avatar_url":"https://gravatar.com/avatar/a1655fd2e819638708ee854fa941008b?d=https%3a%2f%2fidenticons.github.com%2fa75d8baded229745ad65d43f7a7975df.png&r=x","gravatar_id":"a1655fd2e819638708ee854fa941008b","url":"https://api.github.com/users/mtrichards","html_url":"https://github.com/mtrichards","followers_url":"https://api.github.com/users/mtrichards/followers","following_url":"https://api.github.com/users/mtrichards/following{/other_user}","gists_url":"https://api.github.com/users/mtrichards/gists{/gist_id}","starred_url":"https://api.github.com/users/mtrichards/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtrichards/subscriptions","organizations_url":"https://api.github.com/users/mtrichards/orgs","repos_url":"https://api.github.com/users/mtrichards/repos","events_url":"https://api.github.com/users/mtrichards/events{/privacy}","received_events_url":"https://api.github.com/users/mtrichards/received_events","type":"user","site_admin":false},"created_at":"2012-12-13t21:39:16z","updated_at":"2012-12-13t21:39:16z","body":"this continues to be a problem. here it is from bug genie:\r\nhttp://bugs.owncloud.org/thebuggenie/owncloud/issues/oc-1580\r\n\r\nthis is repeatable in owncloud 4.5 daily dec 13, and 1.2.0 pre. essentially kill the sync client in the middle of syncing of a large file, and this happens again.\r\n\r\ndescription:\r\nhello,\r\n\r\ni've started syncing an huge folder (w/ subfolders) approx 9gb from mac osx to linux systems (with latest releases on both sides, 1.0.5 and 4.0.7 respectively).\r\n\r\nit took multiple days, and the connection was broken by both network issues and client system shutdown.\r\n\r\nanytime i shutdown the mac osx i needed to manually delete the .csync/lock file inside the $home, and the syncro started again.\r\n\r\ni point out that that folder was syncing only on this client system, and on the web gui it was just browsed by me with no write at all.\r\n\r\nafter the end of the sync, the client started syncing back some files, namely the file that were corrupted by lost connections, believing that those file were newer than the local one.\r\n\r\nthis is not correct, since this caused data corruption (i lost something like a dozen of photos, i hope i still have the camera memory card..).\r\n\r\nin my opinion an incomplete file shall not be submitted to the filesystem to avoid such an issue, or must have a different temporary name (with some exclusion rule). another recipe might be that the timestamp for the incomplete file should be very far in the past (epoch time, for instance), so the sync algorithm won't overwrite the client side (it will just sync if the file is missing) and when the \"original\" poster appear again, it will overwrite the server incomplete file with the complete version.\r\n\r\nas a side note, versioning will not save from data loss, since the server just have the broken file on initial sync.\r\n\r\nthanks again for your efforts and have a nice day. andrea\r\n\r\nreproduction steps:\r\nstart syncing a folder with a lot of medium sized file (depending on network speed, it might be 5-10mb files).\r\n\r\ninterrupt network flow (kill client program, disconnect network on client side, shutdown the client system).\r\n\r\nrestart network flow\r\n\r\nwait for the client->server sync end and look for the server->client sync.\r\n\r\nthe latter will overwrite some files (the file that were on the wire during interruption), believing they are newer than the client local version.\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11355693","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11355693","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11355693,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2012-12-13t22:05:34z","updated_at":"2012-12-13t22:05:34z","body":"i don't think the mode used matters, since the file doesn't get read during scanning, it just being in the folder will cause it to get scanned"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11368556","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11368556","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11368556,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t08:25:47z","updated_at":"2012-12-14t08:25:47z","body":"@icewind1991 sure. but what does scan mean here? you see it in the directory listing but the file can't be opened for reading. so it can't be synced. the other php process should get an error when trying an fopen on a file that is currently written to by an other process. i'm also not completely sure if this is the solution.\r\nwhat do you think?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11372524","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11372524","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11372524,"user":{"login":"bartv2","id":2227877,"avatar_url":"https://gravatar.com/avatar/c2d86a0a66a4be2c904e24034e842f44?d=https%3a%2f%2fidenticons.github.com%2f05e8b1362feb118a386dfd282b20fb84.png&r=x","gravatar_id":"c2d86a0a66a4be2c904e24034e842f44","url":"https://api.github.com/users/bartv2","html_url":"https://github.com/bartv2","followers_url":"https://api.github.com/users/bartv2/followers","following_url":"https://api.github.com/users/bartv2/following{/other_user}","gists_url":"https://api.github.com/users/bartv2/gists{/gist_id}","starred_url":"https://api.github.com/users/bartv2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bartv2/subscriptions","organizations_url":"https://api.github.com/users/bartv2/orgs","repos_url":"https://api.github.com/users/bartv2/repos","events_url":"https://api.github.com/users/bartv2/events{/privacy}","received_events_url":"https://api.github.com/users/bartv2/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t11:00:49z","updated_at":"2012-12-14t11:00:49z","body":"the problem is partial upload, eg the file is not uploaded completely. maybe sending and checking content-length header helps to detect this case, and then we can reject the file or something."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11372715","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11372715","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11372715,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t11:08:52z","updated_at":"2012-12-14t11:08:52z","body":"normal php uploads puts the uploads into the upload_tmp_dir and moves it when it's completely done in one piece. i haven't looked into sabredav but it should work the same, no?\r\nso i still don't completely understand why this can happen ;-)  what do you think @icewind1991 @bartv2  "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11372787","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11372787","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11372787,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t11:11:50z","updated_at":"2012-12-14t11:11:50z","body":"let's summon the sabredav master: @evert can you please help us out here - again? thx"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11373161","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11373161","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11373161,"user":{"login":"evert","id":178960,"avatar_url":"https://gravatar.com/avatar/7d76e2bb6f8c962a5628093c9f5bc6fb?d=https%3a%2f%2fidenticons.github.com%2f46192a8c94cd97601476c800f3d5f483.png&r=x","gravatar_id":"7d76e2bb6f8c962a5628093c9f5bc6fb","url":"https://api.github.com/users/evert","html_url":"https://github.com/evert","followers_url":"https://api.github.com/users/evert/followers","following_url":"https://api.github.com/users/evert/following{/other_user}","gists_url":"https://api.github.com/users/evert/gists{/gist_id}","starred_url":"https://api.github.com/users/evert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evert/subscriptions","organizations_url":"https://api.github.com/users/evert/orgs","repos_url":"https://api.github.com/users/evert/repos","events_url":"https://api.github.com/users/evert/events{/privacy}","received_events_url":"https://api.github.com/users/evert/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t11:26:11z","updated_at":"2012-12-14t11:26:11z","body":"hi!\r\n\r\ntrying to figure out exactly the issue. we are talking about a half-uploaded file right? not a 0-byte file?\r\n\r\nso basically what you guys suppose is happening: fwrite gets called, request gets cancelled.. fwrite stops halfway?\r\ni must confess that i have not really looked into this situation, but i can give you a recommendation.\r\n\r\ngenerally, it's a good idea to only 'create' the file, once it's fully written. the best way to do this, is to first write the file in a temporary location (on the same partition, this is important) and only after it's fully written there, put it in the correct location using `rename`.\r\n\r\n`rename` is guaranteed to be an atomic operation on posix systems, _if_ it's on the same partition. so it's the absolute best way to create new files without risk of corruption."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11373226","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11373226","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11373226,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t11:28:52z","updated_at":"2012-12-14t11:28:52z","body":"> sure. but what does scan mean here? you see it in the directory listing but the file can't be opened for reading. so it can't be synced. the other php process should get an error when trying an fopen on a file that is currently written to by an other process. i'm also not completely sure if this is the solution.\r\nwhat do you think?\r\n\r\nthe file scanner doesn't open the file, it sees that the file exists within the folder and adds it to the cache. thus the next time sync is started the file aready exists on the server and the client will see a conflict"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11373812","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11373812","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11373812,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t11:53:42z","updated_at":"2012-12-14t11:53:42z","body":"that won't work when the files need to be stored on something like samba or ftp\n\nevert <notifications@github.com> wrote:\n\n>hi!\n>\n>trying to figure out exactly the issue. we are talking about a half-uploaded file right? not a 0-byte file?\n>\n>so basically what you guys suppose is happening: fwrite gets called, request gets cancelled.. fwrite stops halfway?\n>i must confess that i have not really looked into this situation, but i can give you a recommendation.\n>\n>generally, it's a good idea to only 'create' the file, once it's fully written. the best way to do this, is to first write the file in a temporary location (on the same partition, this is important) and only after it's fully written there, put it in the correct location using rename.\n>\n>rename is guaranteed to be an atomic operation on posix systems, if it's on the same partition. so it's the absolute best way to create new files without risk of corruption.\n>\n>â€”\n>reply to this email directly or view it on github. \n>\n>ï¿¼ "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11374136","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11374136","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11374136,"user":{"login":"evert","id":178960,"avatar_url":"https://gravatar.com/avatar/7d76e2bb6f8c962a5628093c9f5bc6fb?d=https%3a%2f%2fidenticons.github.com%2f46192a8c94cd97601476c800f3d5f483.png&r=x","gravatar_id":"7d76e2bb6f8c962a5628093c9f5bc6fb","url":"https://api.github.com/users/evert","html_url":"https://github.com/evert","followers_url":"https://api.github.com/users/evert/followers","following_url":"https://api.github.com/users/evert/following{/other_user}","gists_url":"https://api.github.com/users/evert/gists{/gist_id}","starred_url":"https://api.github.com/users/evert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evert/subscriptions","organizations_url":"https://api.github.com/users/evert/orgs","repos_url":"https://api.github.com/users/evert/repos","events_url":"https://api.github.com/users/evert/events{/privacy}","received_events_url":"https://api.github.com/users/evert/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t12:06:52z","updated_at":"2012-12-14t12:06:52z","body":"i'd assume that even with samba or ftp, you could still do rename..\r\n\r\nbut if that's too difficult too implement or undesirable, i think your only option is to keep some kind of flag in your database that marks the file as 'in progress' and 'done' with regular cleanups. this may be a more robust way to deal with it."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11382333","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11382333","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11382333,"user":{"login":"dragotin","id":1070214,"avatar_url":"https://gravatar.com/avatar/af829234b31fb915704c1c65ef48eee0?d=https%3a%2f%2fidenticons.github.com%2f3392afab7f424e10623ba95a941f4d34.png&r=x","gravatar_id":"af829234b31fb915704c1c65ef48eee0","url":"https://api.github.com/users/dragotin","html_url":"https://github.com/dragotin","followers_url":"https://api.github.com/users/dragotin/followers","following_url":"https://api.github.com/users/dragotin/following{/other_user}","gists_url":"https://api.github.com/users/dragotin/gists{/gist_id}","starred_url":"https://api.github.com/users/dragotin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dragotin/subscriptions","organizations_url":"https://api.github.com/users/dragotin/orgs","repos_url":"https://api.github.com/users/dragotin/repos","events_url":"https://api.github.com/users/dragotin/events{/privacy}","received_events_url":"https://api.github.com/users/dragotin/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t16:31:40z","updated_at":"2012-12-14t16:31:40z","body":"i think there is no way around to do the \"upload to tmp-file\" and, once its succesfully finished, rename."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11382409","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11382409","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11382409,"user":{"login":"msrex","id":2625328,"avatar_url":"https://gravatar.com/avatar/24738c0908dad69b83af9cc534bcca80?d=https%3a%2f%2fidenticons.github.com%2ff02814cb1648a9552774c0f932619e91.png&r=x","gravatar_id":"24738c0908dad69b83af9cc534bcca80","url":"https://api.github.com/users/msrex","html_url":"https://github.com/msrex","followers_url":"https://api.github.com/users/msrex/followers","following_url":"https://api.github.com/users/msrex/following{/other_user}","gists_url":"https://api.github.com/users/msrex/gists{/gist_id}","starred_url":"https://api.github.com/users/msrex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msrex/subscriptions","organizations_url":"https://api.github.com/users/msrex/orgs","repos_url":"https://api.github.com/users/msrex/repos","events_url":"https://api.github.com/users/msrex/events{/privacy}","received_events_url":"https://api.github.com/users/msrex/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t16:33:45z","updated_at":"2012-12-14t16:33:45z","body":"@icewind1991 : i appreciate your concern about the ftp or samba shares, but the vast majority of users (paid or unpaid alike) have a local disk where a rename or move work just fine. think about the current situation from a user perspective: you upload a file via the wi (a large one) on a slow link, the sync client sees the half-way done file and starts syncing => boom. undesirable experience. other scenario: you sit in the train with a umts connection and are syncing. in between the connection breaks. the half-way done file is now considered the new master file for the next sync run. => boom. very undesirable experience.\r\n\r\nas @evert and @karlitschek said, we need to make sure the file is in a temporary location while being underway and is moved (or renamed) once we are certain it is uploaded, the date set correctly etc."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11383021","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11383021","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11383021,"user":{"login":"mtrichards","id":1818977,"avatar_url":"https://gravatar.com/avatar/a1655fd2e819638708ee854fa941008b?d=https%3a%2f%2fidenticons.github.com%2fa75d8baded229745ad65d43f7a7975df.png&r=x","gravatar_id":"a1655fd2e819638708ee854fa941008b","url":"https://api.github.com/users/mtrichards","html_url":"https://github.com/mtrichards","followers_url":"https://api.github.com/users/mtrichards/followers","following_url":"https://api.github.com/users/mtrichards/following{/other_user}","gists_url":"https://api.github.com/users/mtrichards/gists{/gist_id}","starred_url":"https://api.github.com/users/mtrichards/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtrichards/subscriptions","organizations_url":"https://api.github.com/users/mtrichards/orgs","repos_url":"https://api.github.com/users/mtrichards/repos","events_url":"https://api.github.com/users/mtrichards/events{/privacy}","received_events_url":"https://api.github.com/users/mtrichards/received_events","type":"user","site_admin":false},"created_at":"2012-12-14t16:49:33z","updated_at":"2012-12-14t16:49:33z","body":"the rename needs to be solved so that these unnecessary conflicts do not occur.  smb and ftp we can figure out something else, but we have to get it working.  this issue is causing problems for our users in a significant, visible, and broken way."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/11581619","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-11581619","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":11581619,"user":{"login":"msrex","id":2625328,"avatar_url":"https://gravatar.com/avatar/24738c0908dad69b83af9cc534bcca80?d=https%3a%2f%2fidenticons.github.com%2ff02814cb1648a9552774c0f932619e91.png&r=x","gravatar_id":"24738c0908dad69b83af9cc534bcca80","url":"https://api.github.com/users/msrex","html_url":"https://github.com/msrex","followers_url":"https://api.github.com/users/msrex/followers","following_url":"https://api.github.com/users/msrex/following{/other_user}","gists_url":"https://api.github.com/users/msrex/gists{/gist_id}","starred_url":"https://api.github.com/users/msrex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msrex/subscriptions","organizations_url":"https://api.github.com/users/msrex/orgs","repos_url":"https://api.github.com/users/msrex/repos","events_url":"https://api.github.com/users/msrex/events{/privacy}","received_events_url":"https://api.github.com/users/msrex/received_events","type":"user","site_admin":false},"created_at":"2012-12-20t17:07:09z","updated_at":"2012-12-20t17:07:09z","body":"where are we here? is this resolved?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/13710221","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-13710221","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":13710221,"user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"created_at":"2013-02-18t08:09:06z","updated_at":"2013-02-18t08:09:06z","body":"@karlitschek the server side has been fixed with #1596 by saving the file with a \".part\" suffix as eg. chrome does and renaming it after the upload has completed. notice that the file scanner will ignore .part files and the clients should ignore them as well (i think the desktop client already does).\r\n\r\nso this issue should be fixed (@dragotin and i worked on this during the dev meeting in stuttgart and were no longer seeing the partially uploaded files). @danimo can you verify this and by chance close this issue?\r\n\r\nwe also added a x-oc-mtime header that the clients can send to save an extra http request to correct the mtime after the upload. @dragotin wanted to work on the client code for this after his vacation.\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/13719395","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-13719395","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":13719395,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-02-18t12:19:41z","updated_at":"2013-02-18t12:19:41z","body":"awesome!!! thanks for the update"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/13774523","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-13774523","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":13774523,"user":{"login":"dragotin","id":1070214,"avatar_url":"https://gravatar.com/avatar/af829234b31fb915704c1c65ef48eee0?d=https%3a%2f%2fidenticons.github.com%2f3392afab7f424e10623ba95a941f4d34.png&r=x","gravatar_id":"af829234b31fb915704c1c65ef48eee0","url":"https://api.github.com/users/dragotin","html_url":"https://github.com/dragotin","followers_url":"https://api.github.com/users/dragotin/followers","following_url":"https://api.github.com/users/dragotin/following{/other_user}","gists_url":"https://api.github.com/users/dragotin/gists{/gist_id}","starred_url":"https://api.github.com/users/dragotin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dragotin/subscriptions","organizations_url":"https://api.github.com/users/dragotin/orgs","repos_url":"https://api.github.com/users/dragotin/repos","events_url":"https://api.github.com/users/dragotin/events{/privacy}","received_events_url":"https://api.github.com/users/dragotin/received_events","type":"user","site_admin":false},"created_at":"2013-02-19t14:20:53z","updated_at":"2013-02-19t14:20:53z","body":"i just verified that again with current master and it works. the file does not appear before it was successfully uploaded. so that is fixed.\r\n\r\nif an upload via put of a large file is interrupted a file called <filename>.part is left over, visible in the web interface. i can be used to resume later on. the pattern *.part was added to the sync clients exclude list so it wont synced back.\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/13788540","html_url":"https://github.com/owncloud/core/issues/470#issuecomment-13788540","issue_url":"https://api.github.com/repos/owncloud/core/issues/470","id":13788540,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-02-19t18:23:16z","updated_at":"2013-02-19t18:23:16z","body":"awesome work guys!! "}]