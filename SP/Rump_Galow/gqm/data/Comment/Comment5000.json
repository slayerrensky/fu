[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25798462","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25798462","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25798462,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t10:32:56z","updated_at":"2013-10-07t10:32:56z","body":"hi,\r\n\r\ni have the problem with reoccurring sql-query \r\n<code>select count(*) from  oc_users where lower(`uid`) = lower('<user1>') limit 3;</code>\r\nthat impacts the performance of a whole webserver also. my setup is owncloud 5.0.12 with apache 2.2.22, mariadb 5.5.33 and php 5.3.17.\r\nthe problem is not quite reproducible. sometimes the infinite sql-query loop starts during browsing the web-interface, whereas, sometimes is starts during a sync with the sync-client (from linux and windows clients). if the probelem occurs the corresponding browser won't load the owncloud interface completely and the sync-client stops syncing. if the browser or the sync-client is closed, the sql-querry flood stops immediately. restarting the browser or sync-client again and doing the same tasks will not always reproduce the problem.\r\n\r\nbest regards\r\n\r\naikhjarto"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25801683","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25801683","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25801683,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t11:37:16z","updated_at":"2013-10-07t11:37:16z","body":"the count(*) query is very likely generated in oc_db::numrows() (see https://github.com/owncloud/core/blob/stable5/lib/db.php#l1183) which is used by oc_user_database::userexists() (see https://github.com/owncloud/core/blob/stable5/lib/user/database.php#l246)."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25801869","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25801869","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25801869,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t11:41:05z","updated_at":"2013-10-07t11:41:36z","body":"there is a lot of room for improvement in oc_user_database. for example, receiving the display name via getdisplayname('foo') runs the following queries:\r\n```select * from `*prefix*users` where lower(`uid`) = lower('foo)``` via `userexists()`\r\n```select count(*) from `*prefix*users` where lower(`uid`) = lower('foo)``` via `numrows()`\r\nand finally\r\n```select `displayname` from `*prefix*users` where `uid` = 'foo'``` in `getdisplayname()` itself.\r\n\r\nthis is unnecessary and can be reduced to a single query.\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25802030","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25802030","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25802030,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t11:43:47z","updated_at":"2013-10-07t11:43:47z","body":"first, better test coverage for oc_user_database should be achieved. then the implementations can be improved. also see #5032"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25803219","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25803219","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25803219,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t12:07:18z","updated_at":"2013-10-07t12:07:18z","body":"@roha4000 i guess that the query ```select count(*) from oc_users where lower(`uid`) = lower('<user1>') limit 3;``` provided by you is not an exact copy since we are using upper case select almost everywhere.\r\n\r\nthe closest query i could find is\r\n```php\r\n$query = oc_db::prepare('select `uid` from `*prefix*users` where lower(`uid`) like lower(?)', $limit, $offset);\r\n```\r\nwhich is also using `like` instad of `=`. (see https://github.com/owncloud/core/blob/stable5/lib/user/database.php#l225)."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25803559","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25803559","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25803559,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t12:13:40z","updated_at":"2013-10-07t12:13:40z","body":"there is definitely a lot of room for performance improvements. :-( "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25806787","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25806787","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25806787,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t13:11:24z","updated_at":"2013-10-07t13:11:52z","body":"with owncloud 5.0.12 the select is uppercase indeed. sorry for the confusion. here are the repetitive lines of my sql-log from today:\r\n<code>select * from `oc_users` where lower(`uid`) = lower('username')\r\nselect count(*) from `oc_users` where lower(`uid`) = lower('username') limit 3</code>\r\nusername is an actual username (replaced for anonymity)\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25807111","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25807111","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25807111,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t13:16:24z","updated_at":"2013-10-07t13:16:24z","body":"@aikhjarto okay, thank you. if there really is a `=` instead of a `like`, the query is probably from somewhere else. i also haven't spotted the limit 3 yet."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25807288","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25807288","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25807288,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t13:19:10z","updated_at":"2013-10-07t13:19:10z","body":"@bantu yes this is actually copy-pasted. so in the log there is a '='."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25808724","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25808724","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25808724,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t13:39:01z","updated_at":"2013-10-07t13:41:17z","body":"this looks close. https://github.com/owncloud/core/blob/master/core/ajax/share.php#l291"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25809925","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25809925","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25809925,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t13:55:09z","updated_at":"2013-10-07t13:58:33z","body":"the number of queries of userexists() has been reduced from 2 to 1 on the master branch. see https://github.com/owncloud/core/blob/master/lib/private/user/database.php#l240 only the count(*) query is run now. this is better than what is in stable5, but still a bit suboptimal. should use a limit 1 query instead. this is just a yes/no question, the number of users does not matter."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25814521","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25814521","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25814521,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t14:48:22z","updated_at":"2013-10-07t14:48:22z","body":"@aikhjarto may i ask you to apply this patch (https://gist.github.com/bantu/e2d729528748ba169452/raw/af8fdb7ae4da9587f83047bc2bf51037d6bd0a66/ticket-5000-debug.diff)? it should log a backtrace to the owncloud log when the affected query is executed. this way we can hopefully find out where the query is from."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25820560","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25820560","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25820560,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t15:55:12z","updated_at":"2013-10-07t15:55:12z","body":"@bantu i applied the patch and the problem occurred again after applying. however, nothing is in the log files. in fact the log file's last entry is from yesterday. do i have to activate some kind of debug-mode?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25823296","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25823296","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25823296,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t16:27:38z","updated_at":"2013-10-07t20:43:14z","body":"@bantu i thougth that something with the stripos in your patch is too restrictive. so i  relaxed the if-clause to just get ```limit == 3``` and now i get the following log-entry (many of them)\r\n\r\n* removed by bantu, see below\r\n\r\ni replaced the real username with \"username\" for anonymity."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25829794","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25829794","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25829794,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t17:52:08z","updated_at":"2013-10-07t17:52:08z","body":"@aikhjarto thank you for taking care of that. a more-readable version of the backtrace can be found here: https://gist.github.com/bantu/eb63ea84fe89f0c47b1b"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25844445","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25844445","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25844445,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t20:56:36z","updated_at":"2013-10-07t20:56:36z","body":"the interesting part of the path is\r\n```php\r\n[...]\r\noc_connector_sabre_auth::authenticate()\r\noc_util::setupfs()\r\n\\oc\\files\\filesystem::init()\r\n\\oc\\files\\filesystem::initmountpoints()\r\noc_user::gethome()\r\noc_user_database::gethome()\r\noc_user_database::userexists()\r\npdostatementwrapper::numrows()\r\noc_db::prepare()\r\n```\r\n\r\n`oc_db::prepare()` has `3` as the second argument. no clue where that is from."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25853423","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25853423","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25853423,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-07t23:16:04z","updated_at":"2013-10-07t23:22:16z","body":"okay, i finally figured this out. it's just https://github.com/owncloud/core/blob/stable5/lib/db.php#l1186 and the fact that pdo::fetch_num is passed as an argument, which is 3 and incredibly wrong."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25867879","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25867879","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25867879,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-08t06:41:28z","updated_at":"2013-10-08t06:41:28z","body":"@bantu i applied your pull request to my owncloud installation. unfortunately, the problem of the repeated sql-queries remains. however, now the lines lack of the limit argument:\r\n select count(*) from `oc_users` where lower(`uid`) = lower('username')\r\n select * from `oc_users` where lower(`uid`) = lower('username')\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25876427","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25876427","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25876427,"user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"created_at":"2013-10-08t09:38:20z","updated_at":"2013-10-08t09:38:20z","body":"the extra `select count` query can be solved by replacing https://github.com/owncloud/core/blob/stable5/lib/user/database.php#l246\r\nwith `return (bool)$result->fetchrow()`.\r\n\r\n`numrows` should be avoided where possible."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25879209","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25879209","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25879209,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-08t10:29:40z","updated_at":"2013-10-08t10:29:40z","body":"@icewind1991 indeed the 'select count' line is gone in the log. but\r\n select * from `oc_users` where lower(`uid`) = lower('username')\r\nstill occurs in a loop."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25887427","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25887427","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25887427,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-08t13:03:30z","updated_at":"2013-10-08t13:03:30z","body":"@aikhjarto removing the pointless limit 3 will do almost nothing to improve performance. but it was a crucial part of understanding where the query is actually generated. i will send more changes to futher improve performance. but i am not going to do this without test coverage. so test coverage has to be written first.\r\n\r\n@icewind1991 the best way to do this is `select uid from oc_users where lower(uid) = lower('username') limit 1`. also see https://github.com/owncloud/core/issues/5000#issuecomment-25809925"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/25926143","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-25926143","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":25926143,"user":{"login":"sezuan","id":202755,"avatar_url":"https://gravatar.com/avatar/4c8d5a06caa8d56702901233333273cc?d=https%3a%2f%2fidenticons.github.com%2fd5b808467be0ff49e27d78775a8e7ba5.png&r=x","gravatar_id":"4c8d5a06caa8d56702901233333273cc","url":"https://api.github.com/users/sezuan","html_url":"https://github.com/sezuan","followers_url":"https://api.github.com/users/sezuan/followers","following_url":"https://api.github.com/users/sezuan/following{/other_user}","gists_url":"https://api.github.com/users/sezuan/gists{/gist_id}","starred_url":"https://api.github.com/users/sezuan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sezuan/subscriptions","organizations_url":"https://api.github.com/users/sezuan/orgs","repos_url":"https://api.github.com/users/sezuan/repos","events_url":"https://api.github.com/users/sezuan/events{/privacy}","received_events_url":"https://api.github.com/users/sezuan/received_events","type":"user","site_admin":false},"created_at":"2013-10-08t20:48:10z","updated_at":"2013-10-08t20:48:10z","body":"hi,\r\n\r\ni've the very same problem. unfortunately i don't have a real solution. at least i can duplicate the issue very easily by syncing certain files with the owncloud client. i've noticed, that disabling the versions app solves the problems\r\n\r\nmaybe you can try that as well. if it's really related to the versions app it might be a good hint to dig further.\r\n\r\nmatthias"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26195753","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26195753","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26195753,"user":{"login":"sezuan","id":202755,"avatar_url":"https://gravatar.com/avatar/4c8d5a06caa8d56702901233333273cc?d=https%3a%2f%2fidenticons.github.com%2fd5b808467be0ff49e27d78775a8e7ba5.png&r=x","gravatar_id":"4c8d5a06caa8d56702901233333273cc","url":"https://api.github.com/users/sezuan","html_url":"https://github.com/sezuan","followers_url":"https://api.github.com/users/sezuan/followers","following_url":"https://api.github.com/users/sezuan/following{/other_user}","gists_url":"https://api.github.com/users/sezuan/gists{/gist_id}","starred_url":"https://api.github.com/users/sezuan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sezuan/subscriptions","organizations_url":"https://api.github.com/users/sezuan/orgs","repos_url":"https://api.github.com/users/sezuan/repos","events_url":"https://api.github.com/users/sezuan/events{/privacy}","received_events_url":"https://api.github.com/users/sezuan/received_events","type":"user","site_admin":false},"created_at":"2013-10-12t11:24:37z","updated_at":"2013-10-12t11:25:16z","body":"after some debugging i found out, that the recursion/loop occurs when the version module tries to remove old versions in the function deloldversion, to be exact: `$versionsfileview->unlink($version['path'] . '.v' . $version['version']);` never ends. to duplicate this issue you need to sync a file every few seconds, after the limit is reached and old versions will be deleted, the sync fails. this might explain why it doesn't happen all the time."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26198239","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26198239","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26198239,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-10-12t14:19:17z","updated_at":"2013-10-12t14:19:17z","body":"@schiesbn any idea?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26232972","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26232972","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26232972,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-14t02:32:43z","updated_at":"2013-10-14t02:32:43z","body":"likely path that leads to the queries:\r\n```\r\n\\oca\\files_versions\\storage::getuidandfilename()\r\n\\oc\\files\\filesystem::initmountpoints()\r\noc_user::gethome()\r\noc_user_database::gethome()\r\noc_user_database::userexists()\r\npdostatementwrapper::numrows()\r\noc_db::prepare()\r\n```"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26282899","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26282899","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26282899,"user":{"login":"wollir72","id":5664172,"avatar_url":"https://gravatar.com/avatar/9589a4ea72b5eac25679ab39ba7da187?d=https%3a%2f%2fidenticons.github.com%2f76a133464986628afdcdd1b7cdb443e6.png&r=x","gravatar_id":"9589a4ea72b5eac25679ab39ba7da187","url":"https://api.github.com/users/wollir72","html_url":"https://github.com/wollir72","followers_url":"https://api.github.com/users/wollir72/followers","following_url":"https://api.github.com/users/wollir72/following{/other_user}","gists_url":"https://api.github.com/users/wollir72/gists{/gist_id}","starred_url":"https://api.github.com/users/wollir72/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wollir72/subscriptions","organizations_url":"https://api.github.com/users/wollir72/orgs","repos_url":"https://api.github.com/users/wollir72/repos","events_url":"https://api.github.com/users/wollir72/events{/privacy}","received_events_url":"https://api.github.com/users/wollir72/received_events","type":"user","site_admin":false},"created_at":"2013-10-14t19:43:37z","updated_at":"2013-10-14t19:45:11z","body":"i have the same problem that httpd processes consumed a lot of cpu on sync and never stop. it occurs since owncloud 5.0.12\r\ni created a issue https://github.com/owncloud/core/issues/5312, but no one can find the reason. today i found this thread and tried the hint with the versions app. after disabling the versions app sync works fine. but it is no real solution^^"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26510036","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26510036","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26510036,"user":{"login":"aikhjarto","id":3519989,"avatar_url":"https://gravatar.com/avatar/bbf4c170180cff922611955df3a1f7c9?d=https%3a%2f%2fidenticons.github.com%2f2f1be3bc6a352fb489bfe246f4944175.png&r=x","gravatar_id":"bbf4c170180cff922611955df3a1f7c9","url":"https://api.github.com/users/aikhjarto","html_url":"https://github.com/aikhjarto","followers_url":"https://api.github.com/users/aikhjarto/followers","following_url":"https://api.github.com/users/aikhjarto/following{/other_user}","gists_url":"https://api.github.com/users/aikhjarto/gists{/gist_id}","starred_url":"https://api.github.com/users/aikhjarto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aikhjarto/subscriptions","organizations_url":"https://api.github.com/users/aikhjarto/orgs","repos_url":"https://api.github.com/users/aikhjarto/repos","events_url":"https://api.github.com/users/aikhjarto/events{/privacy}","received_events_url":"https://api.github.com/users/aikhjarto/received_events","type":"user","site_admin":false},"created_at":"2013-10-17t14:24:33z","updated_at":"2013-10-18t10:03:10z","body":"the problem just occured again during a sync. i disabled the version app and the the sync worked (o.k. it left some conflict files, but thats no big deal). "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26537397","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26537397","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26537397,"user":{"login":"bantu","id":189375,"avatar_url":"https://gravatar.com/avatar/88483d87947219efecfc570465c753b2?d=https%3a%2f%2fidenticons.github.com%2fcdc48f189c0e2e8a870f3d54615a2f0d.png&r=x","gravatar_id":"88483d87947219efecfc570465c753b2","url":"https://api.github.com/users/bantu","html_url":"https://github.com/bantu","followers_url":"https://api.github.com/users/bantu/followers","following_url":"https://api.github.com/users/bantu/following{/other_user}","gists_url":"https://api.github.com/users/bantu/gists{/gist_id}","starred_url":"https://api.github.com/users/bantu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bantu/subscriptions","organizations_url":"https://api.github.com/users/bantu/orgs","repos_url":"https://api.github.com/users/bantu/repos","events_url":"https://api.github.com/users/bantu/events{/privacy}","received_events_url":"https://api.github.com/users/bantu/received_events","type":"user","site_admin":false},"created_at":"2013-10-17t18:42:43z","updated_at":"2013-10-17t18:42:43z","body":"@schiesbn bump. any idea?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26669454","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26669454","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26669454,"user":{"login":"sercxanto","id":356025,"avatar_url":"https://gravatar.com/avatar/cee0a2e073070b8c4bbc7d1e0120009c?d=https%3a%2f%2fidenticons.github.com%2f38a61b8ca67ec10eec24c80cc8688e63.png&r=x","gravatar_id":"cee0a2e073070b8c4bbc7d1e0120009c","url":"https://api.github.com/users/sercxanto","html_url":"https://github.com/sercxanto","followers_url":"https://api.github.com/users/sercxanto/followers","following_url":"https://api.github.com/users/sercxanto/following{/other_user}","gists_url":"https://api.github.com/users/sercxanto/gists{/gist_id}","starred_url":"https://api.github.com/users/sercxanto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sercxanto/subscriptions","organizations_url":"https://api.github.com/users/sercxanto/orgs","repos_url":"https://api.github.com/users/sercxanto/repos","events_url":"https://api.github.com/users/sercxanto/events{/privacy}","received_events_url":"https://api.github.com/users/sercxanto/received_events","type":"user","site_admin":false},"created_at":"2013-10-20t09:22:54z","updated_at":"2013-10-20t09:22:54z","body":"i experience the very same problem. after googling for the \"memory exhausted\" error i found in the owncloud log i ended on this bug report page. imo the bug is not an performance issue but rather critical one and a hotfix for the 5.x versions should be released as it\r\n\r\n * effectively breaks one of the core functionalities (syncing files)\r\n * affects other users as well (as one thread is busy for a long time)\r\n * even may affect other service running on the same host (imagine multiple user trigger the endless loop)\r\n\r\nfor the time being as a workaround i disabled versioning and see if it helps."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/26706029","html_url":"https://github.com/owncloud/core/issues/5000#issuecomment-26706029","issue_url":"https://api.github.com/repos/owncloud/core/issues/5000","id":26706029,"user":{"login":"schiesbn","id":1589737,"avatar_url":"https://gravatar.com/avatar/8912b598c7b32dd25b87fd168e0b06b2?d=https%3a%2f%2fidenticons.github.com%2f0a323047dbe8329db30eae8dbe96e55e.png&r=x","gravatar_id":"8912b598c7b32dd25b87fd168e0b06b2","url":"https://api.github.com/users/schiesbn","html_url":"https://github.com/schiesbn","followers_url":"https://api.github.com/users/schiesbn/followers","following_url":"https://api.github.com/users/schiesbn/following{/other_user}","gists_url":"https://api.github.com/users/schiesbn/gists{/gist_id}","starred_url":"https://api.github.com/users/schiesbn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schiesbn/subscriptions","organizations_url":"https://api.github.com/users/schiesbn/orgs","repos_url":"https://api.github.com/users/schiesbn/repos","events_url":"https://api.github.com/users/schiesbn/events{/privacy}","received_events_url":"https://api.github.com/users/schiesbn/received_events","type":"user","site_admin":false},"created_at":"2013-10-21t10:20:18z","updated_at":"2013-10-21t10:20:29z","body":"i debugged it. the problem are that the hooks are triggered for the unlink operation even if the views root is ```/user/files_versions``` seems to be the same as https://github.com/owncloud/core/pull/5247. @icewind1991 can we backport it to stable5?\r\n\r\nwe end up at this place: https://github.com/owncloud/core/blob/stable5/lib/files/view.php#l692\r\n```\r\nreturn filesystem::getview()->getrelativepath($this->getabsolutepath($path));\r\n```\r\n\r\nwhere getabsolutepath() returns  the correct path ```/user/files_versions/foo.txt``` and getrelativepath() assume that ```user/files``` is the root so that at the end the path is trimmed to ```_versions/foo.txt```"}]