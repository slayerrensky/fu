[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23053181","html_url":"https://github.com/owncloud/core/issues/4511#issuecomment-23053181","issue_url":"https://api.github.com/repos/owncloud/core/issues/4511","id":23053181,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2013-08-21t21:49:01z","updated_at":"2013-08-21t21:49:01z","body":"hehe - this was a low hanging fruit - sabredav is already implementing these if-match/if-not-match checks.\r\n\r\nhttp status code 412 - preconditionfailed will be returned\r\n\r\n@evert you rock! thx"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23053697","html_url":"https://github.com/owncloud/core/issues/4511#issuecomment-23053697","issue_url":"https://api.github.com/repos/owncloud/core/issues/4511","id":23053697,"user":{"login":"evert","id":178960,"avatar_url":"https://gravatar.com/avatar/7d76e2bb6f8c962a5628093c9f5bc6fb?d=https%3a%2f%2fidenticons.github.com%2f46192a8c94cd97601476c800f3d5f483.png&r=x","gravatar_id":"7d76e2bb6f8c962a5628093c9f5bc6fb","url":"https://api.github.com/users/evert","html_url":"https://github.com/evert","followers_url":"https://api.github.com/users/evert/followers","following_url":"https://api.github.com/users/evert/following{/other_user}","gists_url":"https://api.github.com/users/evert/gists{/gist_id}","starred_url":"https://api.github.com/users/evert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evert/subscriptions","organizations_url":"https://api.github.com/users/evert/orgs","repos_url":"https://api.github.com/users/evert/repos","events_url":"https://api.github.com/users/evert/events{/privacy}","received_events_url":"https://api.github.com/users/evert/received_events","type":"user","site_admin":false},"created_at":"2013-08-21t21:57:15z","updated_at":"2013-08-21t21:57:28z","body":"hehe thnx =)"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23069572","html_url":"https://github.com/owncloud/core/issues/4511#issuecomment-23069572","issue_url":"https://api.github.com/repos/owncloud/core/issues/4511","id":23069572,"user":{"login":"ogoffart","id":959326,"avatar_url":"https://gravatar.com/avatar/3d5bb00e84aa3200aea132e92300cdb4?d=https%3a%2f%2fidenticons.github.com%2f03e6f725155bf82c3986f0199d4d59ab.png&r=x","gravatar_id":"3d5bb00e84aa3200aea132e92300cdb4","url":"https://api.github.com/users/ogoffart","html_url":"https://github.com/ogoffart","followers_url":"https://api.github.com/users/ogoffart/followers","following_url":"https://api.github.com/users/ogoffart/following{/other_user}","gists_url":"https://api.github.com/users/ogoffart/gists{/gist_id}","starred_url":"https://api.github.com/users/ogoffart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogoffart/subscriptions","organizations_url":"https://api.github.com/users/ogoffart/orgs","repos_url":"https://api.github.com/users/ogoffart/repos","events_url":"https://api.github.com/users/ogoffart/events{/privacy}","received_events_url":"https://api.github.com/users/ogoffart/received_events","type":"user","site_admin":false},"created_at":"2013-08-22t05:39:51z","updated_at":"2013-08-22t05:39:51z","body":"is there locking so that there is no loss if the same file is uploaded at the same second by two different client (with different content?).   is the operation atomic?\r\nwill it work with chunking?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23089196","html_url":"https://github.com/owncloud/core/issues/4511#issuecomment-23089196","issue_url":"https://api.github.com/repos/owncloud/core/issues/4511","id":23089196,"user":{"login":"evert","id":178960,"avatar_url":"https://gravatar.com/avatar/7d76e2bb6f8c962a5628093c9f5bc6fb?d=https%3a%2f%2fidenticons.github.com%2f46192a8c94cd97601476c800f3d5f483.png&r=x","gravatar_id":"7d76e2bb6f8c962a5628093c9f5bc6fb","url":"https://api.github.com/users/evert","html_url":"https://github.com/evert","followers_url":"https://api.github.com/users/evert/followers","following_url":"https://api.github.com/users/evert/following{/other_user}","gists_url":"https://api.github.com/users/evert/gists{/gist_id}","starred_url":"https://api.github.com/users/evert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evert/subscriptions","organizations_url":"https://api.github.com/users/evert/orgs","repos_url":"https://api.github.com/users/evert/repos","events_url":"https://api.github.com/users/evert/events{/privacy}","received_events_url":"https://api.github.com/users/evert/received_events","type":"user","site_admin":false},"created_at":"2013-08-22t13:22:18z","updated_at":"2013-08-22t13:22:18z","body":"hi,\r\n\r\nthe operation is _not_ atomic. my understanding of how owncloud works, is that new uploads are first placed in a temporary place and then moved into place. the implication of that is that the last request 'wins'.\r\n\r\nif the etag immediately changes after the upload commences, there is still a small window between checking the etag and updating the etag.\r\n\r\nthe etag check is independent of the actual upload (it works for many http operations, not just put), so it works with a chunked transfer encoding.\r\n\r\nif you need a real lock, you need http lock and unlock.\r\n\r\ni can see myself making the etag check / upload atomic, but this would be a relatively large change."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23094532","html_url":"https://github.com/owncloud/core/issues/4511#issuecomment-23094532","issue_url":"https://api.github.com/repos/owncloud/core/issues/4511","id":23094532,"user":{"login":"ogoffart","id":959326,"avatar_url":"https://gravatar.com/avatar/3d5bb00e84aa3200aea132e92300cdb4?d=https%3a%2f%2fidenticons.github.com%2f03e6f725155bf82c3986f0199d4d59ab.png&r=x","gravatar_id":"3d5bb00e84aa3200aea132e92300cdb4","url":"https://api.github.com/users/ogoffart","html_url":"https://github.com/ogoffart","followers_url":"https://api.github.com/users/ogoffart/followers","following_url":"https://api.github.com/users/ogoffart/following{/other_user}","gists_url":"https://api.github.com/users/ogoffart/gists{/gist_id}","starred_url":"https://api.github.com/users/ogoffart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ogoffart/subscriptions","organizations_url":"https://api.github.com/users/ogoffart/orgs","repos_url":"https://api.github.com/users/ogoffart/repos","events_url":"https://api.github.com/users/ogoffart/events{/privacy}","received_events_url":"https://api.github.com/users/ogoffart/received_events","type":"user","site_admin":false},"created_at":"2013-08-22t14:31:03z","updated_at":"2013-08-22t14:31:03z","body":"i'd like to avoid using lock and unlock in the client because it will increase the number of required roundtrip or make unessesary locks (what if the client dies?)"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23098847","html_url":"https://github.com/owncloud/core/issues/4511#issuecomment-23098847","issue_url":"https://api.github.com/repos/owncloud/core/issues/4511","id":23098847,"user":{"login":"evert","id":178960,"avatar_url":"https://gravatar.com/avatar/7d76e2bb6f8c962a5628093c9f5bc6fb?d=https%3a%2f%2fidenticons.github.com%2f46192a8c94cd97601476c800f3d5f483.png&r=x","gravatar_id":"7d76e2bb6f8c962a5628093c9f5bc6fb","url":"https://api.github.com/users/evert","html_url":"https://github.com/evert","followers_url":"https://api.github.com/users/evert/followers","following_url":"https://api.github.com/users/evert/following{/other_user}","gists_url":"https://api.github.com/users/evert/gists{/gist_id}","starred_url":"https://api.github.com/users/evert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evert/subscriptions","organizations_url":"https://api.github.com/users/evert/orgs","repos_url":"https://api.github.com/users/evert/repos","events_url":"https://api.github.com/users/evert/events{/privacy}","received_events_url":"https://api.github.com/users/evert/received_events","type":"user","site_admin":false},"created_at":"2013-08-22t15:27:33z","updated_at":"2013-08-22t15:27:33z","body":"yea i understand..\r\n\r\nthe best recommendation i could then give to the owncloud devs, is to minimize the time between checking an d updating the etag. so as soon as ifile::put() gets called, modify the etag.\r\n\r\nif you were to combine that with `flock()` or `lock_ex` when calling file_put_contents, i don't think it's possible for bad uploads to happen.\r\n\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23262197","html_url":"https://github.com/owncloud/core/issues/4511#issuecomment-23262197","issue_url":"https://api.github.com/repos/owncloud/core/issues/4511","id":23262197,"user":{"login":"natschil","id":3118879,"avatar_url":"https://gravatar.com/avatar/444ab71ce2aa0694d63f1cdf7e33fe86?d=https%3a%2f%2fidenticons.github.com%2f184fb4bde45d4a37f71b38a32a7205ed.png&r=x","gravatar_id":"444ab71ce2aa0694d63f1cdf7e33fe86","url":"https://api.github.com/users/natschil","html_url":"https://github.com/natschil","followers_url":"https://api.github.com/users/natschil/followers","following_url":"https://api.github.com/users/natschil/following{/other_user}","gists_url":"https://api.github.com/users/natschil/gists{/gist_id}","starred_url":"https://api.github.com/users/natschil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/natschil/subscriptions","organizations_url":"https://api.github.com/users/natschil/orgs","repos_url":"https://api.github.com/users/natschil/repos","events_url":"https://api.github.com/users/natschil/events{/privacy}","received_events_url":"https://api.github.com/users/natschil/received_events","type":"user","site_admin":false},"created_at":"2013-08-26t13:28:31z","updated_at":"2013-08-26t13:28:31z","body":"maybe i've misunderstood this discussion, but minimizing time between checks isn't a replacement for true atomicity - using something that is almost atomic and pretending it is atomic will only give rise to sublte bugs in the future that are difficult to replicate and can cause data-loss - something that should be avoided at all costs."}]