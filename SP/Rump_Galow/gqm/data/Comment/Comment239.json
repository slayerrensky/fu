[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10069053","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10069053","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10069053,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t12:42:09z","updated_at":"2012-11-05t12:42:09z","body":"@evert\r\ncan you help us out on this? thx a lot!"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10069107","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10069107","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10069107,"user":{"login":"evert","id":178960,"avatar_url":"https://gravatar.com/avatar/7d76e2bb6f8c962a5628093c9f5bc6fb?d=https%3a%2f%2fidenticons.github.com%2f46192a8c94cd97601476c800f3d5f483.png&r=x","gravatar_id":"7d76e2bb6f8c962a5628093c9f5bc6fb","url":"https://api.github.com/users/evert","html_url":"https://github.com/evert","followers_url":"https://api.github.com/users/evert/followers","following_url":"https://api.github.com/users/evert/following{/other_user}","gists_url":"https://api.github.com/users/evert/gists{/gist_id}","starred_url":"https://api.github.com/users/evert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evert/subscriptions","organizations_url":"https://api.github.com/users/evert/orgs","repos_url":"https://api.github.com/users/evert/repos","events_url":"https://api.github.com/users/evert/events{/privacy}","received_events_url":"https://api.github.com/users/evert/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t12:44:04z","updated_at":"2012-11-05t12:44:04z","body":"where's the code for this?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10069284","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10069284","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10069284,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t12:50:38z","updated_at":"2012-11-05t12:50:38z","body":"hehe - took me some time to find the code.\r\nactually this is not sabredav related - @evert sorry for the noise.\r\n\r\nthe problem is here:\r\nhttps://github.com/owncloud/core/blob/master/lib/connector/sabre/directory.php#l128\r\n\r\n$placeholders needs to be chunked in packs of 1000 items max.\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10069316","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10069316","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10069316,"user":{"login":"evert","id":178960,"avatar_url":"https://gravatar.com/avatar/7d76e2bb6f8c962a5628093c9f5bc6fb?d=https%3a%2f%2fidenticons.github.com%2f46192a8c94cd97601476c800f3d5f483.png&r=x","gravatar_id":"7d76e2bb6f8c962a5628093c9f5bc6fb","url":"https://api.github.com/users/evert","html_url":"https://github.com/evert","followers_url":"https://api.github.com/users/evert/followers","following_url":"https://api.github.com/users/evert/following{/other_user}","gists_url":"https://api.github.com/users/evert/gists{/gist_id}","starred_url":"https://api.github.com/users/evert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/evert/subscriptions","organizations_url":"https://api.github.com/users/evert/orgs","repos_url":"https://api.github.com/users/evert/repos","events_url":"https://api.github.com/users/evert/events{/privacy}","received_events_url":"https://api.github.com/users/evert/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t12:51:47z","updated_at":"2012-11-05t12:51:47z","body":"i had a hunch.. it actually looks like you may be able to use a like query instead though.. "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10069511","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10069511","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10069511,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t12:59:38z","updated_at":"2012-11-05t12:59:38z","body":"looks like"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10078247","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10078247","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10078247,"user":{"login":"scroogie","id":1218488,"avatar_url":"https://gravatar.com/avatar/6ddd538597adee876eda285aab0a1223?d=https%3a%2f%2fidenticons.github.com%2f32191fa6664a5e5e50ef576a6bec2dd4.png&r=x","gravatar_id":"6ddd538597adee876eda285aab0a1223","url":"https://api.github.com/users/scroogie","html_url":"https://github.com/scroogie","followers_url":"https://api.github.com/users/scroogie/followers","following_url":"https://api.github.com/users/scroogie/following{/other_user}","gists_url":"https://api.github.com/users/scroogie/gists{/gist_id}","starred_url":"https://api.github.com/users/scroogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scroogie/subscriptions","organizations_url":"https://api.github.com/users/scroogie/orgs","repos_url":"https://api.github.com/users/scroogie/repos","events_url":"https://api.github.com/users/scroogie/events{/privacy}","received_events_url":"https://api.github.com/users/scroogie/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t16:56:06z","updated_at":"2012-11-05t16:56:06z","body":"would the shared files need to be special cased then? (when using a prefix scan). btw, i think mysql is able to use an index in a like prefix% query."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10078454","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10078454","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10078454,"user":{"login":"dragotin","id":1070214,"avatar_url":"https://gravatar.com/avatar/af829234b31fb915704c1c65ef48eee0?d=https%3a%2f%2fidenticons.github.com%2f3392afab7f424e10623ba95a941f4d34.png&r=x","gravatar_id":"af829234b31fb915704c1c65ef48eee0","url":"https://api.github.com/users/dragotin","html_url":"https://github.com/dragotin","followers_url":"https://api.github.com/users/dragotin/followers","following_url":"https://api.github.com/users/dragotin/following{/other_user}","gists_url":"https://api.github.com/users/dragotin/gists{/gist_id}","starred_url":"https://api.github.com/users/dragotin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dragotin/subscriptions","organizations_url":"https://api.github.com/users/dragotin/orgs","repos_url":"https://api.github.com/users/dragotin/repos","events_url":"https://api.github.com/users/dragotin/events{/privacy}","received_events_url":"https://api.github.com/users/dragotin/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t17:01:01z","updated_at":"2012-11-05t17:16:53z","body":"@icewind1991 \r\n@deepdiver1975 \r\n\r\nthis patch solves the problem for me:\r\n\r\n```php\r\ndiff --git a/lib/connector/sabre/directory.php b/lib/connector/sabre/directory.php\r\nindex 413efef..37238dc 100644\r\n--- a/lib/connector/sabre/directory.php\r\n+++ b/lib/connector/sabre/directory.php\r\n@@ -124,10 +124,15 @@ class oc_connector_sabre_directory extends oc_connector_sabre_node implements sa\r\n                }\r\n                $properties = array_fill_keys($paths, array());\r\n                if(count($paths)>0) {\r\n-                       $placeholders = join(',', array_fill(0, count($paths), '?'));\r\n-                       $query = oc_db::prepare( 'select * from `*prefix*properties` where `userid` = ?' . ' and `propertypath` in ('.$placeholders.')' );\r\n-                       array_unshift($paths, oc_user::getuser()); // prepend userid\r\n-                       $result = $query->execute( $paths );\r\n+                       $query = oc_db::prepare( 'select * from `*prefix*properties` where `userid` = ? and `propertypath` =?');\r\n+                       $params = array();\r\n+                       $params[] = oc_user::getuser();\r\n+\r\n+                       foreach($paths as $path) {\r\n+                               $params[1] = $path;\r\n+\r\n+                               $result = $query->execute($params);\r\n+\r\n                        while($row = $result->fetchrow()) {\r\n                                $propertypath = $row['propertypath'];\r\n                                $propertyname = $row['propertyname'];\r\n@@ -135,7 +140,7 @@ class oc_connector_sabre_directory extends oc_connector_sabre_node implements sa\r\n                                $properties[$propertypath][$propertyname] = $propertyvalue;\r\n                        }\r\n                }\r\n-\r\n+               }\r\n                $nodes = array();\r\n                foreach($folder_content as $info) {\r\n                        $node = $this->getchild($info['name'], $info);\r\n\r\n```\r\nplease review deeply, i am not very much into php. it loops over all the children which should be fine as long the prepare is outside the loop. in should be used carefully."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10086576","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10086576","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10086576,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t20:32:15z","updated_at":"2012-11-05t20:32:15z","body":"i'll do some test on this."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10087314","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10087314","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10087314,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t20:51:59z","updated_at":"2012-11-05t21:08:42z","body":"my setup: apache + sqlite\r\ncurrent implementation: 0.1331 sec.\r\nproposal above: 0.5020 sec\r\nchunked in packs of 999: 0.3075 sec"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10092605","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10092605","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10092605,"user":{"login":"scroogie","id":1218488,"avatar_url":"https://gravatar.com/avatar/6ddd538597adee876eda285aab0a1223?d=https%3a%2f%2fidenticons.github.com%2f32191fa6664a5e5e50ef576a6bec2dd4.png&r=x","gravatar_id":"6ddd538597adee876eda285aab0a1223","url":"https://api.github.com/users/scroogie","html_url":"https://github.com/scroogie","followers_url":"https://api.github.com/users/scroogie/followers","following_url":"https://api.github.com/users/scroogie/following{/other_user}","gists_url":"https://api.github.com/users/scroogie/gists{/gist_id}","starred_url":"https://api.github.com/users/scroogie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scroogie/subscriptions","organizations_url":"https://api.github.com/users/scroogie/orgs","repos_url":"https://api.github.com/users/scroogie/repos","events_url":"https://api.github.com/users/scroogie/events{/privacy}","received_events_url":"https://api.github.com/users/scroogie/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t23:16:04z","updated_at":"2012-11-05t23:16:04z","body":"how many records does the table have in the above tests? "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/10092676","html_url":"https://github.com/owncloud/core/issues/239#issuecomment-10092676","issue_url":"https://api.github.com/repos/owncloud/core/issues/239","id":10092676,"user":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false},"created_at":"2012-11-05t23:18:29z","updated_at":"2012-11-05t23:18:29z","body":"i did setup a clean new installation for testing this: 998 entries."}]