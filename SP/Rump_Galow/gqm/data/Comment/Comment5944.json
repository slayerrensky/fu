[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28793036","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28793036","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28793036,"user":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t14:20:34z","updated_at":"2013-11-19t14:20:34z","body":"@schiesbn "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28794742","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28794742","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28794742,"user":{"login":"schiesbn","id":1589737,"avatar_url":"https://gravatar.com/avatar/8912b598c7b32dd25b87fd168e0b06b2?d=https%3a%2f%2fidenticons.github.com%2f0a323047dbe8329db30eae8dbe96e55e.png&r=x","gravatar_id":"8912b598c7b32dd25b87fd168e0b06b2","url":"https://api.github.com/users/schiesbn","html_url":"https://github.com/schiesbn","followers_url":"https://api.github.com/users/schiesbn/followers","following_url":"https://api.github.com/users/schiesbn/following{/other_user}","gists_url":"https://api.github.com/users/schiesbn/gists{/gist_id}","starred_url":"https://api.github.com/users/schiesbn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schiesbn/subscriptions","organizations_url":"https://api.github.com/users/schiesbn/orgs","repos_url":"https://api.github.com/users/schiesbn/repos","events_url":"https://api.github.com/users/schiesbn/events{/privacy}","received_events_url":"https://api.github.com/users/schiesbn/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t14:41:39z","updated_at":"2013-11-19t14:41:39z","body":"please check if all users involved have a private key in ```/data/<user>/files_encryption``` and a public key in  ```/data/public-keys```\r\n\r\nif a file was shared, does it show up in the recipients share folder despite of the error message that the recipient is not ready for encryption? please look at the owners folder at ```/data/owner/files_encryption/share_keys/<path_to_the_shared_file>/<shared_file_name>.userid.sharekey``` if a share key exists for the owner and the recipient."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28800089","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28800089","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28800089,"user":{"login":"elethiomel","id":2545807,"avatar_url":"https://gravatar.com/avatar/cb3ee71dd10cc0a0cae2b607eb9bf71d?d=https%3a%2f%2fidenticons.github.com%2f49d6500b2bdb0492d7aef8ae9d00f211.png&r=x","gravatar_id":"cb3ee71dd10cc0a0cae2b607eb9bf71d","url":"https://api.github.com/users/elethiomel","html_url":"https://github.com/elethiomel","followers_url":"https://api.github.com/users/elethiomel/followers","following_url":"https://api.github.com/users/elethiomel/following{/other_user}","gists_url":"https://api.github.com/users/elethiomel/gists{/gist_id}","starred_url":"https://api.github.com/users/elethiomel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elethiomel/subscriptions","organizations_url":"https://api.github.com/users/elethiomel/orgs","repos_url":"https://api.github.com/users/elethiomel/repos","events_url":"https://api.github.com/users/elethiomel/events{/privacy}","received_events_url":"https://api.github.com/users/elethiomel/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t15:40:36z","updated_at":"2013-11-19t15:40:36z","body":"i created two new ldap users: owner and recipient. using the web interface i uploaded a file as owner. i shared it with recipient. after this, this is the result: a partial listing of my /data dir.\r\n\r\nowner/\r\nowner/files/test.txt\r\nowner/files_encryption/keyfiles/test.txt.key\r\nowner/files_encryption/share-keys/test.txt.66b9ad9e-9a9e-1032-94e7-0d3a7aa055a3.sharekey\r\nowner/files_encryption/66b9ad9e-9a9e-1032-94e7-0d3a7aa055a3.private.key\r\n\r\nrecipient/\r\nrecipient/files_encryption/486a4f98-c424-1031-84da-a322d2b5bc40.private.key\r\n\r\npublic-keys/486a4f98-c424-1031-84da-a322d2b5bc40.public.key\r\npublic-keys/66b9ad9e-9a9e-1032-94e7-0d3a7aa055a3.public.key\r\n\r\nis it correct that the users are referred to by name in some places (such as owner) and by id in others(66b9ad9e-9a9e-1032-94e7-0d3a7aa055a3)?\r\n\r\nthe file \"owner/files_encryption/keyfiles/test.txt.key\" is definitely encrypted on the server. downloading it as recipient gives me the file encrypted. all of this is through the web interface, not the client.\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28803354","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28803354","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28803354,"user":{"login":"schiesbn","id":1589737,"avatar_url":"https://gravatar.com/avatar/8912b598c7b32dd25b87fd168e0b06b2?d=https%3a%2f%2fidenticons.github.com%2f0a323047dbe8329db30eae8dbe96e55e.png&r=x","gravatar_id":"8912b598c7b32dd25b87fd168e0b06b2","url":"https://api.github.com/users/schiesbn","html_url":"https://github.com/schiesbn","followers_url":"https://api.github.com/users/schiesbn/followers","following_url":"https://api.github.com/users/schiesbn/following{/other_user}","gists_url":"https://api.github.com/users/schiesbn/gists{/gist_id}","starred_url":"https://api.github.com/users/schiesbn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schiesbn/subscriptions","organizations_url":"https://api.github.com/users/schiesbn/orgs","repos_url":"https://api.github.com/users/schiesbn/repos","events_url":"https://api.github.com/users/schiesbn/events{/privacy}","received_events_url":"https://api.github.com/users/schiesbn/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t16:14:56z","updated_at":"2013-11-19t16:15:21z","body":"when did you logged in with the recipient for the first time? before or after sharing the file? you need to login at least once so that owncloud can generate the users private/public key before you start sharing files. \r\n\r\nnow the state looks ok. both users have a private and a public key. if you try to share the file once more, what's happening then?\r\n\r\nif sharing was successful you should have two share keys:\r\n\r\nowner/files_encryption/share-keys/test.txt.66b9ad9e-9a9e-1032-94e7-0d3a7aa055a3.sharekey\r\nowner/files_encryption/share-keys/test.txt.486a4f98-c424-1031-84da-a322d2b5bc40.sharekey"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28804473","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28804473","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28804473,"user":{"login":"elethiomel","id":2545807,"avatar_url":"https://gravatar.com/avatar/cb3ee71dd10cc0a0cae2b607eb9bf71d?d=https%3a%2f%2fidenticons.github.com%2f49d6500b2bdb0492d7aef8ae9d00f211.png&r=x","gravatar_id":"cb3ee71dd10cc0a0cae2b607eb9bf71d","url":"https://api.github.com/users/elethiomel","html_url":"https://github.com/elethiomel","followers_url":"https://api.github.com/users/elethiomel/followers","following_url":"https://api.github.com/users/elethiomel/following{/other_user}","gists_url":"https://api.github.com/users/elethiomel/gists{/gist_id}","starred_url":"https://api.github.com/users/elethiomel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elethiomel/subscriptions","organizations_url":"https://api.github.com/users/elethiomel/orgs","repos_url":"https://api.github.com/users/elethiomel/repos","events_url":"https://api.github.com/users/elethiomel/events{/privacy}","received_events_url":"https://api.github.com/users/elethiomel/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t16:25:23z","updated_at":"2013-11-19t16:25:23z","body":"i did make sure to login and logout after creating the users.\r\ni do not have the two share keys :/ just the one for the owner.\r\n\r\n\r\n\r\ni just tried the following now: as owner i uploaded test2.txt and shared with recipient\r\n\r\n{\"app\":\"encryption library\",\"message\":\"\\\"486a4f98-c424-1031-84da-a322d2b5bc40\\\" is not setup for encryption\",\"level\":2,\"time\":\"2013-11-19t16:16:48+00:00\"}\r\n{\"app\":\"encryption library\",\"message\":\"sharing to these user(s) failed as they are unready for encryption:\\\"array\\n(\\n    [0] => 486a4f98-c424-1031-84da-a322d2b5bc40\\n)\\n\",\"level\":2,\"time\":\"2013-11-19t16:16:48+00:00\"}\r\n\r\nas recipient i can see the file in my share, but i get \r\n\r\n{\"app\":\"encryption library\",\"message\":\"decryption (asymmetric) of sealed content with share-key \\\"\\\" failed\",\"level\":3,\"time\":\"2013-11-19t16:18:36+00:00\"}\r\n\r\n\r\nregards,\r\n       colin"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28808113","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28808113","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28808113,"user":{"login":"schiesbn","id":1589737,"avatar_url":"https://gravatar.com/avatar/8912b598c7b32dd25b87fd168e0b06b2?d=https%3a%2f%2fidenticons.github.com%2f0a323047dbe8329db30eae8dbe96e55e.png&r=x","gravatar_id":"8912b598c7b32dd25b87fd168e0b06b2","url":"https://api.github.com/users/schiesbn","html_url":"https://github.com/schiesbn","followers_url":"https://api.github.com/users/schiesbn/followers","following_url":"https://api.github.com/users/schiesbn/following{/other_user}","gists_url":"https://api.github.com/users/schiesbn/gists{/gist_id}","starred_url":"https://api.github.com/users/schiesbn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schiesbn/subscriptions","organizations_url":"https://api.github.com/users/schiesbn/orgs","repos_url":"https://api.github.com/users/schiesbn/repos","events_url":"https://api.github.com/users/schiesbn/events{/privacy}","received_events_url":"https://api.github.com/users/schiesbn/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t16:53:35z","updated_at":"2013-11-19t16:54:28z","body":"the strange think is that we have two checks if a user is ready for sharing. the first check should block the sharing in the first place and you should get a warning in the web interface. it seems that you pass this test, otherwise the sharing wouldn't happen but than the check during the share operation fails.\r\n\r\ni don't have a ldap to test it and with the owncloud user management i can't reproduce it. but i have a idea what could be the problem. maybe you can try following, open apps/files_encryption/lib/util.php\r\n\r\nand than add after line 150 this code:\r\n```\r\n\\oc\\files\\filesystem::initmountpoints($globals['fileowner']);\r\n```\r\n\r\nand after line 165 this code:\r\n```\r\n\\oc\\files\\filesystem::initmountpoints($this->userid);\r\n```\r\n\r\nthe whole colde block should than look like this:\r\n\r\n```\r\n\t\t\tif (isset($globals['app']) && $globals['app'] === 'files_sharing') {\r\n\t\t\t\t$this->userdir = '/' . $globals['fileowner'];\r\n\t\t\t\t$this->filefoldername = 'files';\r\n\t\t\t\t$this->userfilesdir = '/' . $globals['fileowner'] . '/'\r\n\t\t\t\t\t\t\t\t\t  . $this->filefoldername; // todo: does this need to be user configurable?\r\n\t\t\t\t$this->publickeydir = '/' . 'public-keys';\r\n\t\t\t\t$this->encryptiondir = '/' . $globals['fileowner'] . '/' . 'files_encryption';\r\n\t\t\t\t$this->keyfilespath = $this->encryptiondir . '/' . 'keyfiles';\r\n\t\t\t\t$this->sharekeyspath = $this->encryptiondir . '/' . 'share-keys';\r\n\t\t\t\t$this->publickeypath =\r\n\t\t\t\t\t$this->publickeydir . '/' . $this->userid . '.public.key'; // e.g. data/public-keys/admin.public.key\r\n\t\t\t\t$this->privatekeypath =\r\n\t\t\t\t\t'/owncloud_private_key/' . $this->userid . '.private.key'; // e.g. data/admin/admin.private.key\r\n\t\t\t\t$this->ispublic = true;\r\n\t\t\t\t\\oc\\files\\filesystem::initmountpoints($globals['fileowner']);\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\t$this->userdir = '/' . $this->userid;\r\n\t\t\t$this->filefoldername = 'files';\r\n\t\t\t$this->userfilesdir =\r\n\t\t\t\t'/' . $this->userid . '/' . $this->filefoldername; // todo: does this need to be user configurable?\r\n\t\t\t$this->publickeydir = '/' . 'public-keys';\r\n\t\t\t$this->encryptiondir = '/' . $this->userid . '/' . 'files_encryption';\r\n\t\t\t$this->keyfilespath = $this->encryptiondir . '/' . 'keyfiles';\r\n\t\t\t$this->sharekeyspath = $this->encryptiondir . '/' . 'share-keys';\r\n\t\t\t$this->publickeypath =\r\n\t\t\t\t$this->publickeydir . '/' . $this->userid . '.public.key'; // e.g. data/public-keys/admin.public.key\r\n\t\t\t$this->privatekeypath =\r\n\t\t\t\t$this->encryptiondir . '/' . $this->userid . '.private.key'; // e.g. data/admin/admin.private.key\r\n\t\t\t\\oc\\files\\filesystem::initmountpoints($this->userid);\r\n\t\t}\r\n```\r\n\r\nafter that please try once more to share a file.\r\n\r\nit is just a  guess, but i remember that in same cases on ldap you need to make sure that the users home is mounted. maybe that's the problem."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28809708","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28809708","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28809708,"user":{"login":"elethiomel","id":2545807,"avatar_url":"https://gravatar.com/avatar/cb3ee71dd10cc0a0cae2b607eb9bf71d?d=https%3a%2f%2fidenticons.github.com%2f49d6500b2bdb0492d7aef8ae9d00f211.png&r=x","gravatar_id":"cb3ee71dd10cc0a0cae2b607eb9bf71d","url":"https://api.github.com/users/elethiomel","html_url":"https://github.com/elethiomel","followers_url":"https://api.github.com/users/elethiomel/followers","following_url":"https://api.github.com/users/elethiomel/following{/other_user}","gists_url":"https://api.github.com/users/elethiomel/gists{/gist_id}","starred_url":"https://api.github.com/users/elethiomel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elethiomel/subscriptions","organizations_url":"https://api.github.com/users/elethiomel/orgs","repos_url":"https://api.github.com/users/elethiomel/repos","events_url":"https://api.github.com/users/elethiomel/events{/privacy}","received_events_url":"https://api.github.com/users/elethiomel/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t17:09:51z","updated_at":"2013-11-19t17:10:36z","body":"success! as recipient i can now view the file. in owner's share-keys there's is now 2 sharekeys, 1 for owner and one for recipient. also, no error messages :)\r\n\r\n\r\nedit: i did not mount home directories. i just patched the code as you suggested "},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28810053","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28810053","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28810053,"user":{"login":"schiesbn","id":1589737,"avatar_url":"https://gravatar.com/avatar/8912b598c7b32dd25b87fd168e0b06b2?d=https%3a%2f%2fidenticons.github.com%2f0a323047dbe8329db30eae8dbe96e55e.png&r=x","gravatar_id":"8912b598c7b32dd25b87fd168e0b06b2","url":"https://api.github.com/users/schiesbn","html_url":"https://github.com/schiesbn","followers_url":"https://api.github.com/users/schiesbn/followers","following_url":"https://api.github.com/users/schiesbn/following{/other_user}","gists_url":"https://api.github.com/users/schiesbn/gists{/gist_id}","starred_url":"https://api.github.com/users/schiesbn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schiesbn/subscriptions","organizations_url":"https://api.github.com/users/schiesbn/orgs","repos_url":"https://api.github.com/users/schiesbn/repos","events_url":"https://api.github.com/users/schiesbn/events{/privacy}","received_events_url":"https://api.github.com/users/schiesbn/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t17:12:55z","updated_at":"2013-11-19t17:12:55z","body":"great! i will prepare a pull request to fix it."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/28810294","html_url":"https://github.com/owncloud/core/issues/5944#issuecomment-28810294","issue_url":"https://api.github.com/repos/owncloud/core/issues/5944","id":28810294,"user":{"login":"elethiomel","id":2545807,"avatar_url":"https://gravatar.com/avatar/cb3ee71dd10cc0a0cae2b607eb9bf71d?d=https%3a%2f%2fidenticons.github.com%2f49d6500b2bdb0492d7aef8ae9d00f211.png&r=x","gravatar_id":"cb3ee71dd10cc0a0cae2b607eb9bf71d","url":"https://api.github.com/users/elethiomel","html_url":"https://github.com/elethiomel","followers_url":"https://api.github.com/users/elethiomel/followers","following_url":"https://api.github.com/users/elethiomel/following{/other_user}","gists_url":"https://api.github.com/users/elethiomel/gists{/gist_id}","starred_url":"https://api.github.com/users/elethiomel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elethiomel/subscriptions","organizations_url":"https://api.github.com/users/elethiomel/orgs","repos_url":"https://api.github.com/users/elethiomel/repos","events_url":"https://api.github.com/users/elethiomel/events{/privacy}","received_events_url":"https://api.github.com/users/elethiomel/received_events","type":"user","site_admin":false},"created_at":"2013-11-19t17:15:04z","updated_at":"2013-11-19t17:15:04z","body":"thank you for all your help bjã¶rn!"}]