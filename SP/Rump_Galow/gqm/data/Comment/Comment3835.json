[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/19972332","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-19972332","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":19972332,"user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"created_at":"2013-06-25t12:26:12z","updated_at":"2013-06-25t12:26:12z","body":"what kind of events do you expect? access logs or \"x shared y to z\" type of logs?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/19972424","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-19972424","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":19972424,"user":{"login":"mtrichards","id":1818977,"avatar_url":"https://gravatar.com/avatar/a1655fd2e819638708ee854fa941008b?d=https%3a%2f%2fidenticons.github.com%2fa75d8baded229745ad65d43f7a7975df.png&r=x","gravatar_id":"a1655fd2e819638708ee854fa941008b","url":"https://api.github.com/users/mtrichards","html_url":"https://github.com/mtrichards","followers_url":"https://api.github.com/users/mtrichards/followers","following_url":"https://api.github.com/users/mtrichards/following{/other_user}","gists_url":"https://api.github.com/users/mtrichards/gists{/gist_id}","starred_url":"https://api.github.com/users/mtrichards/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtrichards/subscriptions","organizations_url":"https://api.github.com/users/mtrichards/orgs","repos_url":"https://api.github.com/users/mtrichards/repos","events_url":"https://api.github.com/users/mtrichards/events{/privacy}","received_events_url":"https://api.github.com/users/mtrichards/received_events","type":"user","site_admin":false},"created_at":"2013-06-25t12:28:01z","updated_at":"2013-06-25t12:28:01z","body":"well, first something under the files_sharing app i think.  really anything.\r\n\r\nthen, that x shared to y, and then that y downloaded.  what is currently supposed to be logged?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20260787","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20260787","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20260787,"user":{"login":"msrex","id":2625328,"avatar_url":"https://gravatar.com/avatar/24738c0908dad69b83af9cc534bcca80?d=https%3a%2f%2fidenticons.github.com%2ff02814cb1648a9552774c0f932619e91.png&r=x","gravatar_id":"24738c0908dad69b83af9cc534bcca80","url":"https://api.github.com/users/msrex","html_url":"https://github.com/msrex","followers_url":"https://api.github.com/users/msrex/followers","following_url":"https://api.github.com/users/msrex/following{/other_user}","gists_url":"https://api.github.com/users/msrex/gists{/gist_id}","starred_url":"https://api.github.com/users/msrex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msrex/subscriptions","organizations_url":"https://api.github.com/users/msrex/orgs","repos_url":"https://api.github.com/users/msrex/repos","events_url":"https://api.github.com/users/msrex/events{/privacy}","received_events_url":"https://api.github.com/users/msrex/received_events","type":"user","site_admin":false},"created_at":"2013-07-01t02:35:25z","updated_at":"2013-07-01t02:35:25z","body":"where are we here? any progress?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20264571","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20264571","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20264571,"user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"created_at":"2013-07-01t05:57:13z","updated_at":"2013-07-01t05:57:13z","body":"yes, fixed a bug preventing logging of sharing actions. first thing today, i will investigate why access to shared files is not logged by the files_sharing_log app but by the admin_audit app.\n\n\n\nmarkus rex <notifications@github.com> schrieb:\n\n>where are we here? any progress?\n>\n>---\n>reply to this email directly or view it on github:\n>https://github.com/owncloud/core/issues/3835#issuecomment-20260787\n\n-- \ndiese nachricht wurde von meinem android-mobiltelefon mit k-9 mail gesendet."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20288256","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20288256","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20288256,"user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"created_at":"2013-07-01t15:14:48z","updated_at":"2013-07-01t15:14:48z","body":"@mtrichards @bboule @karlitschek when testing or packaging this please make sure to use the app versions / branches corresponding to the owncloud version. i updated the enterprise master and stable5 branches to reflect the changes.\r\n\r\nthe admin_audit and files_sharing_log apps in master and stable5 now require oc5 and show version number 0.5. (yeah, i named the version _0.5_ to make it easy to check if you are dealing with the correct version for oc _5_)\r\n\r\nadmin_audit in stable45 shows version number 0.3 and requires oc version 5 (which imho is a bug).\r\nfiles_sharing_log in stable45 shows version number 0.2 and requires oc version 4.5 (which is our internal version number for oc 4.5)\r\n\r\nalso note that files_sharing_log only logs the sharing action itself in the form of\r\n```json\r\n{\"app\":\"sharing_log\",\"message\":\"user test shared \\/foo with the user admin, permissions(17): read share all\",\"level\":1,\"time\":1372688616}\r\n{\"app\":\"sharing_log\",\"message\":\"user test shared \\/foo with the group admin, permissions(17): read share\",\"level\":1,\"time\":1372689014}\r\n{\"app\":\"sharing_log\",\"message\":\"user test shared \\\"\\/foo\\\" with the user admin, permissions: read share\",\"level\":1,\"time\":1372689647}\r\n{\"app\":\"sharing_log\",\"message\":\"user test shared \\\"\\/foo\\\" with a public link, token=6646bb9a191e073e70f0f6b02340bf79, permissions: read\",\"level\":1,\"time\":1372689658}\r\n```\r\nlogging the permissions is a new feature.\r\n\r\nfile access is logged by the admin_audit app:\r\n```json\r\n{\"app\":\"admin_audit\",\"message\":\"rename \\\"\\/test\\/files\\/shared\\/folder\\/foo.txt\\\" to \\\"\\/test\\/files\\/shared\\/folder\\/baz.txt\\\" by user test, owner: admin\",\"level\":1,\"time\":1372686515}\r\n{\"app\":\"admin_audit\",\"message\":\"read \\\"\\/test\\/files\\/shared\\/folder\\/bla.txt\\\" by user test, owner: admin\",\"level\":1,\"time\":1372687627}\r\n{\"app\":\"admin_audit\",\"message\":\"create \\\"\\/test\\/files\\/foo\\\" by user test, owner: test\",\"level\":1,\"time\":1372687735}\r\n{\"app\":\"admin_audit\",\"message\":\"write \\\"\\/test\\/files\\/foo\\\" by user test, owner: test\",\"level\":1,\"time\":1372687735}\r\n```\r\ni now resolve the absolute path of files, otherwise it might not be possible to distinguish the owner of a file. furthermore, the original owner will be logged if it differs from the user accessing the file. if the user accesing is unknown (eg. for public links) the ip of the client is logged ($_server['remote_addr'] might be a problem behind a reverse proxy, but we can leave that for later).\r\n\r\n@mtgap could you also fire the post_sharing hook when setting the permissions so we can log when a user allows write permission for a folder? i had a quick look at sharing setpermission() but figured it would be safer if you added hooks to that code.\r\n\r\ntested with web ui and cadever for webdav"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20347071","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20347071","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20347071,"user":{"login":"mtgap","id":1097106,"avatar_url":"https://gravatar.com/avatar/454a73ee5feeb428d0c163a48903332c?d=https%3a%2f%2fidenticons.github.com%2f52d29a66f285a1d61125dd69ac0766b2.png&r=x","gravatar_id":"454a73ee5feeb428d0c163a48903332c","url":"https://api.github.com/users/mtgap","html_url":"https://github.com/mtgap","followers_url":"https://api.github.com/users/mtgap/followers","following_url":"https://api.github.com/users/mtgap/following{/other_user}","gists_url":"https://api.github.com/users/mtgap/gists{/gist_id}","starred_url":"https://api.github.com/users/mtgap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtgap/subscriptions","organizations_url":"https://api.github.com/users/mtgap/orgs","repos_url":"https://api.github.com/users/mtgap/repos","events_url":"https://api.github.com/users/mtgap/events{/privacy}","received_events_url":"https://api.github.com/users/mtgap/received_events","type":"user","site_admin":false},"created_at":"2013-07-02t14:02:10z","updated_at":"2013-07-02t14:02:10z","body":"@butonic you want a post_sharing hook in setpermissions()? that doesn't make much sense. do you want it in stable5?\r\n\r\nthe logs don't look professional because there are many inconsistencies and don't read well.\r\n\r\n\"by user test, owner: admin\" - why is there a colon after owner, but not user?\r\n\"permissions: read share\" - there's no need for these to be in caps, and there should probably be commas\r\n\"token=6646bb9a191e073e70f0f6b02340bf79:\" - before you were using colons, now an equals sign?\r\n\r\nit probably would make more sense to write the admin audit logs in the same form as the sharing logs: \"user test renamed ...\" and i think we should only show owner if it is different from the user.\r\n\r\n\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20525635","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20525635","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20525635,"user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"created_at":"2013-07-05t15:50:19z","updated_at":"2013-07-05t15:50:19z","body":"@mtgap a post_permissions hook is necessary because otherwise the files_sharing_log cannot log events that add write or delete permissions. how do we log when a user enables the new anonymous upload feature?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20525838","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20525838","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20525838,"user":{"login":"mtgap","id":1097106,"avatar_url":"https://gravatar.com/avatar/454a73ee5feeb428d0c163a48903332c?d=https%3a%2f%2fidenticons.github.com%2f52d29a66f285a1d61125dd69ac0766b2.png&r=x","gravatar_id":"454a73ee5feeb428d0c163a48903332c","url":"https://api.github.com/users/mtgap","html_url":"https://github.com/mtgap","followers_url":"https://api.github.com/users/mtgap/followers","following_url":"https://api.github.com/users/mtgap/following{/other_user}","gists_url":"https://api.github.com/users/mtgap/gists{/gist_id}","starred_url":"https://api.github.com/users/mtgap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtgap/subscriptions","organizations_url":"https://api.github.com/users/mtgap/orgs","repos_url":"https://api.github.com/users/mtgap/repos","events_url":"https://api.github.com/users/mtgap/events{/privacy}","received_events_url":"https://api.github.com/users/mtgap/received_events","type":"user","site_admin":false},"created_at":"2013-07-05t15:54:30z","updated_at":"2013-07-05t15:54:30z","body":"i was just pointing out the fact that you originally said post_sharing. which branch do i put it in?\r\n\r\nany thoughts on my comments on the messages?"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20526977","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20526977","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20526977,"user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"created_at":"2013-07-05t16:15:09z","updated_at":"2013-07-05t16:15:09z","body":"sure, will try to be more specific with the hook name next time. i think master and stable 5 should be enough.\r\n\r\nfeel free to alter the log messages. i wanted to make them easily grepable, which is why i always log the owner. otherwise i would have to cut the user out of the path ... a dirty hack imho, but maybe there is a method in the filesystem or view that easily gives me the owner of a share when logging access to public shares with the admin_audit app. without the original owner of a file it is not possible to find the cause for a possible leak ;)\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/20847982","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-20847982","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":20847982,"user":{"login":"mtrichards","id":1818977,"avatar_url":"https://gravatar.com/avatar/a1655fd2e819638708ee854fa941008b?d=https%3a%2f%2fidenticons.github.com%2fa75d8baded229745ad65d43f7a7975df.png&r=x","gravatar_id":"a1655fd2e819638708ee854fa941008b","url":"https://api.github.com/users/mtrichards","html_url":"https://github.com/mtrichards","followers_url":"https://api.github.com/users/mtrichards/followers","following_url":"https://api.github.com/users/mtrichards/following{/other_user}","gists_url":"https://api.github.com/users/mtrichards/gists{/gist_id}","starred_url":"https://api.github.com/users/mtrichards/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtrichards/subscriptions","organizations_url":"https://api.github.com/users/mtrichards/orgs","repos_url":"https://api.github.com/users/mtrichards/repos","events_url":"https://api.github.com/users/mtrichards/events{/privacy}","received_events_url":"https://api.github.com/users/mtrichards/received_events","type":"user","site_admin":false},"created_at":"2013-07-11t22:44:18z","updated_at":"2013-07-11t22:44:18z","body":"did this get merged in time for 5 ee rc4? i don't see any of these awesome messages in the audit and sharing logs any more.\r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/23856617","html_url":"https://github.com/owncloud/core/issues/3835#issuecomment-23856617","issue_url":"https://api.github.com/repos/owncloud/core/issues/3835","id":23856617,"user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"created_at":"2013-09-05t09:53:38z","updated_at":"2013-09-05t09:53:38z","body":"@mtrichards has been backported in https://github.com/owncloud/core/commit/810e718eb86f20aa0d28fd47b14f24b2549381b5 and is used by the enterprise logging app. closing this."}]