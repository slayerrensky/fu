[{"url":"https://api.github.com/repos/owncloud/core/issues/comments/30084828","html_url":"https://github.com/owncloud/core/issues/6239#issuecomment-30084828","issue_url":"https://api.github.com/repos/owncloud/core/issues/6239","id":30084828,"user":{"login":"kabum","id":245432,"avatar_url":"https://gravatar.com/avatar/a1dea19f88f38ea0b5b5b4d19d5b3107?d=https%3a%2f%2fidenticons.github.com%2f53d8cbb3dbc087a02951dec47438ccdf.png&r=x","gravatar_id":"a1dea19f88f38ea0b5b5b4d19d5b3107","url":"https://api.github.com/users/kabum","html_url":"https://github.com/kabum","followers_url":"https://api.github.com/users/kabum/followers","following_url":"https://api.github.com/users/kabum/following{/other_user}","gists_url":"https://api.github.com/users/kabum/gists{/gist_id}","starred_url":"https://api.github.com/users/kabum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kabum/subscriptions","organizations_url":"https://api.github.com/users/kabum/orgs","repos_url":"https://api.github.com/users/kabum/repos","events_url":"https://api.github.com/users/kabum/events{/privacy}","received_events_url":"https://api.github.com/users/kabum/received_events","type":"user","site_admin":false},"created_at":"2013-12-08t16:21:51z","updated_at":"2013-12-08t16:21:51z","body":"cc @blizzz \r\n"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/30121532","html_url":"https://github.com/owncloud/core/issues/6239#issuecomment-30121532","issue_url":"https://api.github.com/repos/owncloud/core/issues/6239","id":30121532,"user":{"login":"blizzz","id":2184312,"avatar_url":"https://gravatar.com/avatar/1898b25a9cb3aa1a0f0febd1359910b9?d=https%3a%2f%2fidenticons.github.com%2fca03acec6deadf508b75eb0cf9ba036c.png&r=x","gravatar_id":"1898b25a9cb3aa1a0f0febd1359910b9","url":"https://api.github.com/users/blizzz","html_url":"https://github.com/blizzz","followers_url":"https://api.github.com/users/blizzz/followers","following_url":"https://api.github.com/users/blizzz/following{/other_user}","gists_url":"https://api.github.com/users/blizzz/gists{/gist_id}","starred_url":"https://api.github.com/users/blizzz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blizzz/subscriptions","organizations_url":"https://api.github.com/users/blizzz/orgs","repos_url":"https://api.github.com/users/blizzz/repos","events_url":"https://api.github.com/users/blizzz/events{/privacy}","received_events_url":"https://api.github.com/users/blizzz/received_events","type":"user","site_admin":false},"created_at":"2013-12-09t10:39:55z","updated_at":"2013-12-09t10:39:55z","body":"> i'll do some more investigations tomorrow...\r\n\r\nok, keep us posted."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/30128776","html_url":"https://github.com/owncloud/core/issues/6239#issuecomment-30128776","issue_url":"https://api.github.com/repos/owncloud/core/issues/6239","id":30128776,"user":{"login":"leo-b","id":6097948,"avatar_url":"https://gravatar.com/avatar/844a5ac2f89dedf54bb173a0134b7b0f?d=https%3a%2f%2fidenticons.github.com%2f8409df19eb5f9a5705dcc6e9916a867e.png&r=x","gravatar_id":"844a5ac2f89dedf54bb173a0134b7b0f","url":"https://api.github.com/users/leo-b","html_url":"https://github.com/leo-b","followers_url":"https://api.github.com/users/leo-b/followers","following_url":"https://api.github.com/users/leo-b/following{/other_user}","gists_url":"https://api.github.com/users/leo-b/gists{/gist_id}","starred_url":"https://api.github.com/users/leo-b/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leo-b/subscriptions","organizations_url":"https://api.github.com/users/leo-b/orgs","repos_url":"https://api.github.com/users/leo-b/repos","events_url":"https://api.github.com/users/leo-b/events{/privacy}","received_events_url":"https://api.github.com/users/leo-b/received_events","type":"user","site_admin":false},"created_at":"2013-12-09t12:40:50z","updated_at":"2013-12-09t12:40:50z","body":"on 12/09/2013 11:40 am, blizzz wrote:\n>     i'll do some more investigations tomorrow...\n> \n> ok, keep us posted.\n\nok, that's what i have found out so far:\n\n- postfunctioncall should not be called after every ldap_* function.\nsome ldap_* functions don't seem to reset the error, so ldap_errno\nshould only be evaluated if the corresponding function really returned\nerror.\ne.g. if ldap_search returns \"size limit exceeded\", ldap_errno will\nremain at this error for several other functions that operate in this\nsearch context (e.g. ldap_count_entries, ldap_first_entry,\nldap_get_attributes, ldap_get_dn)\n\nafter a quick look at ldap.php, invokeldapmethod() should only call\npostfunctioncall(), if the ldap_* call returned false, since all of the\nldap_* functions used return false on failure.\nfor ldap_next_entry, false only indicates that the last entry had been\nreached, so this shouldn't be wrapped by invokeldapmethod(). for\nldap_sort and ldap_start_tls, the return value isn't documented.\n\n\n- after doing paged searches, the search controls should be reset before\ndoing another ldap search related operation to avoid an \"operations\nerror\". (including operations like ldap_read_attribute, which are\ninternally implemented as search operations.) in oc 6.0.0, this seems to\nbe done by $this->initpagedsearch($filter, array($dn), $attr, 99999, 0).\nhowever, this is quite error prone. in fact paging should be reset\n_after_ every search that initialized paging, not _before_ the next\noperation that might use a search is called.\nbesides, i think that resetting should be done by setting pagesize to 0,\nnot to 99999, since setting it to 99999 will imho initialize another\npaged search, which will waste resources. see an example in the comments at:\nhttp://at1.php.net/manual/en/function.ldap-control-paged-result.php\n\ni made good experiences with calling\n\t\tif ($pagedsearchok) {\n\t\t  $this->ldap->controlpagedresult($link_resource, 0, false, \"\");\n\t\t}\n... after the search in access::search().\n\n\ncheers,\n--leo\n-- \ne-mail   ::: leo.bergolth (at) wu.ac.at\nfax      ::: +43-1-31336-906050\nlocation ::: it-services | vienna university of economics | austria"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/30233637","html_url":"https://github.com/owncloud/core/issues/6239#issuecomment-30233637","issue_url":"https://api.github.com/repos/owncloud/core/issues/6239","id":30233637,"user":{"login":"leo-b","id":6097948,"avatar_url":"https://gravatar.com/avatar/844a5ac2f89dedf54bb173a0134b7b0f?d=https%3a%2f%2fidenticons.github.com%2f8409df19eb5f9a5705dcc6e9916a867e.png&r=x","gravatar_id":"844a5ac2f89dedf54bb173a0134b7b0f","url":"https://api.github.com/users/leo-b","html_url":"https://github.com/leo-b","followers_url":"https://api.github.com/users/leo-b/followers","following_url":"https://api.github.com/users/leo-b/following{/other_user}","gists_url":"https://api.github.com/users/leo-b/gists{/gist_id}","starred_url":"https://api.github.com/users/leo-b/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leo-b/subscriptions","organizations_url":"https://api.github.com/users/leo-b/orgs","repos_url":"https://api.github.com/users/leo-b/repos","events_url":"https://api.github.com/users/leo-b/events{/privacy}","received_events_url":"https://api.github.com/users/leo-b/received_events","type":"user","site_admin":false},"created_at":"2013-12-10t14:57:04z","updated_at":"2013-12-10t15:34:49z","body":"the \"operations error\" messages appear because the wizard doesn't use \\oca\\user_ldap\\lib\\connection() but establishes its own connection in wizard::getconnection().\r\nhere $this->ldap->setoption($cr, ldap_opt_referrals, 0) is missing.\r\n\r\nwithout this option, search operations that use the root of an ad domain as base will fail with an \"operations error\":\r\nhttp://blog.redbranch.net/2008/05/27/php-ldap-search-root-of-active-directory/"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/30248027","html_url":"https://github.com/owncloud/core/issues/6239#issuecomment-30248027","issue_url":"https://api.github.com/repos/owncloud/core/issues/6239","id":30248027,"user":{"login":"leo-b","id":6097948,"avatar_url":"https://gravatar.com/avatar/844a5ac2f89dedf54bb173a0134b7b0f?d=https%3a%2f%2fidenticons.github.com%2f8409df19eb5f9a5705dcc6e9916a867e.png&r=x","gravatar_id":"844a5ac2f89dedf54bb173a0134b7b0f","url":"https://api.github.com/users/leo-b","html_url":"https://github.com/leo-b","followers_url":"https://api.github.com/users/leo-b/followers","following_url":"https://api.github.com/users/leo-b/following{/other_user}","gists_url":"https://api.github.com/users/leo-b/gists{/gist_id}","starred_url":"https://api.github.com/users/leo-b/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leo-b/subscriptions","organizations_url":"https://api.github.com/users/leo-b/orgs","repos_url":"https://api.github.com/users/leo-b/repos","events_url":"https://api.github.com/users/leo-b/events{/privacy}","received_events_url":"https://api.github.com/users/leo-b/received_events","type":"user","site_admin":false},"created_at":"2013-12-10t17:20:59z","updated_at":"2013-12-10t17:20:59z","body":"see https://github.com/owncloud/core/pull/6297"},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/30272049","html_url":"https://github.com/owncloud/core/issues/6239#issuecomment-30272049","issue_url":"https://api.github.com/repos/owncloud/core/issues/6239","id":30272049,"user":{"login":"blizzz","id":2184312,"avatar_url":"https://gravatar.com/avatar/1898b25a9cb3aa1a0f0febd1359910b9?d=https%3a%2f%2fidenticons.github.com%2fca03acec6deadf508b75eb0cf9ba036c.png&r=x","gravatar_id":"1898b25a9cb3aa1a0f0febd1359910b9","url":"https://api.github.com/users/blizzz","html_url":"https://github.com/blizzz","followers_url":"https://api.github.com/users/blizzz/followers","following_url":"https://api.github.com/users/blizzz/following{/other_user}","gists_url":"https://api.github.com/users/blizzz/gists{/gist_id}","starred_url":"https://api.github.com/users/blizzz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blizzz/subscriptions","organizations_url":"https://api.github.com/users/blizzz/orgs","repos_url":"https://api.github.com/users/blizzz/repos","events_url":"https://api.github.com/users/blizzz/events{/privacy}","received_events_url":"https://api.github.com/users/blizzz/received_events","type":"user","site_admin":false},"created_at":"2013-12-10t21:54:32z","updated_at":"2013-12-10t21:54:32z","body":"thanks for investigating it and the pr! i had issues with openldap when reseting a paged search, that was the best i could find. i will try it again, maybe i oversaw something."},{"url":"https://api.github.com/repos/owncloud/core/issues/comments/30601139","html_url":"https://github.com/owncloud/core/issues/6239#issuecomment-30601139","issue_url":"https://api.github.com/repos/owncloud/core/issues/6239","id":30601139,"user":{"login":"ryantate13","id":5678247,"avatar_url":"https://gravatar.com/avatar/760b227238f6bb1ed6a61680d62df97e?d=https%3a%2f%2fidenticons.github.com%2ffa666e54557f4d15f90000ec8319aff8.png&r=x","gravatar_id":"760b227238f6bb1ed6a61680d62df97e","url":"https://api.github.com/users/ryantate13","html_url":"https://github.com/ryantate13","followers_url":"https://api.github.com/users/ryantate13/followers","following_url":"https://api.github.com/users/ryantate13/following{/other_user}","gists_url":"https://api.github.com/users/ryantate13/gists{/gist_id}","starred_url":"https://api.github.com/users/ryantate13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryantate13/subscriptions","organizations_url":"https://api.github.com/users/ryantate13/orgs","repos_url":"https://api.github.com/users/ryantate13/repos","events_url":"https://api.github.com/users/ryantate13/events{/privacy}","received_events_url":"https://api.github.com/users/ryantate13/received_events","type":"user","site_admin":false},"created_at":"2013-12-15t09:37:53z","updated_at":"2013-12-15t09:37:53z","body":"this fixes the problem:\r\nlines 794 through 800 of owncloud/apps/user_ldap/lib/wizard.php should read:\r\n\r\n\t\t//set ldap options\r\n\t\t$a = $this->ldap->setoption($cr, ldap_opt_protocol_version, 3);\r\n\t\t$b = $this->ldap->setoption($cr, ldap_opt_referrals, 0);\r\n\t\t$c = $this->ldap->setoption($cr, ldap_opt_network_timeout, self::ldap_nw_timeout);\r\n\t\tif($tls) {\r\n\t\t\t$this->ldap->starttls($cr);\r\n\t\t}"}]