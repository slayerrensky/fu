{"url":"https://api.github.com/repos/owncloud/core/issues/5596","labels_url":"https://api.github.com/repos/owncloud/core/issues/5596/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/5596/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/5596/events","html_url":"https://github.com/owncloud/core/issues/5596","id":21746575,"number":5596,"title":"local file repeatedly overwritten by owncloud without a conflict file","user":{"login":"naag","id":416860,"avatar_url":"https://gravatar.com/avatar/3500e960900cf992e489d5d23a95db3e?d=https%3a%2f%2fidenticons.github.com%2ff74e42503a7fa57d097087aba7437172.png&r=x","gravatar_id":"3500e960900cf992e489d5d23a95db3e","url":"https://api.github.com/users/naag","html_url":"https://github.com/naag","followers_url":"https://api.github.com/users/naag/followers","following_url":"https://api.github.com/users/naag/following{/other_user}","gists_url":"https://api.github.com/users/naag/gists{/gist_id}","starred_url":"https://api.github.com/users/naag/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/naag/subscriptions","organizations_url":"https://api.github.com/users/naag/orgs","repos_url":"https://api.github.com/users/naag/repos","events_url":"https://api.github.com/users/naag/events{/privacy}","received_events_url":"https://api.github.com/users/naag/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"open","assignee":null,"milestone":null,"comments":4,"created_at":"2013-10-29t10:01:07z","updated_at":"2013-11-14t09:48:06z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"we have a group of 5 people working on documents in a shared folder. the owner (user3_office in the logs below) shared that folder with write permissions to all participants. it contains 11 gb in ~4.200 files. the owner initially uploaded all the files while the others just updated some files later.\r\n\r\nin particular, one user (user1_home and user1_office below) was working on a word document for several days from her home computer. then she returned to the office, her client synced the latest state of the file and she continued working. a few hours later however, it seems that owncloud started to overwrite her local changes with an older version again and again. the timestamp of her file file kept coming back to 22/oct/2013:12:14:24.\r\n\r\nthis lead to a data loss unfortunately, because her local file was reset to an older state before the new version was ever uploaded to the server. all i can see is get requests. for a strange reason, we also don't see a conflict file on her computer. this starts at 22/oct/2013:13:12:03 (ips below replaced):\r\n\r\n```\r\n...\r\nuser1_home - - [21/oct/2013:15:14:25 +0200] \"put /remote.php/webdav/shared/foo.docx http/1.1\" 204 447 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_home - - [21/oct/2013:15:14:28 +0200] \"proppatch /remote.php/webdav/shared/foo.docx http/1.1\" 207 884 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_home - - [21/oct/2013:15:14:28 +0200] \"propfind /remote.php/webdav/shared/foo.docx http/1.1\" 207 1067 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser2_office - - [21/oct/2013:15:15:05 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 614305 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_home - - [21/oct/2013:15:29:30 +0200] \"put /remote.php/webdav/shared/foo.docx http/1.1\" 204 447 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_home - - [21/oct/2013:15:29:38 +0200] \"proppatch /remote.php/webdav/shared/foo.docx http/1.1\" 207 884 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_home - - [21/oct/2013:15:29:39 +0200] \"propfind /remote.php/webdav/shared/foo.docx http/1.1\" 207 1067 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser2_office - - [21/oct/2013:15:30:10 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615559 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:08:52:35 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615559 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser4_office - - [22/oct/2013:09:59:29 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615559 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser3_office - - [22/oct/2013:10:20:24 +0200] \"get /remote.php/webdav/foo.docx http/1.1\" 200 615559 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:11:55:14 +0200] \"put /remote.php/webdav/shared/foo.docx http/1.1\" 204 447 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:11:55:16 +0200] \"proppatch /remote.php/webdav/shared/foo.docx http/1.1\" 207 884 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:11:55:16 +0200] \"propfind /remote.php/webdav/shared/foo.docx http/1.1\" 207 1067 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser4_office - - [22/oct/2013:11:55:22 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615291 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser2_office - - [22/oct/2013:11:55:55 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615291 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:11:57:55 +0200] \"put /remote.php/webdav/shared/foo.docx http/1.1\" 204 447 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:11:57:56 +0200] \"proppatch /remote.php/webdav/shared/foo.docx http/1.1\" 207 884 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:11:57:57 +0200] \"propfind /remote.php/webdav/shared/foo.docx http/1.1\" 207 1067 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser4_office - - [22/oct/2013:11:58:03 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615167 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser2_office - - [22/oct/2013:11:58:29 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615167 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\n... (continues like this) ...\r\nuser1_office - - [22/oct/2013:12:14:24 +0200] \"put /remote.php/webdav/shared/foo.docx http/1.1\" 204 447 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:12:14:26 +0200] \"proppatch /remote.php/webdav/shared/foo.docx http/1.1\" 207 884 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:12:14:26 +0200] \"propfind /remote.php/webdav/shared/foo.docx http/1.1\" 207 1067 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser2_office - - [22/oct/2013:12:14:46 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser4_office - - [22/oct/2013:12:14:58 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser3_office - - [22/oct/2013:12:19:29 +0200] \"get /remote.php/webdav/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser4_office - - [22/oct/2013:13:03:18 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser2_office - - [22/oct/2013:13:03:49 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:04:12 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser3_office - - [22/oct/2013:13:10:08 +0200] \"get /remote.php/webdav/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:12:03 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:12:42 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:13:22 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:14:02 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:14:43 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:15:23 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:16:03 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:16:44 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:17:24 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\nuser1_office - - [22/oct/2013:13:18:04 +0200] \"get /remote.php/webdav/shared/foo.docx http/1.1\" 200 615865 \"-\" \"mozilla/5.0 (windows) csyncoc/0.90.2 neon/0.29.6\"\r\n... (continues like this) ...\r\n```\r\n\r\nyou can see that starting from 22/oct/2013:13:12:03, user1_office kept on getting the same file again and again. sometimes there's also a redownload of the same file by other clients, but because user1 was the only one working on the files, the others users didn't see any data loss.\r\n\r\nwe don't have any client logs available unfortunately. while the redownload issue is slightly annoying to our team, but not critical, the data loss issue is a showstopper. we would really like to support in debugging, if we had any direction in which to research.\r\n\r\nwe run owncloud 5.0.12 from http://download.opensuse.org/repositories/isv:owncloud:community/debian_7.0/ on debian wheezy with apache 2.2.22, php 5.4.4 (including apc 3.1.13) and mysql. full phpinfo() can be found at https://dl.dropboxusercontent.com/u/60770322/phpinfo.html. client was using windows with oc sync client 1.4.1.\r\n\r\nin case this could be related, we were running into some php out-of-memory issues and also apache segfaults during that time (having \"memory_limit = 512m\".....). after deactivating a few apps like \"media\", \"odf viewer\", \"pdf viewer\", \"pictures\" and \"text editor\", we didn't see any more out-of-memory issues and also no more segfaults by apache. relevant log entries at http://pastebin.com/xpsyszsc and http://pastebin.com/0gxbpsnt. could it be that those crashes confused the sync client?\r\n\r\nthanks for the support!","closed_by":null}