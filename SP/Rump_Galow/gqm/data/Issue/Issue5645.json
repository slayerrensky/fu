{"url":"https://api.github.com/repos/owncloud/core/issues/5645","labels_url":"https://api.github.com/repos/owncloud/core/issues/5645/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/5645/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/5645/events","html_url":"https://github.com/owncloud/core/issues/5645","id":21886126,"number":5645,"title":"[oc6beta2] multiuser edit does not see the last editor leave","user":{"login":"sndrr","id":5821198,"avatar_url":"https://gravatar.com/avatar/4336e6bc7c8e725c679dcb7b1007ea8e?d=https%3a%2f%2fidenticons.github.com%2fe09f7a6fa09c16c17747fe2c0e321179.png&r=x","gravatar_id":"4336e6bc7c8e725c679dcb7b1007ea8e","url":"https://api.github.com/users/sndrr","html_url":"https://github.com/sndrr","followers_url":"https://api.github.com/users/sndrr/followers","following_url":"https://api.github.com/users/sndrr/following{/other_user}","gists_url":"https://api.github.com/users/sndrr/gists{/gist_id}","starred_url":"https://api.github.com/users/sndrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sndrr/subscriptions","organizations_url":"https://api.github.com/users/sndrr/orgs","repos_url":"https://api.github.com/users/sndrr/repos","events_url":"https://api.github.com/users/sndrr/events{/privacy}","received_events_url":"https://api.github.com/users/sndrr/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":4,"created_at":"2013-10-31t09:58:41z","updated_at":"2013-10-31t11:15:16z","closed_at":"2013-10-31t11:06:37z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\nwhen editing a document with more than one user, the user that edited the document last, may leave the discussion first without leaving the second user with a unclosable document.\r\nafter pressing the close button in the upper right hand corner in edit view, the document should close, and i would go back to the (document) files view.\r\n\r\n### actual behaviour\r\nuser1 edits the document last, and closes the document. user2 does not see user1 leave, and when user2 presses the close button, the document stays open with user1 there.\r\nuser2 can only use  the browser's back button to get back to the files view.\r\n\r\n### steps to reproduce\r\n1. open a shared document as user1\r\n2. open the shared document of user1 as user2\r\n3. user1 edits the document and closes the document.\r\n4. user2 cannot close the document, since user1 stays active.\r\n\r\n### server configuration\r\noperating system: debian squeeze (6.0.8), kernel 3.2.13\r\n\r\nweb server: apache/2.2.16 (debian\r\n\r\ndatabase: mysql  ver 14.14 distrib 5.1.72, for debian-linux-gnu (x86_64) using readline 6.1\r\n\r\nphp version: php 5.3.3-7+squeeze17 with suhosin-patch (cli)\r\n\r\nowncloud version: oc6 beta2\r\n\r\n### client configuration\r\nbrowser: firefox 25.0\r\n\r\noperating system: windows xp\r\n\r\n### logs\r\n#### web server error log\r\ndon't know if that's relevant, but i can post it later.\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n{\"app\":\"core\",\"message\":\"redirecttodefaultpage: https:\\/\\/owncloud6\\/owncloud\\/index.php\\/apps\\/files\",\"level\":0,\"time\":\"2013-10-31t09:08:25+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:10:27+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:10:43+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:16:43+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:16:54+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:21:56+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:22:00+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:23:43+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:23:50+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:26:59+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:27:02+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:27:15+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:28:21+00:00\"}\r\n{\"app\":\"documents\",\"message\":\"error. session no longer exists. no valid file has been passed\",\"level\":2,\"time\":\"2013-10-31t09:28:25+00:00\"}\r\n```\r\n\r\n#### browser log\r\nuser1:\r\n```\r\n[10:27:47.391] get https://owncloud6/owncloud/index.php/apps/documents#36 [http/1.1 200 connection established 471ms]\r\n[10:27:48.035] get https://owncloud6/owncloud/remote.php/core.css?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 304 not modified 430ms]\r\n[10:27:48.038] get https://owncloud6/owncloud/index.php/apps/documents/css/style.css?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 200 connection established 500ms]\r\n[10:27:48.040] get https://owncloud6/owncloud/index.php/apps/documents/css/3rdparty/webodf/dojo-app.css?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 200 connection established 1522ms]\r\n[10:27:48.043] get https://owncloud6/owncloud/index.php/apps/documents/css/3rdparty/webodf/editor.css?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 200 connection established 811ms]\r\n[10:27:48.044] get https://owncloud6/owncloud/index.php/core/js/config.js?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 200 connection established 1191ms]\r\n[10:27:48.046] get https://owncloud6/owncloud/remote.php/core.js?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 200 connection established 1091ms]\r\n[10:27:48.048] get https://owncloud6/owncloud/apps/documents/js/documents.js?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 304 not modified 450ms]\r\n[10:27:48.050] get https://owncloud6/owncloud/apps/files/js/file-upload.js?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 304 not modified 470ms]\r\n[10:27:48.052] get https://owncloud6/owncloud/apps/files/js/jquery.iframe-transport.js?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 304 not modified 490ms]\r\n[10:27:48.054] get https://owncloud6/owncloud/apps/files/js/jquery.fileupload.js?v=7acba01022004f2ce03bf56ca56ec6f4 [http/1.1 304 not modified 510ms]\r\n[10:27:49.677] get https://owncloud6/owncloud/index.php/apps/documents/js/3rdparty/resources/dojo/resources/dojo.css [http/1.1 304 not modified 381ms]\r\n[10:27:49.678] get https://owncloud6/owncloud/index.php/apps/documents/js/3rdparty/resources/dijit/themes/claro/claro.css [http/1.1 304 not modified 651ms]\r\n[10:27:49.680] get https://owncloud6/owncloud/index.php/apps/documents/js/3rdparty/resources/dojox/layout/resources/expandopane.css [http/1.1 304 not modified 1222ms]\r\n[10:27:49.681] get https://owncloud6/owncloud/index.php/apps/documents/js/3rdparty/resources/dojox/widget/colorpicker/colorpicker.css [http/1.1 304 not modified 941ms]\r\n[10:27:51.033] content security policy: directive inline script base restriction violated @ https://owncloud6/owncloud/index.php/apps/documents#36\r\n[10:27:51.851] post https://owncloud6/owncloud/index.php/core/ajax/translations.php [http/1.1 200 ok 371ms]\r\n[10:27:51.853] get https://owncloud6/owncloud/index.php/core/routes.json [http/1.1 304 not modified 641ms]\r\n[10:27:51.766] use of getpreventdefault() is deprecated.  use defaultprevented instead. @ https://owncloud6/owncloud/remote.php/core.js?v=7acba01022004f2ce03bf56ca56ec6f4:50\r\n[10:27:52.009] get https://owncloud6/owncloud/cron.php [http/1.1 200 ok 901ms]\r\n[10:27:52.011] get https://owncloud6/owncloud/apps/documents/js/3rdparty/webodf/dojo-amalgamation.js?_=1383211670936 [http/1.1 200 ok 210ms]\r\n[10:27:52.012] get https://owncloud6/owncloud/index.php/avatar/sander/32?requesttoken=5f8d2cfd003ddd26a170 [http/1.1 200 ok 1712ms]\r\n[10:27:52.014] get https://owncloud6/owncloud/index.php/avatar/sander/128?requesttoken=5f8d2cfd003ddd26a170 [http/1.1 200 ok 731ms]\r\n[10:27:52.482] get https://owncloud6/owncloud/index.php/apps/documents/ajax/documents/list [http/1.1 200 ok 771ms]\r\n[10:27:52.484] get https://owncloud6/owncloud/apps/documents/js/3rdparty/webodf/webodf-debug.js?_=1383211670937 [http/1.1 200 ok 190ms]\r\n[10:27:52.787] get https://owncloud6/owncloud/index.php/apps/documents/css/fonts.css [http/1.1 304 not modified 620ms]\r\n[10:27:53.491] post https://owncloud6/owncloud/index.php/apps/documents/ajax/session/joinasuser/36 [http/1.1 200 ok 741ms]\r\n[10:27:54.474] use of getattributenode() is deprecated. use getattribute() instead. @ https://owncloud6/owncloud/remote.php/core.js?v=7acba01022004f2ce03bf56ca56ec6f4:161\r\n[10:27:54.553] use of attributes' specified attribute is deprecated. it always returns true. @ https://owncloud6/owncloud/remote.php/core.js?v=7acba01022004f2ce03bf56ca56ec6f4:161\r\n[10:27:55.177] head https://owncloud6/owncloud/index.php/apps/documents/ajax/genesis/aa57646af1125a798b6db4fad4e321 [http/1.1 200 ok 361ms]\r\n[10:27:55.354] get https://owncloud6/owncloud/index.php/apps/documents/ajax/genesis/aa57646af1125a798b6db4fad4e321 [http/1.1 200 ok 401ms]\r\n[10:27:55.848] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 411ms]\r\n[10:27:56.671] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 370ms]\r\n[10:27:56.968] get https://owncloud6/owncloud/index.php/avatar/demo/60?requesttoken=5f8d2cfd003ddd26a170 [http/1.1 200 ok 370ms]\r\n[10:27:56.971] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 661ms]\r\n[10:27:57.709] get https://owncloud6/owncloud/index.php/avatar/sander/60?requesttoken=5f8d2cfd003ddd26a170 [http/1.1 200 ok 360ms]\r\n[10:27:59.421] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 401ms]\r\n[10:28:04.440] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 481ms]\r\n[10:28:07.940] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 551ms]\r\n[10:28:09.872] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 411ms]\r\n[10:28:10.344] post https://owncloud6/owncloud/index.php/apps/documents/ajax/session/save [http/1.1 200 ok 440ms]\r\n[10:28:11.276] post https://owncloud6/owncloud/index.php/apps/documents/ajax/user/disconnect/37 [http/1.1 200 ok 371ms]\r\n[10:28:11.278] get https://owncloud6/owncloud/index.php/apps/documents/ajax/documents/list [http/1.1 200 ok 671ms]\r\n[10:42:52.473] post https://owncloud6/owncloud/index.php/heartbeat [http/1.1 200 connection established 490ms]\r\n```\r\n\r\nuser2:\r\n```\r\n[10:27:30.293] post https://owncloud6/owncloud/index.php/apps/documents/ajax/session/joinasuser/36 [http/1.1 200 connection established 611ms]\r\n[10:27:31.266] head https://owncloud6/owncloud/index.php/apps/documents/ajax/genesis/aa57646af1125a798b6db4fad4e321 [http/1.1 200 ok 380ms]\r\n[10:27:31.781] get https://owncloud6/owncloud/index.php/apps/documents/ajax/genesis/aa57646af1125a798b6db4fad4e321 [http/1.1 200 ok 391ms]\r\n[10:27:32.241] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 421ms]\r\n[10:27:32.919] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 370ms]\r\n[10:27:33.230] get https://owncloud6/owncloud/index.php/avatar/demo/60?requesttoken=eef4cf5284ba8b7ea307 [http/1.1 200 ok 380ms]\r\n[10:27:35.697] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 421ms]\r\n[10:27:40.061] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 571ms]\r\n[10:27:43.817] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 501ms]\r\n[10:27:52.278] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 510ms]\r\n[10:27:53.210] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 441ms]\r\n[10:28:00.734] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 401ms]\r\n[10:28:01.166] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 380ms]\r\n[10:28:01.577] get https://owncloud6/owncloud/index.php/avatar/sander/60?requesttoken=eef4cf5284ba8b7ea307 [http/1.1 200 ok 371ms]\r\n[10:28:09.158] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 ok 401ms]\r\n[10:28:17.573] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 400 bad request 371ms]\r\n[10:28:17.896] syntaxerror: json.parse: expected property name or '}' @ https://owncloud6/owncloud/remote.php/core.js?v=7acba01022004f2ce03bf56ca56ec6f4:162\r\n[10:28:21.590] post https://owncloud6/owncloud/index.php/apps/documents/ajax/otpoll.php [http/1.1 200 connection established 391ms]\r\n[10:28:21.949] syntaxerror: json.parse: expected property name or '}' @ https://owncloud6/owncloud/remote.php/core.js?v=7acba01022004f2ce03bf56ca56ec6f4:162\r\n[10:28:40.898] post https://owncloud6/owncloud/index.php/heartbeat [http/1.1 200 connection established 380ms]\r\n```","closed_by":{"login":"sndrr","id":5821198,"avatar_url":"https://gravatar.com/avatar/4336e6bc7c8e725c679dcb7b1007ea8e?d=https%3a%2f%2fidenticons.github.com%2fe09f7a6fa09c16c17747fe2c0e321179.png&r=x","gravatar_id":"4336e6bc7c8e725c679dcb7b1007ea8e","url":"https://api.github.com/users/sndrr","html_url":"https://github.com/sndrr","followers_url":"https://api.github.com/users/sndrr/followers","following_url":"https://api.github.com/users/sndrr/following{/other_user}","gists_url":"https://api.github.com/users/sndrr/gists{/gist_id}","starred_url":"https://api.github.com/users/sndrr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sndrr/subscriptions","organizations_url":"https://api.github.com/users/sndrr/orgs","repos_url":"https://api.github.com/users/sndrr/repos","events_url":"https://api.github.com/users/sndrr/events{/privacy}","received_events_url":"https://api.github.com/users/sndrr/received_events","type":"user","site_admin":false}}