{"url":"https://api.github.com/repos/owncloud/core/issues/6336","labels_url":"https://api.github.com/repos/owncloud/core/issues/6336/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/6336/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/6336/events","html_url":"https://github.com/owncloud/core/issues/6336","id":24161947,"number":6336,"title":"upgrade to 6.0 fails","user":{"login":"vasyugan","id":3313208,"avatar_url":"https://gravatar.com/avatar/4be100ab9eb4ca6f9ddb97fbd202b11f?d=https%3a%2f%2fidenticons.github.com%2fd59200ae59d3d308c0be189e068f0985.png&r=x","gravatar_id":"4be100ab9eb4ca6f9ddb97fbd202b11f","url":"https://api.github.com/users/vasyugan","html_url":"https://github.com/vasyugan","followers_url":"https://api.github.com/users/vasyugan/followers","following_url":"https://api.github.com/users/vasyugan/following{/other_user}","gists_url":"https://api.github.com/users/vasyugan/gists{/gist_id}","starred_url":"https://api.github.com/users/vasyugan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vasyugan/subscriptions","organizations_url":"https://api.github.com/users/vasyugan/orgs","repos_url":"https://api.github.com/users/vasyugan/repos","events_url":"https://api.github.com/users/vasyugan/events{/privacy}","received_events_url":"https://api.github.com/users/vasyugan/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2013-12-12t07:40:40z","updated_at":"2013-12-12t10:10:54z","closed_at":"2013-12-12t10:10:54z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"after upgrading, first, i see a php error because suddenly the config file is expected in ./lib/config.php instead of ./config/config.php as in oc 5. is this expected?\r\n\r\nafter copying the config.php over, upgrading does not finish. here is what the log file says:\r\n\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (exception 'pdoexception' with message 'sqlstate[23000]: integrity constraint violation: 1062 duplicate entry '1' for key 'primary'' in \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/connection.php:742\\nstack trace:\\n#0 [internal function]: pdo->query('alter table `oc...')\\n#1 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/connection.php(742): call_user_func_array(array, array)\\n#2 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(152): doctrine\\\\dbal\\\\connection->query('alter table `oc...')\\n#3 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(91): oc\\\\db\\\\mdb2schemamanager->executeschemachange(object(doctrine\\\\dbal\\\\schema\\\\schemadiff))\\n#4 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db.php(373): oc\\\\db\\\\mdb2schemamanager->updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#5 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(965): oc_db::updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#6 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(867): oc_app::updateapp('search_lucene')\\n#7 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(92): oc_app::checkupgrade('search_lucene')\\n#8 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(66): oc_app::loadapp('search_lucene')\\n#9 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/apps\\/files\\/appinfo\\/remote.php(28): oc_app::loadapps(array)\\n#10 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/remote.php(43): require_once('\\/var\\/www\\/user_j...')\\n#11 {main}\\n\\nnext exception 'doctrine\\\\dbal\\\\dbalexception' with message 'an exception occurred while executing 'alter table `oc_lucene_status` add primary key (`fileid`)':\\n\\nsqlstate[23000]: integrity constraint violation: 1062 duplicate entry '1' for key 'primary'' in \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/dbalexception.php:47\\nstack trace:\\n#0 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/connection.php(744): doctrine\\\\dbal\\\\dbalexception::driverexceptionduringquery(object(pdoexception), 'alter table `oc...')\\n#1 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(152): doctrine\\\\dbal\\\\connection->query('alter table `oc...')\\n#2 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(91): oc\\\\db\\\\mdb2schemamanager->executeschemachange(object(doctrine\\\\dbal\\\\schema\\\\schemadiff))\\n#3 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db.php(373): oc\\\\db\\\\mdb2schemamanager->updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#4 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(965): oc_db::updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#5 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(867): oc_app::updateapp('search_lucene')\\n#6 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(92): oc_app::checkupgrade('search_lucene')\\n#7 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(66): oc_app::loadapp('search_lucene')\\n#8 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/apps\\/files\\/appinfo\\/remote.php(28): oc_app::loadapps(array)\\n#9 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/remote.php(43): require_once('\\/var\\/www\\/user_j...')\\n#10 {main})\",\"level\":4,\"time\":\"2013-12-12t07:34:04+00:00\"}\r\n{\"app\":\"remote\",\"message\":\"konnte \\\"search_lucene\\\" nicht aktualisieren.\",\"level\":4,\"time\":\"2013-12-12t07:34:04+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (exception 'pdoexception' with message 'sqlstate[23000]: integrity constraint violation: 1062 duplicate entry '1' for key 'primary'' in \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/connection.php:742\\nstack trace:\\n#0 [internal function]: pdo->query('alter table `oc...')\\n#1 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/connection.php(742): call_user_func_array(array, array)\\n#2 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(152): doctrine\\\\dbal\\\\connection->query('alter table `oc...')\\n#3 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(91): oc\\\\db\\\\mdb2schemamanager->executeschemachange(object(doctrine\\\\dbal\\\\schema\\\\schemadiff))\\n#4 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db.php(373): oc\\\\db\\\\mdb2schemamanager->updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#5 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(965): oc_db::updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#6 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(867): oc_app::updateapp('search_lucene')\\n#7 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(92): oc_app::checkupgrade('search_lucene')\\n#8 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(66): oc_app::loadapp('search_lucene')\\n#9 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/apps\\/files\\/appinfo\\/remote.php(28): oc_app::loadapps(array)\\n#10 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/remote.php(43): require_once('\\/var\\/www\\/user_j...')\\n#11 {main}\\n\\nnext exception 'doctrine\\\\dbal\\\\dbalexception' with message 'an exception occurred while executing 'alter table `oc_lucene_status` add primary key (`fileid`)':\\n\\nsqlstate[23000]: integrity constraint violation: 1062 duplicate entry '1' for key 'primary'' in \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/dbalexception.php:47\\nstack trace:\\n#0 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/3rdparty\\/doctrine\\/dbal\\/lib\\/doctrine\\/dbal\\/connection.php(744): doctrine\\\\dbal\\\\dbalexception::driverexceptionduringquery(object(pdoexception), 'alter table `oc...')\\n#1 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(152): doctrine\\\\dbal\\\\connection->query('alter table `oc...')\\n#2 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db\\/mdb2schemamanager.php(91): oc\\\\db\\\\mdb2schemamanager->executeschemachange(object(doctrine\\\\dbal\\\\schema\\\\schemadiff))\\n#3 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/db.php(373): oc\\\\db\\\\mdb2schemamanager->updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#4 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(965): oc_db::updatedbfromstructure('\\/var\\/www\\/user_j...')\\n#5 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(867): oc_app::updateapp('search_lucene')\\n#6 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(92): oc_app::checkupgrade('search_lucene')\\n#7 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/lib\\/private\\/app.php(66): oc_app::loadapp('search_lucene')\\n#8 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/apps\\/files\\/appinfo\\/remote.php(28): oc_app::loadapps(array)\\n#9 \\/var\\/www\\/user_jrweb\\/chroot\\/htdocs\\/rohr.org\\/www\\/oc\\/remote.php(43): require_once('\\/var\\/www\\/user_j...')\\n#10 {main})\",\"level\":4,\"time\":\"2013-12-12t07:34:05+00:00\"}\r\n{\"app\":\"remote\",\"message\":\"konnte \\\"search_lucene\\\" nicht aktualisieren.\",\"level\":4,\"time\":\"2013-12-12t07:34:05+00:00\"}\r\njr@vm20:~/www/htdocs/rohr.org/ocfiles$ \r\n","closed_by":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false}}