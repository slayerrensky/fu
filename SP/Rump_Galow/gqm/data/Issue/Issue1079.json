{"url":"https://api.github.com/repos/owncloud/core/issues/1079","labels_url":"https://api.github.com/repos/owncloud/core/issues/1079/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/1079/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/1079/events","html_url":"https://github.com/owncloud/core/pull/1079","id":9684391,"number":1079,"title":"updater progress feedback","user":{"login":"mtgap","id":1097106,"avatar_url":"https://gravatar.com/avatar/454a73ee5feeb428d0c163a48903332c?d=https%3a%2f%2fidenticons.github.com%2f52d29a66f285a1d61125dd69ac0766b2.png&r=x","gravatar_id":"454a73ee5feeb428d0c163a48903332c","url":"https://api.github.com/users/mtgap","html_url":"https://github.com/mtgap","followers_url":"https://api.github.com/users/mtgap/followers","following_url":"https://api.github.com/users/mtgap/following{/other_user}","gists_url":"https://api.github.com/users/mtgap/gists{/gist_id}","starred_url":"https://api.github.com/users/mtgap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtgap/subscriptions","organizations_url":"https://api.github.com/users/mtgap/orgs","repos_url":"https://api.github.com/users/mtgap/repos","events_url":"https://api.github.com/users/mtgap/events{/privacy}","received_events_url":"https://api.github.com/users/mtgap/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":13,"created_at":"2013-01-04t15:52:33z","updated_at":"2013-01-05t17:33:29z","closed_at":"2013-01-05t17:33:29z","pull_request":{"html_url":"https://github.com/owncloud/core/pull/1079","diff_url":"https://github.com/owncloud/core/pull/1079.diff","patch_url":"https://github.com/owncloud/core/pull/1079.patch"},"body":"\r\n\r\nthis pull request introduces an update page and maintenance mode for temporarily disabling owncloud during an update. it resolves https://github.com/owncloud/core/issues/903\r\n\r\nduring an update the user is redirected to the update page (instead of the long loading to the main page). the update is then started in an ajax request and update progress is returned  using oc_eventsource. owncloud is placed into maintenance mode, which prevents any other requests and shows an error page. apps' update scripts can send back update progress as well by emitting the update hook e.g. oc_hook::emit('update', 'success', 'moved files to new file cache');  \r\n\r\nthere are 3 available messages - success, error, and failure. error should be emitted for something bad that happened, but the update can still continue normally. failure should be emitted if the update can no longer be continued because something got corrupted. success of course is for something that happened correctly.\r\n\r\nto test, bump up the version number in lib/util.php getversion() you'll see some messages about turning on/off maintenance mode and updating the database. for updating apps there is currently only a 'updated $appid app' message. you can change the version numbers of apps to see these, however there's a problem with the app version compatibility because we are on 4.91 and they think they are only compatible with 4.9. comment out line 31 of core/ajax/update.php to bypass this. do note that version numbers will change in the database and config.php by testing this and may mess up future 'real' updates.\r\n\r\n\r\nnext steps:\r\n- show formatted version numbers instead of the internal 4.91.#\r\n- more messages from app updates\r\n- only allow admin to run the update?\r\n- integrate with updater app?\r\n\r\n\r\n@karlitschek @jancborchardt @mtrichards @msrex @icewind1991 @tanghus @vicdeo \r\n\r\n![update-success](https://f.cloud.github.com/assets/1097106/43442/17af4c30-5687-11e2-9763-6132a2746e6e.png)\r\n\r\na fake database update failure:\r\n![update-failure](https://f.cloud.github.com/assets/1097106/43445/39a626d8-5687-11e2-96e9-46758ff4f46d.png)\r\n\r\n","closed_by":{"login":"mtgap","id":1097106,"avatar_url":"https://gravatar.com/avatar/454a73ee5feeb428d0c163a48903332c?d=https%3a%2f%2fidenticons.github.com%2f52d29a66f285a1d61125dd69ac0766b2.png&r=x","gravatar_id":"454a73ee5feeb428d0c163a48903332c","url":"https://api.github.com/users/mtgap","html_url":"https://github.com/mtgap","followers_url":"https://api.github.com/users/mtgap/followers","following_url":"https://api.github.com/users/mtgap/following{/other_user}","gists_url":"https://api.github.com/users/mtgap/gists{/gist_id}","starred_url":"https://api.github.com/users/mtgap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtgap/subscriptions","organizations_url":"https://api.github.com/users/mtgap/orgs","repos_url":"https://api.github.com/users/mtgap/repos","events_url":"https://api.github.com/users/mtgap/events{/privacy}","received_events_url":"https://api.github.com/users/mtgap/received_events","type":"user","site_admin":false}}