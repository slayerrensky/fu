{"url":"https://api.github.com/repos/owncloud/core/issues/3644","labels_url":"https://api.github.com/repos/owncloud/core/issues/3644/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3644/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3644/events","html_url":"https://github.com/owncloud/core/issues/3644","id":15326389,"number":3644,"title":"external storage: broken file access","user":{"login":"xuesheng-git","id":4077683,"avatar_url":"https://gravatar.com/avatar/a90f133b78bdad4cfd1fa10ef169854e?d=https%3a%2f%2fidenticons.github.com%2fb23026b7a25dae7a56bb9379467a82c9.png&r=x","gravatar_id":"a90f133b78bdad4cfd1fa10ef169854e","url":"https://api.github.com/users/xuesheng-git","html_url":"https://github.com/xuesheng-git","followers_url":"https://api.github.com/users/xuesheng-git/followers","following_url":"https://api.github.com/users/xuesheng-git/following{/other_user}","gists_url":"https://api.github.com/users/xuesheng-git/gists{/gist_id}","starred_url":"https://api.github.com/users/xuesheng-git/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xuesheng-git/subscriptions","organizations_url":"https://api.github.com/users/xuesheng-git/orgs","repos_url":"https://api.github.com/users/xuesheng-git/repos","events_url":"https://api.github.com/users/xuesheng-git/events{/privacy}","received_events_url":"https://api.github.com/users/xuesheng-git/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/app%3afiles","name":"app:files","color":"02d7e1"}],"state":"closed","assignee":null,"milestone":null,"comments":5,"created_at":"2013-06-09t21:41:52z","updated_at":"2013-08-16t22:18:13z","closed_at":"2013-08-16t22:18:13z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\ndownload of files and e.g. preview of pictures should work for local and external storage.\r\n\r\n### actual behaviour\r\ndownload of files which are mounted through external storage app results in an error:\r\n\r\n> not found\r\n>\r\n> the requested url /owncloud/index.php/apps/files/ajax/download.php was not found on this server.\r\n> \r\n> additionally, a 404 not found error was encountered while trying to use an errordocument to handle the request.\r\n> apache/2.2.22 (ubuntu) server at mycloud port 443\r\n\r\nclicking on a jpg files gives the following error:\r\n> the requested content cannot be loaded.\r\n> please try again later.\r\n\r\n\r\n### steps to reproduce\r\n1. create a folder e.g. /mnt/external_storage\r\n2. change user:group so that owncloud users gain access, e.g. chmod -r www-data:www-data /mnt/external_storage\r\n2. login into admin account of owncloud and activate the \"external storage\" app.\r\n3. goto administrator settings and setup external storage:\r\n * foldername: external_storage\r\n * type: local\r\n * path: /mnt/external_storage\r\n * user/group according to your setup needs\r\n4. login into regular user account (which was specified in step 3)\r\n5. access external_storage, create a text file 'textfile.txt' and save it.\r\n6. click download button.\r\n7. error msg 'not found' appears (see actual behaviour above).\r\n\r\n8. upload a jpg file to external_storage.\r\n9. click on jpg file.\r\n10. error msg 'the requested content cannot be loaded.' appears (see actual behaviour above).\r\n\r\n\r\n### server configuration\r\noperating system: ubuntu 12.04\r\n\r\nweb server: server version: apache/2.2.22 (ubuntu), server built:   mar  8 2013 15:53:13\r\n\r\ndatabase: mysql\r\n\r\nphp version: php 5.3.10-1ubuntu3.6\r\n\r\nowncloud version: 5.0.7\r\n\r\n### client configuration\r\nbrowser: firefox 21.0\r\n\r\noperating system: ubuntu 13.04\r\n\r\n\r\n### logs\r\n\r\napache error.log\r\n\r\n> [sun jun 09 23:07:11 2013] [error] [client 192.168.5.70] (20023)the given path was above the root path: xsendfile: unable to find file: /mnt/external_storage/test.txt, referer: https://mycloud/owncloud/index.php/apps/files?dir=/external_storage\r\n> [sun jun 09 23:07:11 2013] [error] [client 192.168.5.70] file does not exist: /var/www/core, referer: https://mycloud/owncloud/index.php/apps/files?dir=/external_storage\r\n> [sun jun 09 23:14:17 2013] [error] [client 127.0.0.1] client denied by server configuration: /var/www/owncloud/data/htaccesstest.txt\r\n> [sun jun 09 23:14:17 2013] [error] [client 127.0.0.1] file does not exist: /var/www/core\r\n> [sun jun 09 23:17:54 2013] [error] [client 192.168.5.70] (20023)the given path was above the root path: xsendfile: unable to find file: /mnt/external_storage/test.txt, referer: https://mycloud/owncloud/index.php/apps/files?dir=//external_storage\r\n> [sun jun 09 23:17:54 2013] [error] [client 192.168.5.70] file does not exist: /var/www/core, referer: https://mycloud/owncloud/index.php/apps/files?dir=//external_storage\r\n> [sun jun 09 23:21:31 2013] [error] [client 127.0.0.1] client denied by server configuration: /var/www/owncloud/data/htaccesstest.txt\r\n> [sun jun 09 23:21:31 2013] [error] [client 127.0.0.1] file does not exist: /var/www/core\r\n\r\n\r\n\r\n**it seems that the external_storage should not be above root path. shouldn't the external storage app care about this? how to fix it?**","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}