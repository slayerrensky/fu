{"url":"https://api.github.com/repos/owncloud/core/issues/2719","labels_url":"https://api.github.com/repos/owncloud/core/issues/2719/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/2719/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/2719/events","html_url":"https://github.com/owncloud/core/issues/2719","id":12798671,"number":2719,"title":"severe performance issues with timeouts/hanging http requests","user":{"login":"emu42","id":4058786,"avatar_url":"https://gravatar.com/avatar/c22e3f33f07187daac7f15f3112792cc?d=https%3a%2f%2fidenticons.github.com%2fc880f8da8fdba590f300ea435159228c.png&r=x","gravatar_id":"c22e3f33f07187daac7f15f3112792cc","url":"https://api.github.com/users/emu42","html_url":"https://github.com/emu42","followers_url":"https://api.github.com/users/emu42/followers","following_url":"https://api.github.com/users/emu42/following{/other_user}","gists_url":"https://api.github.com/users/emu42/gists{/gist_id}","starred_url":"https://api.github.com/users/emu42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emu42/subscriptions","organizations_url":"https://api.github.com/users/emu42/orgs","repos_url":"https://api.github.com/users/emu42/repos","events_url":"https://api.github.com/users/emu42/events{/privacy}","received_events_url":"https://api.github.com/users/emu42/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":4,"created_at":"2013-04-04t12:59:19z","updated_at":"2013-08-08t15:29:52z","closed_at":"2013-08-08t15:29:52z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\ndatabase load on owncloud server should be barely noticable with merely one client running (and nothing to sync actually).\r\n\r\n### actual behaviour\r\nhigh load on database (100% on one cpu core for several seconds per propfind request). timeouts on client / apache httpd concurrent request limit reached.\r\n\r\n### steps to reproduce\r\n1. set up new owncloud server\r\n2. create two users\r\n3. set up clients\r\n4. user1 uploads a folder with 2 files (500gb each) and shares with user2\r\n5. server locks up under high load (user2 only received an empty folder before httpd refused to accept further connections)\r\n\r\n### server configuration\r\noperating system:\r\ndebian 6.0\r\n\r\nweb server: \r\napache 2.2\r\n\r\ndatabase:\r\nmysql 5.0\r\n\r\nphp version:\r\nphp 5.3.3-7+squeeze15 with suhosin-patch (cli) (built: mar  4 2013 13:11:17) \r\n\r\nowncloud version:\r\n5.0.0\r\n\r\n### client configuration\r\nbrowser:\r\nfirefox\r\n\r\noperating system:\r\ngentoo linux (user1)\r\nwindows xp (user2)\r\n\r\n### logs\r\n#### web server error log\r\nno relevant entries found\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/clientsync: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/emu\\/files\\/clientsync\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364460417}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/clientsync: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/emu\\/files\\/clientsync\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364460417}\r\n{\"app\":\"php\",\"message\":\"imagecreatefromstring(): data is not in a recognized format at \\/var\\/www\\/owncloud\\/lib\\/image.php#477\",\"level\":2,\"time\":1364461170}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364461318}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461318}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew\\/roadshow: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\/oew\\/roadshow\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364461356}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew\\/roadshow: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\/oew\\/roadshow\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364461356}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\/oew\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364461364}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\/oew\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364461364}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364461369}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364461369}\r\n{\"app\":\"php\",\"message\":\"only variables should be passed by reference at \\/var\\/www\\/owncloud\\/apps\\/search_lucene\\/lib\\/indexer.php#133\",\"level\":2,\"time\":1364461373}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew\\/roadshow\\/nuroewlogo_badge.pdf: pdf parsing not enabled in this version of getid3() [1.9.3-20111213]\",\"level\":2,\"time\":1364461373}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364461534}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364461534}\r\n{\"app\":\"php\",\"message\":\"call to a member function getroot() on a non-object at \\/var\\/www\\/owncloud\\/lib\\/files\\/filesystem.php#318\",\"level\":4,\"time\":1364461535}\r\n{\"app\":\"php\",\"message\":\"opendir(\\/var\\/www\\/owncloud\\/data\\/crpi\\/cache\\/): failed to open dir: no such file or directory at \\/var\\/www\\/owncloud\\/lib\\/files\\/storage\\/local.php#40\",\"level\":2,\"time\":1364461551}\r\n{\"app\":\"php\",\"message\":\"readdir() expects parameter 1 to be resource, boolean given at \\/var\\/www\\/owncloud\\/lib\\/cache\\/file.php#88\",\"level\":2,\"time\":1364461551}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364461552}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364461552}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461552}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364461573}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461574}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461578}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461581}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461584}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461587}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461593}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461601}\r\n{\"app\":\"php\",\"message\":\"only variables should be passed by reference at \\/var\\/www\\/owncloud\\/apps\\/search_lucene\\/lib\\/indexer.php#133\",\"level\":2,\"time\":1364461602}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew\\/roadshow\\/mitabeiter_badge.pdf: pdf parsing not enabled in this version of getid3() [1.9.3-20111213]\",\"level\":2,\"time\":1364461602}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461628}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461633}\r\n{\"app\":\"php\",\"message\":\"only variables should be passed by reference at \\/var\\/www\\/owncloud\\/apps\\/search_lucene\\/lib\\/indexer.php#133\",\"level\":2,\"time\":1364461638}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/bmeia\\/ticket_tennischarityturnier2012.pdf: pdf parsing not enabled in this version of getid3() [1.9.3-20111213]\",\"level\":2,\"time\":1364461638}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461644}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/qrcode.xcf: unable to determine file format\",\"level\":2,\"time\":1364461646}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364461766}\r\n{\"app\":\"php\",\"message\":\"call to a member function getroot() on a non-object at \\/var\\/www\\/owncloud\\/lib\\/files\\/filesystem.php#318\",\"level\":4,\"time\":1364461778}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462387}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462474}\r\n{\"app\":\"php\",\"message\":\"call to a member function getroot() on a non-object at \\/var\\/www\\/owncloud\\/lib\\/files\\/filesystem.php#318\",\"level\":4,\"time\":1364462476}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462491}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462496}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462505}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462507}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462511}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462515}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462522}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462528}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462543}\r\n{\"app\":\"search_lucene\",\"message\":\"need mimetype for content extraction\",\"level\":3,\"time\":1364462566}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364463153}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364463153}\r\n{\"app\":\"php\",\"message\":\"call to a member function getroot() on a non-object at \\/var\\/www\\/owncloud\\/lib\\/files\\/filesystem.php#318\",\"level\":4,\"time\":1364463156}\r\n{\"app\":\"php\",\"message\":\"call to a member function getroot() on a non-object at \\/var\\/www\\/owncloud\\/lib\\/files\\/filesystem.php#318\",\"level\":4,\"time\":1364464104}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew\\/atb experience: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\/oew\\/atb experience\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364464117}\r\n{\"app\":\"search_lucene\",\"message\":\"failed to extract meta information for \\/designs\\/oew\\/atb experience: could not open \\\"\\/var\\/www\\/owncloud\\/data\\/flge\\/files\\/designs\\/oew\\/atb experience\\\" (does not exist, or is not a file)\",\"level\":2,\"time\":1364464117}\r\n{\"app\":\"php\",\"message\":\"call to a member function getroot() on a non-object at \\/var\\/www\\/owncloud\\/lib\\/files\\/filesystem.php#318\",\"level\":4,\"time\":1364464878}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364487984}\r\n{\"app\":\"php\",\"message\":\"xcache_get(): xcache.var_size is either 0 or too small to enable var data caching at \\/var\\/www\\/owncloud\\/lib\\/cache\\/xcache.php#27\",\"level\":2,\"time\":1364487984}\r\n{\"app\":\"php\",\"message\":\"call to a member function getroot() on a non-object at \\/var\\/www\\/owncloud\\/lib\\/files\\/filesystem.php#318\",\"level\":4,\"time\":1364487985}\r\n```\r\n#### browser log\r\nn/a","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}