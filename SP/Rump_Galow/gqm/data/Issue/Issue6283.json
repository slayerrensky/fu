{"url":"https://api.github.com/repos/owncloud/core/issues/6283","labels_url":"https://api.github.com/repos/owncloud/core/issues/6283/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/6283/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/6283/events","html_url":"https://github.com/owncloud/core/issues/6283","id":24023695,"number":6283,"title":"[6.0rc4]: ldap configuration: username/pw of client user get overwritten on reload of admin page","user":{"login":"jcfischer","id":3088,"avatar_url":"https://gravatar.com/avatar/5085ba37ba624a788e04a842cd09bd6e?d=https%3a%2f%2fidenticons.github.com%2fdc6a7e655d7e5840e66733e9ee67cc69.png&r=x","gravatar_id":"5085ba37ba624a788e04a842cd09bd6e","url":"https://api.github.com/users/jcfischer","html_url":"https://github.com/jcfischer","followers_url":"https://api.github.com/users/jcfischer/followers","following_url":"https://api.github.com/users/jcfischer/following{/other_user}","gists_url":"https://api.github.com/users/jcfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/jcfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcfischer/subscriptions","organizations_url":"https://api.github.com/users/jcfischer/orgs","repos_url":"https://api.github.com/users/jcfischer/repos","events_url":"https://api.github.com/users/jcfischer/events{/privacy}","received_events_url":"https://api.github.com/users/jcfischer/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/app%3auser_ldap","name":"app:user_ldap","color":"02d7e1"},{"url":"https://api.github.com/repos/owncloud/core/labels/db%3apostgresql","name":"db:postgresql","color":"444444"}],"state":"closed","assignee":null,"milestone":null,"comments":5,"created_at":"2013-12-10t09:52:46z","updated_at":"2013-12-12t13:15:54z","closed_at":"2013-12-12t13:15:54z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"\r\n### expected behaviour\r\nwhen you configure a ldap backend, fill in the client info (ldap_dn and ldap_agent_password) and have a working ldap setup, and reload the /setttings/admin page, the two fields should contain the correct ldap user information \r\n\r\n### actual behaviour\r\nthe fields are filled with the admin/password of the admin user\r\n\r\n### steps to reproduce\r\n1. configure ldap, check that \"configuration ok\" is shown\r\n2. reload /settings/admin\r\n3. see that name and password have been replaced with standard login values and ldap configuration is shown as \"incomplete\"\r\n\r\n### server configuration\r\noperating system: ubuntu 13.10 saucy\r\n\r\nweb server: apache 2.4\r\n\r\ndatabase: postgresql 9.3\r\n\r\nphp version: 5.5\r\n\r\nowncloud version: (see owncloud admin page) 6.0rc4\r\n\r\nupdated from an older owncloud or fresh install:\r\n\r\nlist of activated app:\r\n\r\nthe content of config/config.php: (without the database password and passwordsalt)\r\n\r\n```\r\n<?php\r\n$config = array (\r\n  'installed' => true,\r\n  'dbtype' => 'pgsql',\r\n  'dbname' => 'owncloud',\r\n  'dbuser' => 'owncloud',\r\n  'dbpassword' => 'xxx',\r\n  'dbhost' => '10.0.20.42',\r\n  'dbtableprefix' => 'oc_',\r\n  'passwordsalt' => 'xxx',\r\n  'forcessl' => false,\r\n  'blacklisted_files' =>\r\n  array (\r\n    0 => '.htaccess',\r\n  ),\r\n  'overwritehost' => '',\r\n  'overwriteprotocol' => '',\r\n  'overwritewebroot' => '',\r\n  'overwritecondaddr' => '',\r\n  'proxy' => '',\r\n  'proxyuserpwd' => '',\r\n  'theme' => '',\r\n  'default_language' => 'en',\r\n  '3rdpartyroot' => '',\r\n  '3rdpartyurl' => '',\r\n  'defaultapp' => 'files',\r\n  'knowledgebaseenabled' => true,\r\n  'appstoreenabled' => true,\r\n  'appstoreurl' => 'http://api.apps.owncloud.com/v1',\r\n  'mail_domain' => 'xxx.ch',\r\n  'mail_smtpdebug' => false,\r\n  'mail_smtpmode' => 'sendmail',\r\n  'mail_smtphost' => 'smtp.xxx.ch',\r\n  'mail_smtpport' => 25,\r\n  'mail_smtptimeout' => 10,\r\n  'mail_smtpsecure' => '',\r\n  'mail_smtpauth' => false,\r\n  'mail_smtpauthtype' => 'login',\r\n  'mail_smtpname' => '',\r\n  'mail_smtppassword' => '',\r\n  'trashbin_retention_obligation' => 30,\r\n  'allow_user_to_change_display_name' => false,\r\n  'appcodechecker' => '',\r\n  'updatechecker' => true,\r\n  'has_internet_connection' => true,\r\n  'check_for_working_webdav' => true,\r\n  'check_for_working_htaccess' => true,\r\n  'log_type' => 'owncloud',\r\n  'logfile' => '/var/log/owncloud/owncloud.log',\r\n  'loglevel' => '0',\r\n  'logdateformat' => 'f d, y h:i:s',\r\n  'logtimezone' => 'europe/berlin',\r\n  'log_query' => false,\r\n  'log_authfailip' => false,\r\n  'log_rotate_size' => 104857600,\r\n  'remember_login_cookie_lifetime' => 1296000,\r\n  'session_lifetime' => 86400,\r\n  'custom_csp_policy' => 'default-src \\'self\\'; script-src \\'self\\' \\'unsafe-eval\\'; style-src \\'self\\' \\'unsafe-inline\\'; frame-src *; img-src *; font-src \\'self\\' data:; media-src *',\r\n  'xframe_restriction' => true,\r\n  'datadirectory' => '/mnt/data',\r\n  'maintenance' => false,\r\n  'apps_paths' =>\r\n  array (\r\n    0 =>\r\n    array (\r\n      'path' => '/var/www/owncloud/apps',\r\n      'url' => '/apps',\r\n      'writable' => true,\r\n    ),\r\n  ),\r\n  'user_backends' =>\r\n  array (\r\n    0 =>\r\n    array (\r\n      'class' => 'oc_user_imap',\r\n      'arguments' =>\r\n      array (\r\n        0 => '{imap.gmail.com:993/imap/ssl}inbox',\r\n      ),\r\n    ),\r\n  ),\r\n  'customclient_desktop' => 'http://owncloud.org/sync-clients/',\r\n  'customclient_android' => 'https://play.google.com/store/apps/details?id=com.owncloud.android',\r\n  'customclient_ios' => 'https://itunes.apple.com/us/app/owncloud/id543672169?mt=8',\r\n  'enable_previews' => true,\r\n  'preview_max_x' => null,\r\n  'preview_max_y' => null,\r\n  'preview_max_scale_factor' => 10,\r\n  'preview_libreoffice_path' => '/usr/bin/libreoffice',\r\n  'preview_office_cl_parameters' => '',\r\n  'enable_avatars' => true,\r\n  'openssl' =>\r\n  array (\r\n  ),\r\n  'instanceid' => 'xxx',\r\n  'version' => '6.0.0.12',\r\n  'maxzipinputsize' => 838860800,\r\n  'allowzipdownload' => true,\r\n  'ldapignorenamingrules' => false,\r\n);\r\n```\r\n\r\n### client configuration\r\nbrowser: safari 6.1 (8537.71)\r\n\r\noperating system: os x 10.8.5\r\n\r\n### logs\r\n#### web server error log\r\n```\r\nempty\r\n```\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n{\"app\":\"php\",\"message\":\"ldap_start_tls(): unable to start tls: protocol error at \\/var\\/www\\/owncloud\\/apps\\/user_ldap\\/lib\\/ldap.php#141\",\"level\":2,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error protocol error (2) after calling ldap_start_tls\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error protocol error (2) after calling ldap_errno\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error invalid dn syntax (34) after calling ldap_bind\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error invalid dn syntax (34) after calling ldap_errno\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error invalid dn syntax (34) after calling ldap_error\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"bind failed: 34: invalid dn syntax\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"connection could not be established\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error invalid dn syntax (34) after calling ldap_bind\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"core\",\"message\":\"user backend oc_user_imap not found.\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"php\",\"message\":\"ldap_start_tls(): unable to start tls: protocol error at \\/var\\/www\\/owncloud\\/apps\\/user_ldap\\/lib\\/ldap.php#141\",\"level\":2,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error protocol error (2) after calling ldap_start_tls\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error protocol error (2) after calling ldap_errno\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error invalid dn syntax (34) after calling ldap_bind\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error invalid dn syntax (34) after calling ldap_errno\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"ldap error invalid dn syntax (34) after calling ldap_error\",\"level\":0,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"bind failed: 34: invalid dn syntax\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n{\"app\":\"user_ldap\",\"message\":\"connection could not be established\",\"level\":3,\"time\":\"december 10, 2013 10:51:07\"}\r\n```\r\n\r\n#### browser log\r\n```\r\ninsert your browser log here, this could for example include:\r\n\r\na) the javascript console log\r\nb) the network log \r\nc) ...\r\n```","closed_by":{"login":"blizzz","id":2184312,"avatar_url":"https://gravatar.com/avatar/1898b25a9cb3aa1a0f0febd1359910b9?d=https%3a%2f%2fidenticons.github.com%2fca03acec6deadf508b75eb0cf9ba036c.png&r=x","gravatar_id":"1898b25a9cb3aa1a0f0febd1359910b9","url":"https://api.github.com/users/blizzz","html_url":"https://github.com/blizzz","followers_url":"https://api.github.com/users/blizzz/followers","following_url":"https://api.github.com/users/blizzz/following{/other_user}","gists_url":"https://api.github.com/users/blizzz/gists{/gist_id}","starred_url":"https://api.github.com/users/blizzz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blizzz/subscriptions","organizations_url":"https://api.github.com/users/blizzz/orgs","repos_url":"https://api.github.com/users/blizzz/repos","events_url":"https://api.github.com/users/blizzz/events{/privacy}","received_events_url":"https://api.github.com/users/blizzz/received_events","type":"user","site_admin":false}}