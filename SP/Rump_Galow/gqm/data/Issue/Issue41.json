{"url":"https://api.github.com/repos/owncloud/core/issues/41","labels_url":"https://api.github.com/repos/owncloud/core/issues/41/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/41/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/41/events","html_url":"https://github.com/owncloud/core/pull/41","id":7717452,"number":41,"title":"oc_vcategories - this time actually usable ;)","user":{"login":"tanghus","id":533222,"avatar_url":"https://gravatar.com/avatar/e625b634822713b2e346ff7c67d26775?d=https%3a%2f%2fidenticons.github.com%2f6d9c90af1c12f5a88e4d5f216bbc1979.png&r=x","gravatar_id":"e625b634822713b2e346ff7c67d26775","url":"https://api.github.com/users/tanghus","html_url":"https://github.com/tanghus","followers_url":"https://api.github.com/users/tanghus/followers","following_url":"https://api.github.com/users/tanghus/following{/other_user}","gists_url":"https://api.github.com/users/tanghus/gists{/gist_id}","starred_url":"https://api.github.com/users/tanghus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tanghus/subscriptions","organizations_url":"https://api.github.com/users/tanghus/orgs","repos_url":"https://api.github.com/users/tanghus/repos","events_url":"https://api.github.com/users/tanghus/events{/privacy}","received_events_url":"https://api.github.com/users/tanghus/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/5+-+to+review","name":"5 - to review","color":"ededed"},{"url":"https://api.github.com/repos/owncloud/core/labels/enhancement","name":"enhancement","color":"02e10c"}],"state":"closed","assignee":null,"milestone":{"url":"https://api.github.com/repos/owncloud/core/milestones/2","labels_url":"https://api.github.com/repos/owncloud/core/milestones/2/labels","id":182810,"number":2,"title":"owncloud 5","description":"","creator":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false},"open_issues":0,"closed_issues":174,"state":"closed","created_at":"2012-09-24t16:33:41z","updated_at":"2013-08-07t14:29:42z","due_on":"2013-02-28t08:00:00z"},"comments":21,"created_at":"2012-10-19t14:33:44z","updated_at":"2013-06-27t10:37:29z","closed_at":"2012-11-13t23:40:46z","pull_request":{"html_url":"https://github.com/owncloud/core/pull/41","diff_url":"https://github.com/owncloud/core/pull/41.diff","patch_url":"https://github.com/owncloud/core/pull/41.patch"},"body":"first let's get the lingo straight: categories == tags == groups == whatever-you-use-to-categorize-with.\r\n\r\none of the reasons i started hacking on owncloud, was that i constantly got annoyed by having duplicate/empty tags in kde kontact, and the early versions of akonadi/nepomuk certainly didn't help ;)\r\nso i wanted to have a backend, that made that close to impossible, and should it happen you could do a full purge and rescan.\r\n\r\nmy first merge request back in january tried to do that, but i can see now that it wouldn't have worked properly, and i'm quite happy that we settled on the cut down version which saved a users categories in oc_preferences - even with all the bug reports it subsequently gave because of the value field being too small :-p\r\n\r\nthis time i think i got it right. instead of being based on app name as the previous version, it now uses entity names (types) like 'event', 'task' or 'contact', just as the sharing backend.\r\ni had to create two extra tables: 'vcategory' holding userid, type and category name. the second 'vcategory_to_object' (i know, but please suggest a better name) holds the relations between categoryid (auto-incremented in vcategory), objectid (from eg. contacts_cards) and the type name which together makes a unique index.\r\n\r\nin order to avoid mass-duplication of code, i also introduced a new method insertifnotexists() to oc_db - with unit tests of course ;) i saw some from bug reports lately that other apps might benifit from that as well.\r\n\r\ncontrary to most classes in owncloud, oc_vcategories holds very few static methods and most often must be instantiated.\r\n\r\nthe basic use can be seen in the corresponding branch vcategories_db in the apps repository, where i have ported the calendar and contacts apps to use it - basically changing from using appname to type name and adding some calls for purging the db on user and/or object deletion - but for contacts i have made a proof of concept implementation. i will submit a pull request for that branch shortly after this one.\r\n\r\nwhile at it i used the opportunity to make a full rewrite of the client side code for the contacts app, which currently is a huge pile of unmaintainable spaghetti code... it was my first take on writing client side web app code, so it has to go ;) uses the categories backend to abstract from the addressbooks and use groups to organize contacts, which will give a much more intuitive ux especially for those poor sods using apple software that can only deal with one addressbook ;)\r\n\r\ni estimate the rewrite to be ~75% done and it will certainly be done and tested for oc 5. it's in the contacts_rework branch btw.\r\n\r\nwell 'nuff said. please have a look and find all the gotchas i've overlooked :-)","closed_by":{"login":"tanghus","id":533222,"avatar_url":"https://gravatar.com/avatar/e625b634822713b2e346ff7c67d26775?d=https%3a%2f%2fidenticons.github.com%2f6d9c90af1c12f5a88e4d5f216bbc1979.png&r=x","gravatar_id":"e625b634822713b2e346ff7c67d26775","url":"https://api.github.com/users/tanghus","html_url":"https://github.com/tanghus","followers_url":"https://api.github.com/users/tanghus/followers","following_url":"https://api.github.com/users/tanghus/following{/other_user}","gists_url":"https://api.github.com/users/tanghus/gists{/gist_id}","starred_url":"https://api.github.com/users/tanghus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tanghus/subscriptions","organizations_url":"https://api.github.com/users/tanghus/orgs","repos_url":"https://api.github.com/users/tanghus/repos","events_url":"https://api.github.com/users/tanghus/events{/privacy}","received_events_url":"https://api.github.com/users/tanghus/received_events","type":"user","site_admin":false}}