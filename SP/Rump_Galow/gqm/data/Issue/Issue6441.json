{"url":"https://api.github.com/repos/owncloud/core/issues/6441","labels_url":"https://api.github.com/repos/owncloud/core/issues/6441/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/6441/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/6441/events","html_url":"https://github.com/owncloud/core/issues/6441","id":24351459,"number":6441,"title":"[6.0.0.a] upload of large (>400mb) files fails with timeout","user":{"login":"jcfischer","id":3088,"avatar_url":"https://gravatar.com/avatar/5085ba37ba624a788e04a842cd09bd6e?d=https%3a%2f%2fidenticons.github.com%2fdc6a7e655d7e5840e66733e9ee67cc69.png&r=x","gravatar_id":"5085ba37ba624a788e04a842cd09bd6e","url":"https://api.github.com/users/jcfischer","html_url":"https://github.com/jcfischer","followers_url":"https://api.github.com/users/jcfischer/followers","following_url":"https://api.github.com/users/jcfischer/following{/other_user}","gists_url":"https://api.github.com/users/jcfischer/gists{/gist_id}","starred_url":"https://api.github.com/users/jcfischer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcfischer/subscriptions","organizations_url":"https://api.github.com/users/jcfischer/orgs","repos_url":"https://api.github.com/users/jcfischer/repos","events_url":"https://api.github.com/users/jcfischer/events{/privacy}","received_events_url":"https://api.github.com/users/jcfischer/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":2,"created_at":"2013-12-16t14:15:19z","updated_at":"2013-12-16t14:31:20z","closed_at":"2013-12-16t14:23:49z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\nsyncing of a directory with large files (virtualbox virtual appliances) should upload the files to the owncloud server\r\n\r\n### actual behaviour\r\nsync client reports \"problem: gateway timeout\" for those files\r\n\r\n### steps to reproduce\r\n1. sync directory\r\n\r\n### server configuration\r\noperating system: ubuntu 13.04\r\n\r\nweb server: apache 2.4\r\n\r\ndatabase: postgres 9.2\r\n\r\nphp version: 5.5\r\n\r\nowncloud version: 6.0.0a\r\n\r\nupdated from an older owncloud or fresh install: updated from 6.0rc4 (which had the same behaviour)\r\n\r\nlist of activated app: \r\n\r\nthe content of config/config.php: (without the database password and passwordsalt)\r\n\r\n````\r\n<?php\r\n$config = array (\r\n  'installed' => true,\r\n  'dbtype' => 'pgsql',\r\n  'dbname' => 'owncloud',\r\n  'dbuser' => 'owncloud',\r\n  'dbpassword' => 'xxx',\r\n  'dbhost' => '10.0.20.42',\r\n  'dbtableprefix' => 'oc_',\r\n  'passwordsalt' => 'xxx',\r\n  'forcessl' => false,\r\n  'blacklisted_files' =>\r\n  array (\r\n    0 => '.htaccess',\r\n  ),\r\n  'overwritehost' => '',\r\n  'overwriteprotocol' => '',\r\n  'overwritewebroot' => '',\r\n  'overwritecondaddr' => '',\r\n  'proxy' => '',\r\n  'proxyuserpwd' => '',\r\n  'theme' => '',\r\n  'default_language' => 'en',\r\n  '3rdpartyroot' => '',\r\n  '3rdpartyurl' => '',\r\n  'defaultapp' => 'files',\r\n  'knowledgebaseenabled' => true,\r\n  'appstoreenabled' => true,\r\n  'appstoreurl' => 'http://api.apps.owncloud.com/v1',\r\n  'mail_domain' => 'xxx.ch',\r\n  'mail_smtpdebug' => false,\r\n  'mail_smtpmode' => 'sendmail',\r\n  'mail_smtphost' => 'smtp.xxx.ch',\r\n  'mail_smtpport' => 25,\r\n  'mail_smtptimeout' => 10,\r\n  'mail_smtpsecure' => '',\r\n  'mail_smtpauth' => false,\r\n  'mail_smtpauthtype' => 'login',\r\n  'mail_smtpname' => '',\r\n  'mail_smtppassword' => '',\r\n  'trashbin_retention_obligation' => 30,\r\n  'allow_user_to_change_display_name' => false,\r\n  'appcodechecker' => '',\r\n  'updatechecker' => true,\r\n  'has_internet_connection' => true,\r\n  'check_for_working_webdav' => true,\r\n  'check_for_working_htaccess' => true,\r\n  'log_type' => 'owncloud',\r\n  'logfile' => '/var/log/owncloud/owncloud.log',\r\n  'loglevel' => '0',\r\n  'logdateformat' => 'f d, y h:i:s',\r\n  'logtimezone' => 'europe/berlin',\r\n  'log_query' => false,\r\n  'log_authfailip' => false,\r\n  'log_rotate_size' => 104857600,\r\n  'remember_login_cookie_lifetime' => 1296000,\r\n  'session_lifetime' => 86400,\r\n  'custom_csp_policy' => 'default-src \\'self\\'; script-src \\'self\\' \\'unsafe-eval\\'; style-src \\'self\\' \\'unsafe-inline\\'; frame-src *; img-src *; font-src \\'self\\' data:; media-src *',\r\n  'xframe_restriction' => true,\r\n  'datadirectory' => '/mnt/data',\r\n  'maintenance' => false,\r\n  'apps_paths' =>\r\n  array (\r\n    0 =>\r\n    array (\r\n      'path' => '/var/www/owncloud/apps',\r\n      'url' => '/apps',\r\n      'writable' => true,\r\n    ),\r\n  ),\r\n  'user_backends' =>\r\n  array (\r\n    0 =>\r\n    array (\r\n      'class' => 'oc_user_imap',\r\n      'arguments' =>\r\n      array (\r\n        0 => '{imap.gmail.com:993/imap/ssl}inbox',\r\n      ),\r\n    ),\r\n  ),\r\n  'customclient_desktop' => 'http://owncloud.org/sync-clients/',\r\n  'customclient_android' => 'https://play.google.com/store/apps/details?id=com.owncloud.android',\r\n  'customclient_ios' => 'https://itunes.apple.com/us/app/owncloud/id543672169?mt=8',\r\n  'enable_previews' => true,\r\n  'preview_max_x' => null,\r\n  'preview_max_y' => null,\r\n  'preview_max_scale_factor' => 10,\r\n  'preview_libreoffice_path' => '/usr/bin/libreoffice',\r\n  'preview_office_cl_parameters' => '',\r\n  'enable_avatars' => true,\r\n  'openssl' =>\r\n  array (\r\n  ),\r\n  'instanceid' => 'oc94e94d8fd7',\r\n  'version' => '6.0.0.14',\r\n  'maxzipinputsize' => 838860800,\r\n  'allowzipdownload' => true,\r\n  'ldapignorenamingrules' => false,\r\n);\r\n````\r\n### client configuration\r\nbrowser: syncclient 1.4.2\r\n\r\noperating system: os x 10.8.5\r\n\r\n### logs\r\n#### web server error log\r\n```\r\nnone\r\n```\r\n\r\nthe access log show the chuncked uploads:\r\n\r\n```\r\n10.0.20.12 - yyy@xxx.ch [16/dec/2013:13:42:27 +0000] \"put /remote.php/webdav/bc_owncloud/hastexoneutrontraining/openstack-charlie.ova-chunking-4026228953-49-\r\n45 http/1.1\" 201 326 \"-\" \"mozilla/5.0 (macintosh) csyncoc/0.90.4 neon/0.29.6\"\r\n10.0.20.12 - yyy@xxx.ch [16/dec/2013:13:42:52 +0000] \"put /remote.php/webdav/bc_owncloud/hastexoneutrontraining/openstack-charlie.ova-chunking-4026228953-49-\r\n46 http/1.1\" 201 326 \"-\" \"mozilla/5.0 (macintosh) csyncoc/0.90.4 neon/0.29.6\"\r\n10.0.20.12 -yyy@xxx.ch [16/dec/2013:13:43:17 +0000] \"put /remote.php/webdav/bc_owncloud/hastexoneutrontraining/openstack-charlie.ova-chunking-4026228953-49-\r\n47 http/1.1\" 201 326 \"-\" \"mozilla/5.0 (macintosh) csyncoc/0.90.4 neon/0.29.6\"\r\n```\r\nbut nothing after the last sync\r\n\r\n#### syncclient log\r\n\r\n```\r\n14:47     bc_owncloud/hastexoneutrontraining/openstack-charlie.ova        owncloud       problem: gateway time-out\r\n```\r\n\r\n#### owncloud log (data/owncloud.log)\r\n\r\nhas only these entries for that file (upload has been tried several times)\r\n```\r\n{\"app\":\"oc\\\\files\\\\cache\\\\scanner\",\"message\":\"!!! path 'files\\/bc_owncloud\\/hastexoneutrontraining\\/openstack-charlie.ova' is not readable !!!\",\"level\":0,\"time\":\"december 16, 2013 15:11:35\"}\r\n{\"app\":\"hook\",\"message\":\"error while running hook (oca\\\\search_lucene\\\\hooks::indexfile): an exception occurred while executing 'insert into \\\"oc_jobs\\\"(\\\"class\\\", \\\"argument\\\", \\\"last_run\\\") values(?, ?, 0)':\\n\\nsqlstate[22001]: string data, right truncated: 7 error:  value too long for type character varying(256)\",\"level\":3,\"time\":\"december 16, 2013 15:11:35\"}\r\n```\r\n\r\n\r\n#### other information\r\n\r\nthere is a ha proxy loadbalancer with a \"timeout server 3m\" statement in front of 2 apache application servers. is it possible that this process takes longer than 3 minutes? the app servers are 8 vcpu, 16gb ram virtual machines.\r\n \r\nthe files are stored on an nfs server (and the two webservers that host owncloud both mount that directory)\r\n\r\nencryption of files is enabled\r\n\r\nuser authentication is done through ldap\r\n","closed_by":{"login":"raghunayyar","id":992488,"avatar_url":"https://gravatar.com/avatar/d85a28e964af11d2ef245264d37b5e8b?d=https%3a%2f%2fidenticons.github.com%2ff5014f6d6151da0207a8dfeb3234e777.png&r=x","gravatar_id":"d85a28e964af11d2ef245264d37b5e8b","url":"https://api.github.com/users/raghunayyar","html_url":"https://github.com/raghunayyar","followers_url":"https://api.github.com/users/raghunayyar/followers","following_url":"https://api.github.com/users/raghunayyar/following{/other_user}","gists_url":"https://api.github.com/users/raghunayyar/gists{/gist_id}","starred_url":"https://api.github.com/users/raghunayyar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raghunayyar/subscriptions","organizations_url":"https://api.github.com/users/raghunayyar/orgs","repos_url":"https://api.github.com/users/raghunayyar/repos","events_url":"https://api.github.com/users/raghunayyar/events{/privacy}","received_events_url":"https://api.github.com/users/raghunayyar/received_events","type":"user","site_admin":false}}