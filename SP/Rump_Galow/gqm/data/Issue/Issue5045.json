{"url":"https://api.github.com/repos/owncloud/core/issues/5045","labels_url":"https://api.github.com/repos/owncloud/core/issues/5045/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/5045/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/5045/events","html_url":"https://github.com/owncloud/core/issues/5045","id":20282343,"number":5045,"title":"cannot upgrade from 4.5.13 to 5.0.x","user":{"login":"kneiser","id":3117010,"avatar_url":"https://gravatar.com/avatar/821071babc57df5fc1fcfe34483523ab?d=https%3a%2f%2fidenticons.github.com%2fc0d60f6e233e5780167cfb3d8a52d4cf.png&r=x","gravatar_id":"821071babc57df5fc1fcfe34483523ab","url":"https://api.github.com/users/kneiser","html_url":"https://github.com/kneiser","followers_url":"https://api.github.com/users/kneiser/followers","following_url":"https://api.github.com/users/kneiser/following{/other_user}","gists_url":"https://api.github.com/users/kneiser/gists{/gist_id}","starred_url":"https://api.github.com/users/kneiser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kneiser/subscriptions","organizations_url":"https://api.github.com/users/kneiser/orgs","repos_url":"https://api.github.com/users/kneiser/repos","events_url":"https://api.github.com/users/kneiser/events{/privacy}","received_events_url":"https://api.github.com/users/kneiser/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"open","assignee":null,"milestone":null,"comments":23,"created_at":"2013-09-30t18:42:03z","updated_at":"2013-11-29t16:09:59z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### problem description:\r\nafter upgrading (not update) from owncloud v4.5.13 to v5.0.x folders and files appear in the owncloud \"admin\" user account. while a \"normal user\" account some folders and files owned have disappeared. symptoms such as this have been reported on the owncloud forum, normal course of action in the past has been to recommend the \"truncation\" of records in the owncloud file cache table(s). doing this resolves the folder and file assignments issue but then all sharing of folders by security group and files by link or direct assignment setups are destroyed. breaking the sharing setups have to be setup again, in larger owncloud instances this is not good as there can be a lot of complex sharing setups.\r\n\r\n### test machine:\r\n* fedora 19 operating system.\r\n* apache v2.4.6\r\n* php v5.5.3\r\n* mariadb v5.5.32\r\n* upgrade owncloud v4.5.13 to v5.0.x.\r\n* after installation of v5.0.x the v4.5.13 data is restored from backup using rsync. only the data files, database dump, and oc config file are restored.\r\n* data configuration:\r\n    - oc admin user.\r\n    - normal user, account of the tester, contains different types of data files of which only one is shared out by public link.\r\n    - three test user accounts. main test user owns 4 different file types that are shared only by folder or individual file sharing to other two test users.\r\n    - one test user assigned full read-write access at folder level via oc security group.\r\n    - one test user assigned read only to 3 file types and read-write access to a text file.\r\n![oc test use cases](https://f.cloud.github.com/assets/3117010/1247523/cf5b077a-2abc-11e3-8092-b27283016d0d.jpg)\r\n![oc test objects](https://f.cloud.github.com/assets/3117010/1247524/cf7e38e4-2abc-11e3-8e7e-c92269cecc52.jpg)\r\n\r\n### testing:\r\n* remove owncloud and database instance from server.\r\n* install owncloud on server. mariadb has owncloud instance with 36 tables .\r\n* restore owncloud from backups per specifications required for an \"upgrade\". \r\n* do database dump of owncloud instance.\r\n* start internet browser, owncloud maintenance mode starts. \r\n* login as owncloud \"admin user\", navigate to \"admin\".\r\n* folders from other users (normal user)appear. navigate in to one of the folders, nothing happens. cannot delete them. \"admin\" user not part of sharing setup in this test setup. cannot delete them.\r\n* can set maximum upload size ( to 2gb) and save with no problem.\r\n* all other settings seem fine, including external storage setting from prior v4.5.x instance.\r\n* login to an existing \"normal\" user (not test users). folders are missing (they appear in admin user). only one folder appears (set up for external storage folder). \r\n* normal user, local storage folder empty (sharing for videos). worked fine in 5.0.12. navigate in to folder, folder empty.\r\n* admin user, checked users normal user is defined in the correct security group for local storage.\r\n* test0 user, sharing by folder. sharing seems to be defined correctly.\r\n* test1user, shared folder shared folder from test0 appears. files in folder share correctly.\r\n* test2 user, shared folder appears. shows shared files from test0. files shared correctly.\r\n* test2 user, does not show shared file by link from normal user.\r\n* open a remote terminal session and run owncloud file scan script.\r\n  command-line syntax:\r\n  php console.php files:scan <user_id> #for rescanning a users file\r\n  php console.php files:scan --all #for rescanning the files of all users\r\n* change directory: cd /var/hda/web-apps/owncloud/html/\r\n* file scan for \"all\" users:  **php console.php files:scan --all**\r\n* file rescans of all users: **php console.php files:scan --all** folders and files for all users appear in the script run.\r\n* login to admin user. folders still there.\r\n* do database dump of owncloud instance.\r\n* admin still sees normal user folders still there.\r\n* normal user local storage folder still empty.\r\n* admin reset local storage security group to the same one.\r\n* admin reset normal user to security group for local storage.\r\n* normal user local storage\r\n* test0 shared attribute for each file shows correct sharing to other users.\r\n* test1 folder sharing still works fine.\r\n* test2 direct file sharing still works fine.\r\n* test2 still does not show shared file by link from normal user.\r\n* deleted external storage setup including security group. \r\n* redefined external storage setup including security group.\r\n* do database dump of owncloud instance.\r\n* external storage still does not work.\r\n\r\n### testing completed:\r\nplease provide guidance for helping resolve this issue.\r\n","closed_by":null}