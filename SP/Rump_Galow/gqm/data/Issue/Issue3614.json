{"url":"https://api.github.com/repos/owncloud/core/issues/3614","labels_url":"https://api.github.com/repos/owncloud/core/issues/3614/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3614/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3614/events","html_url":"https://github.com/owncloud/core/issues/3614","id":15225787,"number":3614,"title":"'new -> from link'-download fails with redirections/rewrites/forwardings","user":{"login":"renneb","id":4548652,"avatar_url":"https://gravatar.com/avatar/0eb824e78e77875a2ad73f9811b8a5d2?d=https%3a%2f%2fidenticons.github.com%2fb6a386062391b26affe710b30a952208.png&r=x","gravatar_id":"0eb824e78e77875a2ad73f9811b8a5d2","url":"https://api.github.com/users/renneb","html_url":"https://github.com/renneb","followers_url":"https://api.github.com/users/renneb/followers","following_url":"https://api.github.com/users/renneb/following{/other_user}","gists_url":"https://api.github.com/users/renneb/gists{/gist_id}","starred_url":"https://api.github.com/users/renneb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/renneb/subscriptions","organizations_url":"https://api.github.com/users/renneb/orgs","repos_url":"https://api.github.com/users/renneb/repos","events_url":"https://api.github.com/users/renneb/events{/privacy}","received_events_url":"https://api.github.com/users/renneb/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2013-06-06t14:36:09z","updated_at":"2013-08-16t22:07:44z","closed_at":"2013-08-16t22:07:44z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"1.) if any url is entered which redirects or forwards, the html-content of the redirection/forwarding is downloaded instead of the real file.\r\n\r\n2.) the file name is created from the url-parameters instead of the the content-header.\r\n\r\nthat two bugs make the link-download function quite useless.\r\n\r\n\r\n\r\nsolution for phpcurl:\r\n\r\n1.) use option ```curlopt_followlocation => true``` to follow redirects\r\n\r\n2.) use option ```curlopt_headerfunction => array($this, 'getheader')``` to get the content-header with the function\r\n\r\n```\r\nprivate function getheader($con, $header) {\r\n\r\n    /* parse header */\r\n\r\n    // !!! necessary for curl to work !!!\r\n    return mb_strlen($header);\r\n}\r\n```\r\n\r\nhttp://gitorious.org/hltvdlm/hltvdlm/blobs/master/curl.php provides an example for downloading files with phpcurl.","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}