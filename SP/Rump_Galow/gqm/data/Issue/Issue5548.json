{"url":"https://api.github.com/repos/owncloud/core/issues/5548","labels_url":"https://api.github.com/repos/owncloud/core/issues/5548/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/5548/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/5548/events","html_url":"https://github.com/owncloud/core/issues/5548","id":21589059,"number":5548,"title":"heavy db workload after adding a new file inside a folder","user":{"login":"jvillafanez","id":1477829,"avatar_url":"https://gravatar.com/avatar/f422e6935e3ae694168c71e02b988ef2?d=https%3a%2f%2fidenticons.github.com%2f0929e47aa842da706b9c79f4c549ae04.png&r=x","gravatar_id":"f422e6935e3ae694168c71e02b988ef2","url":"https://api.github.com/users/jvillafanez","html_url":"https://github.com/jvillafanez","followers_url":"https://api.github.com/users/jvillafanez/followers","following_url":"https://api.github.com/users/jvillafanez/following{/other_user}","gists_url":"https://api.github.com/users/jvillafanez/gists{/gist_id}","starred_url":"https://api.github.com/users/jvillafanez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvillafanez/subscriptions","organizations_url":"https://api.github.com/users/jvillafanez/orgs","repos_url":"https://api.github.com/users/jvillafanez/repos","events_url":"https://api.github.com/users/jvillafanez/events{/privacy}","received_events_url":"https://api.github.com/users/jvillafanez/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"open","assignee":null,"milestone":null,"comments":6,"created_at":"2013-10-25t13:08:02z","updated_at":"2013-10-30t10:58:26z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"consider a folder with 530+ folders inside, and some files scattered in those folders.\r\n\r\n### expected behaviour\r\nafter uploading a file, page should be loaded just slightly slower than before uploading the file\r\n\r\n### actual behaviour\r\nthe page loading time is increased dramatically. if \"standard\" timing is 7 secs, then we're talking about 16 secs or more in the best scenario.\r\nwith sqlite3 db, the error \"5 database is locked\" happens very often, causing erratic behaviour\r\n\r\n![screenshot from 2013-10-25 14 35 24](https://f.cloud.github.com/assets/1477829/1407705/0f586826-3d74-11e3-8ec6-4bed0bbca081.png)\r\n\r\n### steps to reproduce\r\nunder the above conditions and supposing that /531groups folder contains more than 530 folders:\r\n1. check timing\r\n2. upload a file inside one of those folders (/531groups/group1/file.png)\r\n3. navigate through fs\r\n4. check that timing is degraded\r\n\r\n### server configuration\r\ndatabase: sqlite3\r\n\r\nphp version: php 5.3.10-1ubuntu3.8\r\n\r\nowncloud version: {\"installed\":\"true\",\"version\":\"6.0.0.2\",\"versionstring\":\"6.0 beta 1\",\"edition\":\"\"}\r\n\r\n### client configuration\r\nbrowser: firefox, chrome\r\n\r\nnotice: following screenshot shows profiling of a request to the equivalent to /531groups folder (real request was done to an external storage with the same set of conditions as described)\r\nthere are too many requests to set permissions consuming too much time just to upload a new file. these requests may cause a heavy workload on the sqlite3 db during scanning which might cause the db locked error.\r\n\r\n![screenshot from 2013-10-25 14 35 55](https://f.cloud.github.com/assets/1477829/1407764/27d52794-3d75-11e3-8ab1-d8f4cc521628.png)\r\n","closed_by":null}