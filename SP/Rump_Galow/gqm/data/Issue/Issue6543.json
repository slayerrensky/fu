{"url":"https://api.github.com/repos/owncloud/core/issues/6543","labels_url":"https://api.github.com/repos/owncloud/core/issues/6543/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/6543/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/6543/events","html_url":"https://github.com/owncloud/core/issues/6543","id":24666557,"number":6543,"title":"thousands of propfind requests even the client was fully synced, results in redownloading all files","user":{"login":"windaishi","id":6232639,"avatar_url":"https://gravatar.com/avatar/fa29e534948f57127f39d7462d8eaeaf?d=https%3a%2f%2fidenticons.github.com%2f09237aef47c831d7ea09114195c20969.png&r=x","gravatar_id":"fa29e534948f57127f39d7462d8eaeaf","url":"https://api.github.com/users/windaishi","html_url":"https://github.com/windaishi","followers_url":"https://api.github.com/users/windaishi/followers","following_url":"https://api.github.com/users/windaishi/following{/other_user}","gists_url":"https://api.github.com/users/windaishi/gists{/gist_id}","starred_url":"https://api.github.com/users/windaishi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/windaishi/subscriptions","organizations_url":"https://api.github.com/users/windaishi/orgs","repos_url":"https://api.github.com/users/windaishi/repos","events_url":"https://api.github.com/users/windaishi/events{/privacy}","received_events_url":"https://api.github.com/users/windaishi/received_events","type":"user","site_admin":false},"labels":[],"state":"open","assignee":null,"milestone":null,"comments":1,"created_at":"2013-12-21t15:36:55z","updated_at":"2013-12-22t09:21:06z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### circumstances\r\ni synced about 178 gb of data in 58,015 files in 5,170 directories.\r\nthe client has finished the upload completely and all files are available online via webinterface.\r\n\r\n### expected behaviour\r\nwhen restarting the client, it should take only some second or minutes until the client is ready. it should not redownload the existing files.\r\n\r\n### actual behaviour\r\nit takes a couple of minutes until the local files were scanned. then the client sends thousands of propfind request to the webserver, one for each directory causing heavy load on the webserver. when finished (after about an hour) the clients starts to download all files, all 178gb of data\r\n\r\n### steps to reproduce\r\n1. sync all files\r\n2. restart client\r\n\r\n(worked several times on my system)\r\n\r\n### server configuration\r\noperating system: windows server 2003\r\n\r\nweb server: apache/2.2.26\r\n\r\ndatabase: mysql 5.5.25\r\n\r\nphp version: 5.4.22\r\n\r\nowncloud version: owncloud 6.0.0a (stable)\r\n\r\nupdated from an older owncloud or fresh install: fresh install\r\n\r\nlist of activated app:\r\nactivity\r\ncalendar\r\ncontacts\r\ndeleted files\r\ndocuments\r\nfirst run wizard\r\nfull text search\r\nowncloud dependencies info\r\npdf viewer\r\npictures\r\nshare files\r\ntext editor\r\nupdater\r\nversions\r\n\r\n\r\nthe content of config/config.php: (without the database password and passwordsalt)\r\n\r\nare you using external storage, if yes which one: no\r\n\r\n### client configuration\r\nbrowser: n/a\r\n\r\noperating system: windows 7 x64\r\n\r\nsync client: 1.5\r\n\r\n### logs\r\n\r\n#### web access log\r\n```\r\n192.168.2.21 - - [21/dec/2013:16:29:56 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/205/1/.cp/icons/full/elcl16 http/1.1\" 207 1103\r\n192.168.2.21 - - [21/dec/2013:16:29:56 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/205/1/.cp/icons/full/dlcl16 http/1.1\" 207 1968\r\n192.168.2.21 - - [21/dec/2013:16:29:57 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/205/1/.cp/icons/full/cview16 http/1.1\" 207 1110\r\n192.168.2.21 - - [21/dec/2013:16:29:57 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/205/1/.cp/icons/full/clcl16 http/1.1\" 207 1968\r\n192.168.2.21 - - [21/dec/2013:16:29:57 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/204 http/1.1\" 207 1139\r\n192.168.2.21 - - [21/dec/2013:16:29:57 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/204/1 http/1.1\" 207 1145\r\n192.168.2.21 - - [21/dec/2013:16:29:58 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/204/1/.cp http/1.1\" 207 1155\r\n192.168.2.21 - - [21/dec/2013:16:29:58 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/204/1/.cp/icons http/1.1\" 207 1678\r\n192.168.2.21 - - [21/dec/2013:16:29:58 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/204/1/.cp/icons/obj16 http/1.1\" 207 1098\r\n192.168.2.21 - - [21/dec/2013:16:29:59 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/204/1/.cp/icons/elcl16 http/1.1\" 207 3271\r\n192.168.2.21 - - [21/dec/2013:16:29:59 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202 http/1.1\" 207 1139\r\n192.168.2.21 - - [21/dec/2013:16:29:59 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1 http/1.1\" 207 1145\r\n192.168.2.21 - - [21/dec/2013:16:29:59 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp http/1.1\" 207 1155\r\n192.168.2.21 - - [21/dec/2013:16:30:00 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons http/1.1\" 207 1166\r\n192.168.2.21 - - [21/dec/2013:16:30:00 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full http/1.1\" 207 4794\r\n192.168.2.21 - - [21/dec/2013:16:30:00 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/wizban http/1.1\" 207 1980\r\n192.168.2.21 - - [21/dec/2013:16:30:01 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/progress http/1.1\" 207 2438\r\n192.168.2.21 - - [21/dec/2013:16:30:01 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/obj16 http/1.1\" 207 2839\r\n192.168.2.21 - - [21/dec/2013:16:30:02 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/eview16 http/1.1\" 207 1551\r\n192.168.2.21 - - [21/dec/2013:16:30:02 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/etool16 http/1.1\" 207 8113\r\n192.168.2.21 - - [21/dec/2013:16:30:02 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/elcl16 http/1.1\" 207 5040\r\n192.168.2.21 - - [21/dec/2013:16:30:03 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/dtool16 http/1.1\" 207 3294\r\n192.168.2.21 - - [21/dec/2013:16:30:03 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/202/1/.cp/icons/full/dlcl16 http/1.1\" 207 3300\r\n192.168.2.21 - - [21/dec/2013:16:30:04 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200 http/1.1\" 207 1139\r\n192.168.2.21 - - [21/dec/2013:16:30:04 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1 http/1.1\" 207 1145\r\n192.168.2.21 - - [21/dec/2013:16:30:04 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp http/1.1\" 207 1155\r\n192.168.2.21 - - [21/dec/2013:16:30:05 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp/icons http/1.1\" 207 1166\r\n192.168.2.21 - - [21/dec/2013:16:30:05 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp/icons/full http/1.1\" 207 3240\r\n192.168.2.21 - - [21/dec/2013:16:30:05 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp/icons/full/wizban http/1.1\" 207 1109\r\n192.168.2.21 - - [21/dec/2013:16:30:05 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp/icons/full/obj http/1.1\" 207 1111\r\n192.168.2.21 - - [21/dec/2013:16:30:06 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp/icons/full/eview16 http/1.1\" 207 1549\r\n192.168.2.21 - - [21/dec/2013:16:30:06 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp/icons/full/elcl16 http/1.1\" 207 8568\r\n192.168.2.21 - - [21/dec/2013:16:30:07 +0100] \"propfind /remote.php/webdav/ablage/eclipse/configuration/org.eclipse.osgi/bundles/200/1/.cp/icons/full/dlcl16 http/1.1\" 207 5938\r\n```\r\n\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\nfatal \tcore \tunable to parse ocs content \t2013-12-21t15:29:02+00:00\r\nfatal \tcore \tunable to parse ocs content \t2013-12-21t15:28:14+00:00\r\nwarning \tcore \tauthentication cookie rejected for user admin \t2013-12-21t14:52:26+00:00\r\nwarning\tcore\tauthentication cookie rejected for user admin\t2013-12-21t00:21:00+00:00\r\nwarning\tcore\tauthentication cookie rejected for user admin\t2013-12-21t00:20:50+00:00\r\nwarning\tphp\tfile_get_contents(e:\\owncloud/admin/files/entwicklung/projekte/tstools/htdocs/include/fun.inc.php): failed to open stream: no such file or directory at d:\\www\\owncloud\\lib\\private\\files\\storage\\mappedlocal.php#153\t2013-12-20t22:42:35+00:00\r\nwarning\tphp\tfilemtime(): stat failed for e:\\owncloud/admin/files/entwicklung/projekte/tstools/htdocs/include/fun.inc.php at d:\\www\\owncloud\\lib\\private\\files\\storage\\mappedlocal.php#135\t2013-12-20t22:42:35+00:00\r\nwarning\tphp\tcall_user_func() expects parameter 1 to be a valid callback, first array member is not a valid class name or object at d:\\www\\owncloud\\lib\\private\\backgroundjob\\legacy\\queuedjob.php#16\t2013-12-20t22:20:35+00:00\r\nwarning\tphp\tcall_user_func() expects parameter 1 to be a valid callback, first array member is not a valid class name or object at d:\\www\\owncloud\\lib\\private\\backgroundjob\\legacy\\queuedjob.php#16\t2013-12-20t22:20:35+00:00\r\nwarning\tphp\tcall_user_func() expects parameter 1 to be a valid callback, first array member is not a valid class name or object at d:\\www\\owncloud\\lib\\private\\backgroundjob\\legacy\\queuedjob.php#16\t2013-12-20t22:20:32+00:00\r\nwarning\tphp\tcall_user_func() expects parameter 1 to be a valid callback, first array member is not a valid class name or object at d:\\www\\owncloud\\lib\\private\\backgroundjob\\legacy\\queuedjob.php#16\t2013-12-20t22:20:32+00:00\r\nwarning\tphp\tcall_user_func() expects parameter 1 to be a valid callback, first array member is not a valid class name or object at d:\\www\\owncloud\\lib\\private\\backgroundjob\\legacy\\queuedjob.php#16\t2013-12-20t22:20:32+00:00\r\nwarning\tphp\tcall_user_func() expects parameter 1 to be a valid callback, first array member is not a valid class name or object at d:\\www\\owncloud\\lib\\private\\backgroundjob\\legacy\\queuedjob.php#16\t2013-12-20t22:11:12+00:00\r\n```\r\n","closed_by":null}