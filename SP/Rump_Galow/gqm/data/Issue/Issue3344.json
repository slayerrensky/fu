{"url":"https://api.github.com/repos/owncloud/core/issues/3344","labels_url":"https://api.github.com/repos/owncloud/core/issues/3344/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3344/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3344/events","html_url":"https://github.com/owncloud/core/issues/3344","id":14308427,"number":3344,"title":"moving directories between external storage (google drive, dropbox) and oc storage leads to data loss","user":{"login":"absynth47215","id":3737316,"avatar_url":"https://gravatar.com/avatar/30225104afce1327a6d910fdb6c59df0?d=https%3a%2f%2fidenticons.github.com%2f95bf3c6e624c27fcc136b9ec6a86d024.png&r=x","gravatar_id":"30225104afce1327a6d910fdb6c59df0","url":"https://api.github.com/users/absynth47215","html_url":"https://github.com/absynth47215","followers_url":"https://api.github.com/users/absynth47215/followers","following_url":"https://api.github.com/users/absynth47215/following{/other_user}","gists_url":"https://api.github.com/users/absynth47215/gists{/gist_id}","starred_url":"https://api.github.com/users/absynth47215/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/absynth47215/subscriptions","organizations_url":"https://api.github.com/users/absynth47215/orgs","repos_url":"https://api.github.com/users/absynth47215/repos","events_url":"https://api.github.com/users/absynth47215/events{/privacy}","received_events_url":"https://api.github.com/users/absynth47215/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/app%3afiles","name":"app:files","color":"02d7e1"},{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":5,"created_at":"2013-05-14t13:03:49z","updated_at":"2013-05-24t00:45:08z","closed_at":"2013-05-24t00:45:08z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### affected apps\r\nfiles_external\r\n\r\n### expected behaviour\r\nmoving directories between the external mounts and the internal storage via the web gui should move the directories, not prune them.\r\n\r\n### actual behaviour\r\nwhen moving (drag&dropping to the breadcrumb / area), a directory between a mountpoint on google drive or dropbox (maybe others, i only tested these two) and the internal storage of an owncloud instance, the data is destroyed. a 0-byte file is created in the target folder, and the source folder is deleted on the external storage, leading to immediate and irrevocable data loss.\r\nthe gui displays an error popup saying \"folder <name> could not be moved\" and a couple error messages (see below) are logged. \r\n\r\n### steps to reproduce\r\n1. mount external storage (dropbox, googledrive) via the web gui.\r\n2. create a directory on a mounted external storage and upload 1 or more files.\r\n3. drag&drop the directory to the \"home\" breadcrumb.\r\n4. observe full and irrevocable destruction of said directory, and behold a 0 byte file in the destination folder.\r\n\r\n### server configuration\r\noperating system:\r\ndeb squeeze\r\nweb server: \r\napache 2.2.16\r\ndatabase:\r\nsqlite\r\nphp version:\r\n5.3.3-7 squeeze + suhosin\r\nowncloud version:\r\n5.0.6\r\n### client configuration\r\nbrowser:\r\nfirefox 20\r\noperating system:\r\nmacos x\r\n### logs\r\n#### web server error log\r\n79.208.102.221 - - [14/may/2013:14:58:34 +0200] \"post /index.php/apps/files/ajax/move.php http/1.1\" 200 482 \"http://oc5-test.filoo.de/index.php/apps/files?dir=/googledrive\" \"mozilla/5.0 (macintosh; intel mac os x 10.8; rv:20.0) gecko/20100101 firefox/20.0\"\r\n#### owncloud log (data/owncloud.log)\r\n{\"app\":\"php\",\"message\":\"undefined index: target at \\/var\\/www\\/oc5-test.filoo.de\\/apps\\/files\\/ajax\\/move.php#12\",\"level\":2,\"time\":1368536314}\r\n{\"app\":\"php\",\"message\":\"fopen(): filename cannot be empty at \\/var\\/www\\/oc5-test.filoo.de\\/apps\\/files_external\\/lib\\/google.php#433\",\"level\":2,\"time\":1368536314}\r\n{\"app\":\"php\",\"message\":\"fread(): length parameter must be greater than 0 at \\/var\\/www\\/oc5-test.filoo.de\\/apps\\/files_external\\/lib\\/google.php#522\",\"level\":2,\"time\":1368536332}\r\n#### browser log\r\nnot applicable\r\n","closed_by":{"login":"mtgap","id":1097106,"avatar_url":"https://gravatar.com/avatar/454a73ee5feeb428d0c163a48903332c?d=https%3a%2f%2fidenticons.github.com%2f52d29a66f285a1d61125dd69ac0766b2.png&r=x","gravatar_id":"454a73ee5feeb428d0c163a48903332c","url":"https://api.github.com/users/mtgap","html_url":"https://github.com/mtgap","followers_url":"https://api.github.com/users/mtgap/followers","following_url":"https://api.github.com/users/mtgap/following{/other_user}","gists_url":"https://api.github.com/users/mtgap/gists{/gist_id}","starred_url":"https://api.github.com/users/mtgap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtgap/subscriptions","organizations_url":"https://api.github.com/users/mtgap/orgs","repos_url":"https://api.github.com/users/mtgap/repos","events_url":"https://api.github.com/users/mtgap/events{/privacy}","received_events_url":"https://api.github.com/users/mtgap/received_events","type":"user","site_admin":false}}