{"url":"https://api.github.com/repos/owncloud/core/issues/673","labels_url":"https://api.github.com/repos/owncloud/core/issues/673/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/673/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/673/events","html_url":"https://github.com/owncloud/core/pull/673","id":8909584,"number":673,"title":"filecache rewrite","user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":71,"created_at":"2012-12-02t02:56:23z","updated_at":"2013-01-30t22:04:08z","closed_at":"2013-01-30t21:22:33z","pull_request":{"html_url":"https://github.com/owncloud/core/pull/673","diff_url":"https://github.com/owncloud/core/pull/673.diff","patch_url":"https://github.com/owncloud/core/pull/673.patch"},"body":"this implements a complete rewrite of the filesystem metadata cache and large changes around the rest of the filesystem classes.\r\n\r\nthe biggest change for the cache is that the cache now runs dirrectly on top of the storage backends instead of on top of the rest of of the filesystem layers.\r\nthis means that each instance of the cache is tied to a single storage backend and the cache holds no information about where the storage is mounted,\r\nthis seperation between the storage backends and filesystem means that the cache can be re-used when a storage backend is mounted in several places.\r\nbecause of this, on row in the filecache table can hold information of a file available to mutliply users and thus the file permissions cache has been moved to a seperate table\r\n\r\nthis does mean that the cache no longer directly provides an easy to use api, instead filesystem view provides an api which glues together everything into a proper api.\r\n\r\nstorage backends now also have the option to overwride caching, scanning and permissions behaviour so backends can provide specialized behaviour when needed.\r\nthe main usage for this is sharing which already has all the metadata stored in the sharing table and the filecache of the source file and it can be used to increase scanning performance for archives.\r\n\r\nthe main cache api now consists of the following functions\r\n- \\oc\\files\\filesystem::getfileinfo($path)\r\n- \\oc\\files\\filesystem::putfileinfo($path)\r\n- \\oc\\files\\filesystem::getdirectorycontent($path)\r\n- \\oc\\files\\filesystem::search($query)\r\n- \\oc\\files\\filesystem::searchbymime($mimetype) (accepts both 'text/plain' and wildcard 'text' style mimetypes)\r\n\r\ngetfileinfo and getdirectorycontent are still available in their old place, oc_files for now\r\n\r\n\r\nthe other main change is that most parts of the filesystem stack have been renamed and moved into namespaces\r\n- oc_filesystem -> \\oc\\files\\filesystem\r\n- oc_filesystemview -> \\oc\\files\\view\r\n- oc_filestorage_* -> \\oc\\files\\storage\\*\r\n- oc_filecache has been split into \\oc\\files\\cache\\cache, \\oc\\files\\cache\\scanner, \\oc\\files\\cache\\permissions, \\oc\\files\\cache\\watcher and \\oc\\files\\cache\\updater\r\n\r\noc_filesystem and oc_filesystemview are still available through their old names for compatibility for now.\r\n\r\n\r\ni'm not expecting changes this big to go without problems, so please do as much testing as possible\r\n\r\ndon't forget to also update the apps repo https://github.com/owncloud/apps/pull/289","closed_by":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false}}