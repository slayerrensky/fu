{"url":"https://api.github.com/repos/owncloud/core/issues/4407","labels_url":"https://api.github.com/repos/owncloud/core/issues/4407/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4407/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4407/events","html_url":"https://github.com/owncloud/core/issues/4407","id":17993025,"number":4407,"title":"oc 5.0.10 - sqlstate[08004] [1040] too many connections","user":{"login":"mightycoco","id":1306985,"avatar_url":"https://gravatar.com/avatar/4d1a98e1d0a0fdabb6c370680824ba5d?d=https%3a%2f%2fidenticons.github.com%2fa40e3c2b2bef06189f4b564c80356bf4.png&r=x","gravatar_id":"4d1a98e1d0a0fdabb6c370680824ba5d","url":"https://api.github.com/users/mightycoco","html_url":"https://github.com/mightycoco","followers_url":"https://api.github.com/users/mightycoco/followers","following_url":"https://api.github.com/users/mightycoco/following{/other_user}","gists_url":"https://api.github.com/users/mightycoco/gists{/gist_id}","starred_url":"https://api.github.com/users/mightycoco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mightycoco/subscriptions","organizations_url":"https://api.github.com/users/mightycoco/orgs","repos_url":"https://api.github.com/users/mightycoco/repos","events_url":"https://api.github.com/users/mightycoco/events{/privacy}","received_events_url":"https://api.github.com/users/mightycoco/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":3,"created_at":"2013-08-13t12:12:11z","updated_at":"2013-10-18t10:14:11z","closed_at":"2013-10-18t10:14:11z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\navailability of db connection to mysql after upgrading from 5.0.9 to 5.0.10\r\n\r\n### actual behaviour\r\nafter a couple of minutes the owncloud.log shows following error message and doesn't recover until the db-server is restarted:\r\n\r\n```\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392813}\r\n```\r\n\r\n### steps to reproduce\r\n1) upgrade from 5.0..9 to 5.0.10\r\n2) don't change any settings leaving the working 5.0.9 settings\r\n    a) my.cnf\r\n    b) php.ini\r\n    c) oc\r\n\r\n### server configuration\r\noperating system:\r\n```\r\nlinux xxx 3.6.11+ #474 preempt thu jun 13 17:14:42 bst 2013 armv6l gnu/linux\r\n```\r\n\r\nweb server: \r\n```\r\nserver version: apache/2.2.22 (debian)\r\nserver built:   mar 10 2013 05:34:48\r\nserver's module magic number: 20051115:30\r\nserver loaded:  apr 1.4.6, apr-util 1.4.1\r\ncompiled using: apr 1.4.6, apr-util 1.4.1\r\narchitecture:   32-bit\r\nserver mpm:     prefork\r\n  threaded:     no\r\n    forked:     yes (variable process count)\r\nserver compiled with....\r\n -d apache_mpm_dir=\"server/mpm/prefork\"\r\n -d apr_has_sendfile\r\n -d apr_has_mmap\r\n -d apr_have_ipv6 (ipv4-mapped addresses enabled)\r\n -d apr_use_sysvsem_serialize\r\n -d apr_use_pthread_serialize\r\n -d apr_has_other_child\r\n -d ap_have_reliable_piped_logs\r\n -d dynamic_module_limit=128\r\n -d httpd_root=\"/etc/apache2\"\r\n -d suexec_bin=\"/usr/lib/apache2/suexec\"\r\n -d default_pidlog=\"/var/run/apache2.pid\"\r\n -d default_scoreboard=\"logs/apache_runtime_status\"\r\n -d default_lockfile=\"/var/run/apache2/accept.lock\"\r\n -d default_errorlog=\"logs/error_log\"\r\n -d ap_types_config_file=\"mime.types\"\r\n -d server_config_file=\"apache2.conf\"\r\n```\r\n\r\ndatabase:\r\n```\r\nmysql  ver 14.14 distrib 5.5.31, for debian-linux-gnu (armv7l) using readline 6.2\r\n```\r\n\r\nphp version:\r\n```\r\nphp 5.4.4-14+deb7u3 (cli) (built: jul 18 2013 01:01:56)\r\ncopyright (c) 1997-2012 the php group\r\nzend engine v2.4.0, copyright (c) 1998-2012 zend technologies\r\n    with xcache v2.0.0, copyright (c) 2005-2012, by moo\r\n```\r\n\r\nowncloud version:\r\n5.0.10\r\n\r\n### client configuration\r\nbrowser:\r\nreporudable in all browsers and sync client 1.3.0 for windows\r\n\r\noperating system:\r\nirrelevant\r\n\r\n### logs\r\n#### web server error log\r\n```\r\nno related information found\r\n```\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n~# tail /var/www/owncloud/data/owncloud.log\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392813}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392841}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392841}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392842}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392870}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392870}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392871}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392899}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392899}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392899}\r\n{\"app\":\"core\",\"message\":\"sqlstate[hy000] [1040] too many connections\",\"level\":4,\"time\":1376392928}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392928}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392928}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392956}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392957}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392957}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392985}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392985}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376392986}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376393014}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376393014}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376393014}\r\n{\"app\":\"core\",\"message\":\"sqlstate[hy000] [1040] too many connections\",\"level\":4,\"time\":1376393043}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376393043}\r\n{\"app\":\"core\",\"message\":\"sqlstate[08004] [1040] too many connections\",\"level\":4,\"time\":1376393043}\r\n```\r\n\r\n#### browser log\r\n```\r\n```","closed_by":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false}}