{"url":"https://api.github.com/repos/owncloud/core/issues/892","labels_url":"https://api.github.com/repos/owncloud/core/issues/892/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/892/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/892/events","html_url":"https://github.com/owncloud/core/issues/892","id":9296890,"number":892,"title":"oc-1880  -  duplicate entry in fscache and as a result web interface ","user":{"login":"msrex","id":2625328,"avatar_url":"https://gravatar.com/avatar/24738c0908dad69b83af9cc534bcca80?d=https%3a%2f%2fidenticons.github.com%2ff02814cb1648a9552774c0f932619e91.png&r=x","gravatar_id":"24738c0908dad69b83af9cc534bcca80","url":"https://api.github.com/users/msrex","html_url":"https://github.com/msrex","followers_url":"https://api.github.com/users/msrex/followers","following_url":"https://api.github.com/users/msrex/following{/other_user}","gists_url":"https://api.github.com/users/msrex/gists{/gist_id}","starred_url":"https://api.github.com/users/msrex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msrex/subscriptions","organizations_url":"https://api.github.com/users/msrex/orgs","repos_url":"https://api.github.com/users/msrex/repos","events_url":"https://api.github.com/users/msrex/events{/privacy}","received_events_url":"https://api.github.com/users/msrex/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/5+-+to+review","name":"5 - to review","color":"ededed"},{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"milestone":null,"comments":3,"created_at":"2012-12-14t20:40:20z","updated_at":"2013-08-06t21:53:37z","closed_at":"2013-08-06t21:53:37z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"from http://bugs.owncloud.org/thebuggenie/owncloud/issues/oc-1880\r\n\r\n@dragotin @icewind1991 @butonic - is that fixed?\r\n\r\ndescription:\r\nfilesystem cache routine seem not to normalize filenames on write. that leads to duplicate file appearance in the fscache-table and the web interface. if for example the sync client or a webdav client puts on a filename like /test//foo.bar it is not considered the same file as /test/foo.bar\r\n\r\nthe fullpath name should be normalized.\r\n\r\n\r\nreproduction steps:\r\nput on a file once and than on the same file name with doubled slashes somewhere\r\n\r\n#4 comment posted by freitag oct 01, 07:34\r\na file was uploaded.\r\ndoublicates on web interface\r\ndoublicates on web interfaceicon_open_new.png\r\n\r\n#5 comment posted by freitag oct 04, 09:32\r\nthe same effect can be seen on the freenet test installation.\r\n\r\n#6 comment posted by jã¶rn dreyer oct 09, 11:59\r\ni just debugged the freenet issue. it is caused by the oc_cache::getusercache to return -1 for the file id. in getid i got it working with adding a check for -1:\r\n\r\n@line 282 in lib/filecache.php\r\n```\r\n\t$fullpath=$root.$path;\r\n\t\tif(($cache=oc_cache::getusercache(true)) && $cache->haskey('fileid/'.$fullpath)) {\r\n-\t\t\treturn $cache->get('fileid/'.$fullpath);\r\n+\t\t\t$id = $cache->get('fileid/'.$fullpath);\r\n+\t\t\tif ($id != -1) {\r\n+\t\t\t\treturn $id;\r\n+\t\t\t}\r\n\t\t}\r\n```\r\n\r\n\r\nthe double slashes from the web ui are cleaned up somewhere down the road into the db.\r\n\r\ni have not added this as a fix to core but it is working fine at freenet. @robin: it feels like a hack. is there a saner place to fix this? somewhere in the oc_usercache implementations?\r\n","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}