{"url":"https://api.github.com/repos/owncloud/core/issues/5933","labels_url":"https://api.github.com/repos/owncloud/core/issues/5933/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/5933/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/5933/events","html_url":"https://github.com/owncloud/core/issues/5933","id":22862393,"number":5933,"title":"desktop client sync returns error: \"invalid content-length in response\". two content-length headers in http response","user":{"login":"uranther","id":86797,"avatar_url":"https://gravatar.com/avatar/d0dda149d2955bc2f748555162ffe422?d=https%3a%2f%2fidenticons.github.com%2fd1eb4c6d77901d7ffd509c53fb28879e.png&r=x","gravatar_id":"d0dda149d2955bc2f748555162ffe422","url":"https://api.github.com/users/uranther","html_url":"https://github.com/uranther","followers_url":"https://api.github.com/users/uranther/followers","following_url":"https://api.github.com/users/uranther/following{/other_user}","gists_url":"https://api.github.com/users/uranther/gists{/gist_id}","starred_url":"https://api.github.com/users/uranther/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uranther/subscriptions","organizations_url":"https://api.github.com/users/uranther/orgs","repos_url":"https://api.github.com/users/uranther/repos","events_url":"https://api.github.com/users/uranther/events{/privacy}","received_events_url":"https://api.github.com/users/uranther/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":21,"created_at":"2013-11-18t19:52:21z","updated_at":"2013-11-21t14:24:47z","closed_at":"2013-11-20t09:41:17z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\nshould be able to sync files on desktop client. \r\n\r\n### actual behaviour\r\nfiles do not sync on windows desktop client. gives error: \"invalid content-length in response.\" can download through the web/webdav just fine. actually, it will sync *up* to the server, but now *down*.\r\n\r\n### steps to reproduce\r\n\r\n1. upload file through web interface\r\n2. login to desktop client and try to sync\r\n3. sync fails with message \"invalid content-length in response\"\r\n\r\n### server configuration\r\n\r\n* operating system: linux / simplehosting with gandi.net\r\n* web server: apache 2.4.6\r\n* database: mysql 5.5.31\r\n* php version: 5.4.4\r\n* owncloud version: 5.0.13\r\n\r\n### client configuration\r\nbrowser: n/a\r\noperating system: windows 7 sp1\r\nowncloud desktop client - windows - 1.4.2\r\n\r\n### logs\r\n#### web server error log\r\n```\r\n[18-nov-2013 18:56:56] warning: [pool www] server reached max_children setting (2), consider raising it\r\n```\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n11-18 14:30:36:881 \"################## owncloud en_us () 1.4.2\" \r\n11-18 14:30:36:884 void mirall::application::setuptranslations() using \"en_us\" translation \r\n11-18 14:30:37:253 * setup folders from  \"c:\\users\\uranther\\appdata\\local\\owncloud/folders\" \r\n11-18 14:30:37:254   ` -> setting up: \"owncloud\" \r\n11-18 14:30:37:254     -> file path:  \"c:/users/uranther/appdata/local/owncloud/folders/owncloud\" \r\n11-18 14:30:37:255 * pending events for \"c:/users/uranther\\owncloud\" will be processed after events stop for 1000 milliseconds ( \"14:47:17\" ). 0 events until now ) \r\n11-18 14:30:37:255   ==> returning exclude file path:  \"c:/program files (x86)/owncloud/sync-exclude.lst\" \r\n11-18 14:30:37:256   ==> returning exclude file path:  \"c:/users/uranther/appdata/local/owncloud/sync-exclude.lst\" \r\n11-18 14:30:37:256 checked local path ok \r\n11-18 14:30:37:257 setting remote poll timer interval to 30000 msec \r\n11-18 14:30:37:257 adding folder to folder map  mirall::folder(0x718db68) \r\n11-18 14:30:37:257 folder in overallstatus message:  mirall::folder(0x718db68)  with name  \"owncloud\" \r\n11-18 14:30:37:258 sync state changed for folder  \"owncloud\" :  \"not yet started\" \r\n11-18 14:30:37:258 schedule folder  \"owncloud\"  to sync! \r\n11-18 14:30:37:258 folderman: syncing is disabled, no scheduling. \r\n11-18 14:30:37:259 network location:  \"\" \r\n11-18 14:30:37:294 get request to   qurl( \"http://example.com/owncloud/status.php\" )  \r\n11-18 14:30:37:295 setting up host header:  \"example.com\" \r\n11-18 14:30:39:869 * processing of event queue for \"c:/users/uranther\\owncloud\" \r\n11-18 14:30:40:248 status.php returns:  \"{\"installed\":\"true\",\"version\":\"5.0.25\",\"versionstring\":\"5.0.13\",\"edition\":\"\"}\"   0  reply:  qnetworkreplyimpl(0x71f3090) \r\n11-18 14:30:40:249 ** application: owncloud found:  \"http://example.com/owncloud\"  with version  \"5.0.13\" ( \"5.0.25\" ) \r\n11-18 14:30:40:249 ** setting owncloud server version to  \"5.0.25\" \r\n11-18 14:30:40:249 # checking for authentication settings. \r\n11-18 14:30:40:250 get request to   qurl( \"http://example.com/owncloud/remote.php/webdav//\" )  \r\n11-18 14:30:40:250 setting up host header:  \"example.com\" \r\n11-18 14:30:40:262 00 client update check to  \"https://download.owncloud.com/clientupdater.php\" \r\n11-18 14:30:40:558 connection validator result:  \"connected\" \r\n11-18 14:30:40:558 ######## connection and credentials are ok! \r\n11-18 14:30:40:558     * event notification  enabled \r\n11-18 14:30:40:571 schedule folder  \"owncloud\"  to sync! \r\n11-18 14:30:40:571  ii> sync for folder  \"owncloud\"  already scheduled, do not enqueue! \r\n11-18 14:30:40:571 xx slotschedulefoldersync: folderqueue size:  1 \r\n11-18 14:30:40:571 setting up host header:  \"example.com\" \r\n11-18 14:30:40:572   ==> returning exclude file path:  \"c:/program files (x86)/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:572 ==== added system ignore list to csync: \"c:/program files (x86)/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:572 csync_exclude_load: loading exclude file: c:/program files (x86)/owncloud/sync-exclude.lst\r\n11-18 14:30:40:573 csync_exclude_load: adding entry: *.filepart\r\n11-18 14:30:40:573 csync_exclude_load: adding entry: *~\r\n11-18 14:30:40:573 csync_exclude_load: adding entry: *.part\r\n11-18 14:30:40:573 csync_exclude_load: adding entry: *.crdownload\r\n11-18 14:30:40:574 csync_exclude_load: adding entry: *.unison*\r\n11-18 14:30:40:574 csync_exclude_load: adding entry: *csync_timedif.ctmp*\r\n11-18 14:30:40:574 csync_exclude_load: adding entry: csync_journal.db\r\n11-18 14:30:40:574 csync_exclude_load: adding entry: csync_journal.db.ctmp\r\n11-18 14:30:40:574 csync_exclude_load: adding entry: .*.sw?\r\n11-18 14:30:40:575 csync_exclude_load: adding entry: .*.*sw?\r\n11-18 14:30:40:575 csync_exclude_load: adding entry: ].ds_store\r\n11-18 14:30:40:575 csync_exclude_load: adding entry: ].ds_store\r\n11-18 14:30:40:576 csync_exclude_load: adding entry: ]thumbs.db\r\n11-18 14:30:40:576 csync_exclude_load: adding entry: desktop.ini\r\n11-18 14:30:40:576 csync_exclude_load: adding entry: *.kate-swp\r\n11-18 14:30:40:577 csync_exclude_load: adding entry: *_conflict-*\r\n11-18 14:30:40:577 csync_exclude_load: adding entry: ]*.~*\r\n11-18 14:30:40:577 csync_exclude_load: adding entry: ].temporaryitems\r\n11-18 14:30:40:577 csync_exclude_load: adding entry: ].trashes\r\n11-18 14:30:40:578 csync_exclude_load: adding entry: ].documentrevisions-v100\r\n11-18 14:30:40:578 csync_exclude_load: adding entry: .fseventd\r\n11-18 14:30:40:578 csync_exclude_load: adding entry: .apdisk\r\n11-18 14:30:40:578 csync_exclude_load: adding entry: .htaccess\r\n11-18 14:30:40:578 csync_exclude_load: adding entry: ]icon\\r*\r\n11-18 14:30:40:579 csync_exclude_load: adding entry: ~$*\r\n11-18 14:30:40:579 csync_exclude_load: adding entry: .~lock.*\r\n11-18 14:30:40:579   ==> returning exclude file path:  \"c:/users/uranther/appdata/local/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:580 ==== added user defined ignore list to csync: \"c:/users/uranther/appdata/local/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:580 csync_exclude_load: loading exclude file: c:/users/uranther/appdata/local/owncloud/sync-exclude.lst\r\n11-18 14:30:40:580 csync_config_load: config file c:\\users\\uranther\\appdata\\local\\owncloud//ocsync.conf not found, checking c:\\users\\uranther/.ocsync/ocsync.conf\r\n11-18 14:30:40:581 _csync_config_copy_default: could not copy /c:\\program files (x86)\\owncloud\\ocsync.conf to c:\\users\\uranther\\appdata\\local\\owncloud//ocsync.conf\r\n11-18 14:30:40:581 csync_init: could not load config file c:\\users\\uranther\\appdata\\local\\owncloud//ocsync.conf, using defaults.\r\n11-18 14:30:40:581 csync_exclude_load: loading exclude file: c:\\users\\uranther\\appdata\\local\\owncloud//ocsync_exclude.conf\r\n11-18 14:30:40:582 csync_init: could not load c:\\users\\uranther\\appdata\\local\\owncloud//ocsync_exclude.conf - no such file or directory\r\n11-18 14:30:40:582 csync_vio_init: win32: changing current working dir to c:\\program files (x86)\\owncloud\r\n11-18 14:30:40:584 csync_vio_init: capabilities: atomar copy support: yes\r\n11-18 14:30:40:585 csync_vio_init: capabilities: post copy stat: no\r\n11-18 14:30:40:586 csync_vio_init: capabilities: time sync required: no\r\n11-18 14:30:40:587 csync_vio_init: capabilities: unix extensions: 0\r\n11-18 14:30:40:588 csync_vio_init: capabilities: use send_file: yes\r\n11-18 14:30:40:589 csync_init: module does not need time synchronization.\r\n11-18 14:30:40:590 passing no proxy to csync for  qurl( \"http://example.com/owncloud/remote.php/webdav/\" )  \r\n11-18 14:30:40:591 folder in overallstatus message:  mirall::folder(0x718db68)  with name  \"owncloud\" \r\n11-18 14:30:40:594 sync state changed for folder  \"owncloud\" :  \"syncprepare\" \r\n11-18 14:30:40:595 *** start syncing \r\n11-18 14:30:40:595   ==> returning exclude file path:  \"c:/program files (x86)/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:596 ==== added system ignore list to csync: \"c:/program files (x86)/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:597 csync_exclude_load: loading exclude file: c:/program files (x86)/owncloud/sync-exclude.lst\r\n11-18 14:30:40:598 csync_exclude_load: adding entry: *.filepart\r\n11-18 14:30:40:599 csync_exclude_load: adding entry: *~\r\n11-18 14:30:40:599 csync_exclude_load: adding entry: *.part\r\n11-18 14:30:40:600 csync_exclude_load: adding entry: *.crdownload\r\n11-18 14:30:40:601 csync_exclude_load: adding entry: *.unison*\r\n11-18 14:30:40:602 csync_exclude_load: adding entry: *csync_timedif.ctmp*\r\n11-18 14:30:40:603 csync_exclude_load: adding entry: csync_journal.db\r\n11-18 14:30:40:604 csync_exclude_load: adding entry: csync_journal.db.ctmp\r\n11-18 14:30:40:605 csync_exclude_load: adding entry: .*.sw?\r\n11-18 14:30:40:605 csync_exclude_load: adding entry: .*.*sw?\r\n11-18 14:30:40:606 csync_exclude_load: adding entry: ].ds_store\r\n11-18 14:30:40:607 csync_exclude_load: adding entry: ].ds_store\r\n11-18 14:30:40:608 csync_exclude_load: adding entry: ]thumbs.db\r\n11-18 14:30:40:610 csync_exclude_load: adding entry: desktop.ini\r\n11-18 14:30:40:611 csync_exclude_load: adding entry: *.kate-swp\r\n11-18 14:30:40:612 csync_exclude_load: adding entry: *_conflict-*\r\n11-18 14:30:40:613 csync_exclude_load: adding entry: ]*.~*\r\n11-18 14:30:40:614 csync_exclude_load: adding entry: ].temporaryitems\r\n11-18 14:30:40:615 csync_exclude_load: adding entry: ].trashes\r\n11-18 14:30:40:615 csync_exclude_load: adding entry: ].documentrevisions-v100\r\n11-18 14:30:40:616 csync_exclude_load: adding entry: .fseventd\r\n11-18 14:30:40:617 csync_exclude_load: adding entry: .apdisk\r\n11-18 14:30:40:618 csync_exclude_load: adding entry: .htaccess\r\n11-18 14:30:40:619 csync_exclude_load: adding entry: ]icon\\r*\r\n11-18 14:30:40:620 csync_exclude_load: adding entry: ~$*\r\n11-18 14:30:40:621 csync_exclude_load: adding entry: .~lock.*\r\n11-18 14:30:40:622   ==> returning exclude file path:  \"c:/users/uranther/appdata/local/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:622 ==== added user defined ignore list to csync: \"c:/users/uranther/appdata/local/owncloud/sync-exclude.lst\" \r\n11-18 14:30:40:623 csync_exclude_load: loading exclude file: c:/users/uranther/appdata/local/owncloud/sync-exclude.lst\r\n11-18 14:30:40:624     * event notification  disabled \r\n11-18 14:30:40:626 >===================================== sync started for  \"owncloud\" \r\n11-18 14:30:40:627 folder in overallstatus message:  mirall::folder(0x718db68)  with name  \"owncloud\" \r\n11-18 14:30:40:629 void mirall::csyncthread::startsync() sync started \r\n11-18 14:30:40:629 starting to sync  qthread(0x2b69d38) qthread(0x7236a30) \r\n11-18 14:30:40:630 #### update start #################################################### >> \r\n11-18 14:30:40:630 csync_update: journal: c:/users/uranther\\owncloud/.csync_journal.db\r\n11-18 14:30:40:632 csync_ftw:   => starting to ftw c:/users/uranther\\owncloud, read_from_db-flag for: 0\r\n11-18 14:30:40:632 csync_ftw:  <= closing walk for c:/users/uranther\\owncloud with read_from_db 0\r\n11-18 14:30:40:632 csync_update: update detection for local replica took 0.00 seconds walking 0 files.\r\n11-18 14:30:40:632 csync_ftw:   => starting to ftw owncloud://example.com/owncloud/remote.php/webdav, read_from_db-flag for: 0\r\n11-18 14:30:40:632 csync_ftw: checking for read from db for owncloud://example.com/owncloud/remote.php/webdav: 0\r\n11-18 14:30:40:632 oc_module: opendir method called on owncloud://example.com/owncloud/remote.php/webdav\r\n11-18 14:30:40:632 oc_module: * scheme owncloud\r\n11-18 14:30:40:632 oc_module: * host example.com\r\n11-18 14:30:40:632 oc_module: * port 0\r\n11-18 14:30:40:632 oc_module: * path /owncloud/remote.php/webdav\r\n11-18 14:30:40:632 oc_module: * user \r\n11-18 14:30:40:633 oc_module: ne_sock_init: 0\r\n11-18 14:30:40:633 oc_module: no proxy configured.\r\n11-18 14:30:40:667 client is on latest version! \r\n11-18 14:30:40:768 currently folder  \"owncloud\"  is running, wait for finish! \r\n11-18 14:30:41:121 oc_module: simple propfind result code 207.\r\n11-18 14:30:41:122 oc_module: opendir returning handle 0726b778\r\n11-18 14:30:41:122 oc_module: owncloud_stat owncloud://example.com/owncloud/remote.php/webdav/rageface.jpg called\r\n11-18 14:30:41:122 csync_walker: file: owncloud://example.com/owncloud/remote.php/webdav/rageface.jpg\r\n11-18 14:30:41:122 _csync_detect_update: ==> file: rageface.jpg - hash 16881331464515074107, mtime: 1384802602\r\n11-18 14:30:41:122 csync_statedb_get_stat_by_hash: no result record found for phash = 16881331464515074107\r\n11-18 14:30:41:122 _csync_detect_update: file: rageface.jpg, instruction: instruction_new <<=\r\n11-18 14:30:41:122 oc_module: closedir method called 0726b778!\r\n11-18 14:30:41:122 csync_ftw:  <= closing walk for owncloud://example.com/owncloud/remote.php/webdav with read_from_db 0\r\n11-18 14:30:41:122 csync_update: update detection for remote replica took 0.49 seconds walking 1 files.\r\n11-18 14:30:41:122 <<#### update end ########################################################### \r\n11-18 14:30:41:122 csync_reconcile: reconciliation for local replica took 0.00 seconds visiting 0 files.\r\n11-18 14:30:41:122 _csync_merge_algorithm_visitor: instruction_new      file: rageface.jpg\r\n11-18 14:30:41:122 csync_reconcile: reconciliation for remote replica took 0.00 seconds visiting 1 files.\r\n11-18 14:30:41:135     * csync thread started \r\n11-18 14:30:41:136 folder in overallstatus message:  mirall::folder(0x718db68)  with name  \"owncloud\" \r\n11-18 14:30:41:139 sync state changed for folder  \"owncloud\" :  \"sync running\" \r\n11-18 14:30:41:122 csync_propagate: propagation for local replica took 0.00 seconds visiting 0 files.\r\n11-18 14:30:41:122 _csync_push_file: continuation: 0 0\r\n11-18 14:30:41:122 oc_module: => open called for owncloud://example.com/owncloud/remote.php/webdav/rageface.jpg\r\n11-18 14:30:41:123 oc_module: get request on /owncloud/remote.php/webdav/rageface.jpg\r\n11-18 14:30:41:123 oc_module: sendfile handling request type get. fd 3\r\n11-18 14:30:41:123 oc_module:   -- get on owncloud://example.com/owncloud/remote.php/webdav/rageface.jpg\r\n11-18 14:30:41:307 oc_module: neon error code was 1\r\n11-18 14:30:41:307 oc_module: error get: neon: 1, errno 10013, string invalid content-length in response\r\n11-18 14:30:41:307 _csync_push_file: file: owncloud://example.com/owncloud/remote.php/webdav/rageface.jpg, command: sendfile, error: unknown error from errno 10013\r\n11-18 14:30:41:307 csync_vio_stat: win32: stat-inode for c:/users/uranther\\owncloud/rageface.jpg.~geteue: 250081\r\n11-18 14:30:41:308 csync_propagate: propagation for remote replica took 0.19 seconds visiting 1 files.\r\n11-18 14:30:41:315 [progress] progressed  9512  bytes in  1  files  in msec  175 \r\n11-18 14:30:41:308 void mirall::csyncthread::startsync() sync finished \r\n11-18 14:30:41:341 csync_statedb_write_progressinfo: insert into progress (phash, modtime, md5, chunk, transferid, error_count, tmpfile, error_string) values(16881331464515074107, 1384802602, '528a692ad339e', 0, 0, 10, '(null)', 'invalid content-length in response');\r\n11-18 14:30:41:346 _merge_and_write_statedb: writing the statedb of 0 files to disk took 0.04 seconds\r\n11-18 14:30:41:349 csync_statedb_close: successfully moved tmp db to original db.\r\n11-18 14:30:41:349 csync run took  720  milliseconds \r\n11-18 14:30:41:351 -> csync finished slot for \"owncloud\" with error false \r\n11-18 14:30:41:352 sync is enabled - starting the polltimer again. \r\n11-18 14:30:41:353 starting event logging again in  2000  milliseconds \r\n11-18 14:30:41:377 oo folder slotsyncfinished: result:  3 \r\n11-18 14:30:41:379   ** error strings:  (\"file rageface.jpg: invalid content-length in response\") \r\n11-18 14:30:41:380     * owncloud csync thread finished with error \r\n11-18 14:30:41:380 folder in overallstatus message:  mirall::folder(0x718db68)  with name  \"owncloud\" \r\n11-18 14:30:41:384 sync state changed for folder  \"owncloud\" :  \"error\" \r\n```\r\n\r\n#### browser log\r\n```\r\nrequest url:http://example.com/owncloud/index.php/apps/files/ajax/download.php?files=rageface.jpg&dir=%2f\r\nrequest method:get\r\nstatus code:200 ok\r\nrequest headersview source\r\naccept:image/webp,*/*;q=0.8\r\naccept-encoding:gzip,deflate,sdch\r\naccept-language:en-us,en;q=0.8\r\nconnection:keep-alive\r\ncookie:phpsessid=65auujjsup6rd8bhe94dh0u8d7; 528a3ffe538cb=d75rmg8h9sqcm4vhlgm5kdtij1; 528a54f4b01db=k97k9304j2dnnt3i0e8bmlnap1; ac_activecollab_sid_986b9a1d00=1%2f3lmwpqnwc7wpnyrmjjectgnde7dufed8qptu78f0%2f2013-11-18+19%3a17%3a41; ac_activecollab_timestamp=1384802261\r\ndnt:1\r\nhost:example.com\r\nreferer:http://example.com/owncloud/index.php/apps/files\r\nuser-agent:mozilla/5.0 (windows nt 6.1; wow64) applewebkit/537.36 (khtml, like gecko) chrome/31.0.1650.48 safari/537.36 opr/18.0.1284.26 (edition next)\r\nquery string parametersview sourceview url encoded\r\nfiles:rageface.jpg\r\ndir:/\r\nresponse headersview source\r\naccept-ranges:bytes\r\nage:0\r\ncache-control:must-revalidate, post-check=0, pre-check=0\r\nconnection:keep-alive\r\ncontent-disposition:attachment; filename*=utf-8''rageface.jpg; filename=\"rageface.jpg\"\r\ncontent-length:9512\r\ncontent-length:9512\r\ncontent-transfer-encoding:binary\r\ncontent-type:image/jpeg\r\ndate:mon, 18 nov 2013 19:31:29 gmt\r\nexpires:0\r\npragma:public\r\nserver:apache/2.4.6\r\nvia:1.1 varnish\r\nx-powered-by:php/5.4.4-14+deb7u5\r\nx-ua-compatible:ie=edge\r\n```\r\n\r\n**please note there's *2* content-length's in the response headers! maybe this is what's screwing the desktop client up, and something my web browser just ignores.**","closed_by":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false}}