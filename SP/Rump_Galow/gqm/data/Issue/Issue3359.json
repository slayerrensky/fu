{"url":"https://api.github.com/repos/owncloud/core/issues/3359","labels_url":"https://api.github.com/repos/owncloud/core/issues/3359/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3359/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3359/events","html_url":"https://github.com/owncloud/core/issues/3359","id":14351036,"number":3359,"title":"oc 5.0.5 - high mysql usage during indexing","user":{"login":"stlongo","id":4396344,"avatar_url":"https://gravatar.com/avatar/db56c21a20ea556f031016edf46bf21c?d=https%3a%2f%2fidenticons.github.com%2f851bb27c1f3b625e9e11a84499abc4cd.png&r=x","gravatar_id":"db56c21a20ea556f031016edf46bf21c","url":"https://api.github.com/users/stlongo","html_url":"https://github.com/stlongo","followers_url":"https://api.github.com/users/stlongo/followers","following_url":"https://api.github.com/users/stlongo/following{/other_user}","gists_url":"https://api.github.com/users/stlongo/gists{/gist_id}","starred_url":"https://api.github.com/users/stlongo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stlongo/subscriptions","organizations_url":"https://api.github.com/users/stlongo/orgs","repos_url":"https://api.github.com/users/stlongo/repos","events_url":"https://api.github.com/users/stlongo/events{/privacy}","received_events_url":"https://api.github.com/users/stlongo/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/3+-+to+develop","name":"3 - to develop","color":"ededed"},{"url":"https://api.github.com/repos/owncloud/core/labels/app%3asearch","name":"app:search","color":"02d7e1"},{"url":"https://api.github.com/repos/owncloud/core/labels/v5.x","name":"v5.x","color":"ededed"}],"state":"closed","assignee":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"milestone":null,"comments":2,"created_at":"2013-05-15t09:54:42z","updated_at":"2013-08-08t15:17:12z","closed_at":"2013-08-08t15:17:12z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"hi,\r\ni'm not sure if other users have already made the same suggestion...\r\ni have an installation of oc 5.0.5 with tens/hundreds of thousands of files per user. i've found that if a user perform a search operation, during file indexing, the system has a very high (100%) cpu usage from mysql process.\r\nthe query that produces this very high cpu utilization is:\r\n\r\nselect `oc_filecache`.`fileid` from `oc_filecache` left join `oc_lucene_status` on `oc_filecache`.`fileid` = `oc_lucene_status`.`fileid` where `storage` = '2' and `status` is null or `status` = \"n\"\r\n\r\n(on my server this query may requires minutes to complete).\r\n\r\ni think that the problem is in the join part of the query, due to a missing index.\r\nin my setup the problem seems solved just adding an index on oc_lucene_status.fileid as follow:\r\n\r\ncreate index fileid_index on oc_lucene_status(fileid)\r\n\r\nhope this may be helpful for other users,\r\ns.","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}