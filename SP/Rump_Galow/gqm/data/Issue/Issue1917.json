{"url":"https://api.github.com/repos/owncloud/core/issues/1917","labels_url":"https://api.github.com/repos/owncloud/core/issues/1917/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/1917/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/1917/events","html_url":"https://github.com/owncloud/core/issues/1917","id":11406989,"number":1917,"title":"issue: replace a file with a number in () in its name with one with the same name","user":{"login":"timmeey","id":1174542,"avatar_url":"https://gravatar.com/avatar/49f624722584a5153175a50070e4a5df?d=https%3a%2f%2fidenticons.github.com%2fe3d2bfed638714e81e2ff99941f0823b.png&r=x","gravatar_id":"49f624722584a5153175a50070e4a5df","url":"https://api.github.com/users/timmeey","html_url":"https://github.com/timmeey","followers_url":"https://api.github.com/users/timmeey/followers","following_url":"https://api.github.com/users/timmeey/following{/other_user}","gists_url":"https://api.github.com/users/timmeey/gists{/gist_id}","starred_url":"https://api.github.com/users/timmeey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timmeey/subscriptions","organizations_url":"https://api.github.com/users/timmeey/orgs","repos_url":"https://api.github.com/users/timmeey/repos","events_url":"https://api.github.com/users/timmeey/events{/privacy}","received_events_url":"https://api.github.com/users/timmeey/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":7,"created_at":"2013-02-26t13:00:15z","updated_at":"2013-08-26t19:22:00z","closed_at":"2013-08-06t22:56:41z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"actual behaviour:\r\nwhen a file already exists with a (number) in its name, like  foo(2), and i want to reupload this file, it asks me if i want to replace it or suggest a name. when i click replace the js stuff dies and send it in to an infinite loop\r\n\r\nsteps to reproduce\r\n\r\nupload a file with a number in () in the filename eg. foo(2)\r\nreupload this file in order to replace the old one\r\nif it asks you what you want to do, click replace\r\n\r\n\r\nexpected behavior:\r\nreplace the file with the newly uploaded one.\r\n\r\nserver version:\r\noc version 4.5 (branch stable45)\r\n\r\ni tried to fix this problem(wanted to make a pull request :-) )\r\nbut i ran into major problems with this, making it too complicated for me. \r\n\r\nbut i was able to figure out where the problem arises from.\r\n\r\n\r\nwhen i upload a file that already exists, the backend is generating a new name(ocp\\files:::buildnotexistingfilename) for it in the apps/files/ajax/upload.php. then , after the backend send the success msg,the client js apps/files/js/files.js tries to generate the \"temporary\" filename again in getuniquename(name). but there is the problem. this function just searches for regex(d+) to increment for the new file name. but if there is a (d+) in the real filename this produces nothing usable. so when the next function replace tries to manage the renaming it searches for the file with the \"temporary\" name generated by the getuniquename js function. but this filename differs from the filename under what the backend saved the freshly uploaded file. so the file it is searching for is not existing, so everything is going to die :-)\r\n\r\ni'm not so deep into oc as i could fix it by myself, i hoped it's just some kind of better regex but no.\r\n\r\ni think the backend should send the temporary name under which it saved the file to the frontend, so it does not need to try to generate the same name again.","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}