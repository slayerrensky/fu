{"url":"https://api.github.com/repos/owncloud/core/issues/4736","labels_url":"https://api.github.com/repos/owncloud/core/issues/4736/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4736/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4736/events","html_url":"https://github.com/owncloud/core/issues/4736","id":19052266,"number":4736,"title":"invalid default value even if no default is specified","user":{"login":"kabum","id":245432,"avatar_url":"https://gravatar.com/avatar/a1dea19f88f38ea0b5b5b4d19d5b3107?d=https%3a%2f%2fidenticons.github.com%2f53d8cbb3dbc087a02951dec47438ccdf.png&r=x","gravatar_id":"a1dea19f88f38ea0b5b5b4d19d5b3107","url":"https://api.github.com/users/kabum","html_url":"https://github.com/kabum","followers_url":"https://api.github.com/users/kabum/followers","following_url":"https://api.github.com/users/kabum/following{/other_user}","gists_url":"https://api.github.com/users/kabum/gists{/gist_id}","starred_url":"https://api.github.com/users/kabum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kabum/subscriptions","organizations_url":"https://api.github.com/users/kabum/orgs","repos_url":"https://api.github.com/users/kabum/repos","events_url":"https://api.github.com/users/kabum/events{/privacy}","received_events_url":"https://api.github.com/users/kabum/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":9,"created_at":"2013-09-05t15:54:02z","updated_at":"2013-12-09t17:06:39z","closed_at":"2013-11-15t13:59:23z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"i have following schema:\r\n\r\n```\r\n<table>\r\n\t<name>*dbprefix*music_ampache_sessions</name>\r\n\t<declaration>\r\n\t\t<field>\r\n\t\t\t<name>user_id</name>\r\n\t\t\t<type>text</type>\r\n\t\t\t<notnull>true</notnull>\r\n\t\t\t<length>64</length>\r\n\t\t</field>\r\n\r\n\t\t<field>\r\n\t\t\t<name>token</name>\r\n\t\t\t<type>text</type>\r\n\t\t\t<notnull>true</notnull>\r\n\t\t\t<length>64</length>\r\n\t\t</field>\r\n\r\n\t\t<field>\r\n\t\t\t<name>start</name>\r\n\t\t\t<type>timestamp</type>\r\n\t\t\t<notnull>true</notnull>\r\n\t\t</field>\r\n\t</declaration>\r\n</table>\r\n```\r\n\r\nand get following error:\r\n\r\n```\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (exception 'pdoexception' with message 'sqlstate[42000]: syntax error or access violation: 1067 invalid default value for 'start'' in /srv/http/core/3rdparty/doctrine/dbal/lib/doctrine/dbal/connection.php:742\r\nstack trace:\r\n#0 [internal function]: pdo->query('create table `o...')\r\n#1 /srv/http/core/3rdparty/doctrine/dbal/lib/doctrine/dbal/connection.php(742): call_user_func_array(array, array)\r\n#2 /srv/http/core/lib/db/mdb2schemamanager.php(145): doctrine\\\\dbal\\\\connection->query('create table `o...')\r\n#3 /srv/http/core/lib/db/mdb2schemamanager.php(85): oc\\\\db\\\\mdb2schemamanager->executeschemachange(object(doctrine\\\\dbal\\\\schema\\\\schemadiff))\r\n#4 /srv/http/core/lib/db.php(379): oc\\\\db\\\\mdb2schemamanager->updatedbfromstructure('/srv/http/core/...')\r\n#5 /srv/http/core/lib/app.php(929): oc_db::updatedbfromstructure('/srv/http/core/...')\r\n#6 /srv/http/core/lib/app.php(831): oc_app::updateapp('music')\r\n#7 /srv/http/core/lib/app.php(94): oc_app::checkupgrade('music')\r\n#8 /srv/http/core/lib/app.php(68): oc_app::loadapp('music')\r\n#9 /srv/http/core/lib/base.php(629): oc_app::loadapps()\r\n#10 /srv/http/core/index.php(30): oc::handlerequest()\r\n#11 {main}\r\n\r\nnext exception 'doctrine\\\\dbal\\\\dbalexception' with message 'an exception occurred while executing 'create table `oc_music_ampache_sessions` (`user_id` varchar(64) default '' not null, `token` varchar(64) default '' not null, `start` datetime default '' not null) default character set utf8 collate utf8_unicode_ci engine = innodb':\r\n\r\nsqlstate[42000]: syntax error or access violation: 1067 invalid default value for 'start'' in /srv/http/core/3rdparty/doctrine/dbal/lib/doctrine/dbal/dbalexception.php:47\r\nstack trace:\r\n#0 /srv/http/core/3rdparty/doctrine/dbal/lib/doctrine/dbal/connection.php(744): doctrine\\\\dbal\\\\dbalexception::driverexceptionduringquery(object(pdoexception), 'create table `o...')\r\n#1 /srv/http/core/lib/db/mdb2schemamanager.php(145): doctrine\\\\dbal\\\\connection->query('create table `o...')\r\n#2 /srv/http/core/lib/db/mdb2schemamanager.php(85): oc\\\\db\\\\mdb2schemamanager->executeschemachange(object(doctrine\\\\dbal\\\\schema\\\\schemadiff))\r\n#3 /srv/http/core/lib/db.php(379): oc\\\\db\\\\mdb2schemamanager->updatedbfromstructure('/srv/http/core/...')\r\n#4 /srv/http/core/lib/app.php(929): oc_db::updatedbfromstructure('/srv/http/core/...')\r\n#5 /srv/http/core/lib/app.php(831): oc_app::updateapp('music')\r\n#6 /srv/http/core/lib/app.php(94): oc_app::checkupgrade('music')\r\n#7 /srv/http/core/lib/app.php(68): oc_app::loadapp('music')\r\n#8 /srv/http/core/lib/base.php(629): oc_app::loadapps()\r\n#9 /srv/http/core/index.php(30): oc::handlerequest()\r\n#10 {main})\",\"level\":4,\"time\":\"2013-09-05t15:43:46+00:00\"}\r\n```\r\n\r\ni extracted the sql statement:\r\n\r\n```sql\r\ncreate table `oc_music_ampache_sessions` \r\n(\r\n`user_id` varchar(64) default '' not null, \r\n`token` varchar(64) default '' not null, \r\n`start` datetime default '' not null\r\n) \r\ndefault character set utf8 \r\ncollate utf8_unicode_ci \r\nengine = innodb\r\n```\r\n\r\nas you see a default value is specified for each field.\r\n\r\n\r\ncc @bartv2 ","closed_by":{"login":"kabum","id":245432,"avatar_url":"https://gravatar.com/avatar/a1dea19f88f38ea0b5b5b4d19d5b3107?d=https%3a%2f%2fidenticons.github.com%2f53d8cbb3dbc087a02951dec47438ccdf.png&r=x","gravatar_id":"a1dea19f88f38ea0b5b5b4d19d5b3107","url":"https://api.github.com/users/kabum","html_url":"https://github.com/kabum","followers_url":"https://api.github.com/users/kabum/followers","following_url":"https://api.github.com/users/kabum/following{/other_user}","gists_url":"https://api.github.com/users/kabum/gists{/gist_id}","starred_url":"https://api.github.com/users/kabum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kabum/subscriptions","organizations_url":"https://api.github.com/users/kabum/orgs","repos_url":"https://api.github.com/users/kabum/repos","events_url":"https://api.github.com/users/kabum/events{/privacy}","received_events_url":"https://api.github.com/users/kabum/received_events","type":"user","site_admin":false}}