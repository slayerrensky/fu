{"url":"https://api.github.com/repos/owncloud/core/issues/2345","labels_url":"https://api.github.com/repos/owncloud/core/issues/2345/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/2345/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/2345/events","html_url":"https://github.com/owncloud/core/issues/2345","id":12053857,"number":2345,"title":"unlimited php upload size incorrectly interpreted as 0","user":{"login":"wuebbel","id":3866411,"avatar_url":"https://gravatar.com/avatar/ac982554fb75d2297aacedeafaa96254?d=https%3a%2f%2fidenticons.github.com%2f08e231c5079b8eb774cd58b50054039d.png&r=x","gravatar_id":"ac982554fb75d2297aacedeafaa96254","url":"https://api.github.com/users/wuebbel","html_url":"https://github.com/wuebbel","followers_url":"https://api.github.com/users/wuebbel/followers","following_url":"https://api.github.com/users/wuebbel/following{/other_user}","gists_url":"https://api.github.com/users/wuebbel/gists{/gist_id}","starred_url":"https://api.github.com/users/wuebbel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuebbel/subscriptions","organizations_url":"https://api.github.com/users/wuebbel/orgs","repos_url":"https://api.github.com/users/wuebbel/repos","events_url":"https://api.github.com/users/wuebbel/events{/privacy}","received_events_url":"https://api.github.com/users/wuebbel/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":2,"created_at":"2013-03-15t08:33:53z","updated_at":"2013-03-18t15:18:50z","closed_at":"2013-03-18t15:18:50z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\nin order to be able to upload files larger than 2gb reliably, apache/php requires upload_max_filesize=post_max_size=0 (indicating \"unlimited\" according to php specs).\r\n\r\n### actual behaviour\r\nthe webinterface interprets upload_max_filesize=post_max_size=0 as an upload limit of 0.\r\n \r\n### steps to reproduce\r\n1.  in owncloud/.htaccess, use\r\n````\r\n    php_value upload_max_filesize 0m\r\n    php_value post_max_size 0m\r\n```\r\n\r\n2. log in to the webaccess, touch \"upload\", displayed upload size is 0.\r\n3. try to upload anything, will say \"upload limit exceeded\".\r\n\r\n### server configuration\r\noperating system:\r\nubuntu 12.04.2 lts and owncloud 4.5.7, testing 5.0 rc1.\r\n\r\nweb server: \r\napache 2.2.22\r\n\r\ndatabase:\r\nmysql\r\n\r\nphp version:\r\n5.3.10-1\r\n\r\nowncloud version:\r\n4.5.7, testing 5.0 rc1, bug is in both.\r\n\r\n### client configuration\r\nbrowser:\r\nopera\r\n\r\noperating system:\r\nwindows or linux.\r\n\r\n### fix\r\nquick fix: set limit to high value if it is 0. 4.5 and 5.0 rc 1. note: this will incorrectly set the displayed upload size to unlimited if only one of the limits is \"unlimited\".\r\n\r\n```\r\n*** apps/files/index.php        fri mar 15 09:07:42 2013\r\n--- apps/files/index.php.orig   fri mar 15 09:07:57 2013\r\n***************\r\n*** 85,94 ****\r\n  $post_max_size = ocp\\util::computerfilesize(ini_get('post_max_size'));\r\n  $maxuploadfilesize = min($upload_max_filesize, $post_max_size);\r\n  \r\n- if ($maxuploadfilesize == 0)\r\n- $maxuploadfilesize = 16*1024*1024*1024;\r\n- \r\n  $freespace=oc_filesystem::free_space('/');\r\n  $freespace=max($freespace,0);\r\n  $maxuploadfilesize = min($maxuploadfilesize ,$freespace);\r\n--- 85,90 ----\r\n```\r\n\r\n5.0rc 1\r\n\r\n```\r\n*** lib/helper.php      wed mar 13 09:23:26 2013\r\n--- lib/helper.php.orig fri mar 15 09:24:51 2013\r\n***************\r\n*** 765,772 ****\r\n                $upload_max_filesize = ocp\\util::computerfilesize(ini_get('upload_max_filesize'));\r\n                $post_max_size = ocp\\util::computerfilesize(ini_get('post_max_size'));\r\n                $maxuploadfilesize = min($upload_max_filesize, $post_max_size);\r\n-               if ($maxuploadfilesize==0)\r\n-               $maxuploadfilesize=16*1024*1024*1024;\r\n- \r\n                $freespace = \\oc\\files\\filesystem::free_space($dir);\r\n                if($freespace !== \\oc\\files\\free_space_unknown){\r\n                        $freespace = max($freespace, 0);\r\n--- 765,770 ----\r\n```","closed_by":{"login":"raydiation","id":195053,"avatar_url":"https://gravatar.com/avatar/aa0d7b7302e0d7f4f9513c23b571383a?d=https%3a%2f%2fidenticons.github.com%2faf0a25e27510f77d97634a6bbe653b13.png&r=x","gravatar_id":"aa0d7b7302e0d7f4f9513c23b571383a","url":"https://api.github.com/users/raydiation","html_url":"https://github.com/raydiation","followers_url":"https://api.github.com/users/raydiation/followers","following_url":"https://api.github.com/users/raydiation/following{/other_user}","gists_url":"https://api.github.com/users/raydiation/gists{/gist_id}","starred_url":"https://api.github.com/users/raydiation/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raydiation/subscriptions","organizations_url":"https://api.github.com/users/raydiation/orgs","repos_url":"https://api.github.com/users/raydiation/repos","events_url":"https://api.github.com/users/raydiation/events{/privacy}","received_events_url":"https://api.github.com/users/raydiation/received_events","type":"user","site_admin":false}}