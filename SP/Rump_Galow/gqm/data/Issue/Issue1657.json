{"url":"https://api.github.com/repos/owncloud/core/issues/1657","labels_url":"https://api.github.com/repos/owncloud/core/issues/1657/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/1657/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/1657/events","html_url":"https://github.com/owncloud/core/issues/1657","id":10920142,"number":1657,"title":"user sql statements causing full table scans","user":{"login":"vstokesjr","id":3577587,"avatar_url":"https://gravatar.com/avatar/c747987ef85219969a961d79aa9a403b?d=https%3a%2f%2fidenticons.github.com%2feb979f10e44e0c17147f9857896b7faa.png&r=x","gravatar_id":"c747987ef85219969a961d79aa9a403b","url":"https://api.github.com/users/vstokesjr","html_url":"https://github.com/vstokesjr","followers_url":"https://api.github.com/users/vstokesjr/followers","following_url":"https://api.github.com/users/vstokesjr/following{/other_user}","gists_url":"https://api.github.com/users/vstokesjr/gists{/gist_id}","starred_url":"https://api.github.com/users/vstokesjr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vstokesjr/subscriptions","organizations_url":"https://api.github.com/users/vstokesjr/orgs","repos_url":"https://api.github.com/users/vstokesjr/repos","events_url":"https://api.github.com/users/vstokesjr/events{/privacy}","received_events_url":"https://api.github.com/users/vstokesjr/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/enhancement","name":"enhancement","color":"02e10c"}],"state":"open","assignee":null,"milestone":null,"comments":1,"created_at":"2013-02-12t19:03:22z","updated_at":"2013-07-25t14:08:32z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"the lib/user/database.php needs to be corrected.\r\n\r\nselect `uid`, `password` from `*prefix*users` where lower(`uid`) = lower(?) \r\n\r\nthe where lower(`uid`) is causing a full table scan because it has to modify the value of the uid column to perform the comparison. this is poor sql. the command should be:\r\n\r\nselect `uid`, `password` from `*prefix*users` where `uid` = lower(?) \r\n\r\nand, you should modify the insert statement to be:\r\n\r\ninsert into `*prefix*users` ( `uid`, `password` ) values( lower( ? ), ? )\r\n\r\n\r\nhowever, most database today do not enforce case for strings (mysql for example) unless it is specifically turned on (in most cases, it's not). therefore the use of the lower() function is not required.\r\n","closed_by":null}