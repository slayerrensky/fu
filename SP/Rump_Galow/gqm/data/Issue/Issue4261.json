{"url":"https://api.github.com/repos/owncloud/core/issues/4261","labels_url":"https://api.github.com/repos/owncloud/core/issues/4261/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4261/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4261/events","html_url":"https://github.com/owncloud/core/issues/4261","id":17462762,"number":4261,"title":"owncloud core should log authentication failures to standard log","user":{"login":"axelrb","id":5095647,"avatar_url":"https://gravatar.com/avatar/d84cde46bd4a575e4aa2499894efd2ec?d=https%3a%2f%2fidenticons.github.com%2fa31e764ae60e06bcd8c4e43774774f83.png&r=x","gravatar_id":"d84cde46bd4a575e4aa2499894efd2ec","url":"https://api.github.com/users/axelrb","html_url":"https://github.com/axelrb","followers_url":"https://api.github.com/users/axelrb/followers","following_url":"https://api.github.com/users/axelrb/following{/other_user}","gists_url":"https://api.github.com/users/axelrb/gists{/gist_id}","starred_url":"https://api.github.com/users/axelrb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/axelrb/subscriptions","organizations_url":"https://api.github.com/users/axelrb/orgs","repos_url":"https://api.github.com/users/axelrb/repos","events_url":"https://api.github.com/users/axelrb/events{/privacy}","received_events_url":"https://api.github.com/users/axelrb/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/enhancement","name":"enhancement","color":"02e10c"}],"state":"open","assignee":null,"milestone":null,"comments":3,"created_at":"2013-07-31t16:51:11z","updated_at":"2013-10-18t09:48:15z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"it appears that owncloud is not logging any auth failures.\r\nfor oc4.5 and 5.0.9\r\nthe following code is a working solution.\r\n\r\n```\r\n*** lib/user.php.orig\t2013-07-15 13:02:31.000000000 +0200\r\n--- lib/user.php\t2013-07-31 18:15:02.124872740 +0200\r\n***************\r\n*** 247,252 ****\r\n--- 247,253 ----\r\n  \t\toc_hook::emit( \"oc_user\", \"pre_login\", array( \"run\" => &$run, \"uid\" => $uid ));\r\n  \r\n  \t\tif( $run ) {\r\n+ \t\t\t$uid2 = \"$uid\";\r\n  \t\t\t$uid = self::checkpassword( $uid, $password );\r\n  \t\t\t$enabled = self::isenabled($uid);\r\n  \t\t\tif($uid && $enabled) {\r\n***************\r\n*** 256,261 ****\r\n--- 257,271 ----\r\n  \t\t\t\toc_hook::emit( \"oc_user\", \"post_login\", array( \"uid\" => $uid, 'password'=>$password ));\r\n  \t\t\t\treturn true;\r\n  \t\t\t}\r\n+ \t\t\telse{\r\n+ \t\t\t\t$today = date(\"f j h:i:s\");\r\n+ \t\t\t\t$datadirectory = oc_config::getvalue(\"datadirectory\");\r\n+ \t\t\t\t$ipclient= $_server['remote_addr'];\r\n+ \t\t\t\t$logauth = fopen($datadirectory.'/auth.log', 'a+');\r\n+ \t\t\t\tfputs($logauth, $today . \" owncloud: login failure\". \" as user \" . $uid2 . \" from \" . $ipclient . \"\\n\");\r\n+ \t\t\t\tfclose($logauth);\r\n+ \t\t\t}\r\n+ \r\n  \t\t}\r\n  \t\treturn false;\r\n  \t}\r\n```","closed_by":null}