{"url":"https://api.github.com/repos/owncloud/core/issues/2512","labels_url":"https://api.github.com/repos/owncloud/core/issues/2512/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/2512/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/2512/events","html_url":"https://github.com/owncloud/core/issues/2512","id":12280184,"number":2512,"title":"owncloud 5: server is spawning apache workers till it drops","user":{"login":"halfgaar","id":142686,"avatar_url":"https://gravatar.com/avatar/e51f39b392cd45f42d1a090b99c6943c?d=https%3a%2f%2fidenticons.github.com%2fc93fa7287a68f2b0b2426ee8015bfbc5.png&r=x","gravatar_id":"e51f39b392cd45f42d1a090b99c6943c","url":"https://api.github.com/users/halfgaar","html_url":"https://github.com/halfgaar","followers_url":"https://api.github.com/users/halfgaar/followers","following_url":"https://api.github.com/users/halfgaar/following{/other_user}","gists_url":"https://api.github.com/users/halfgaar/gists{/gist_id}","starred_url":"https://api.github.com/users/halfgaar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/halfgaar/subscriptions","organizations_url":"https://api.github.com/users/halfgaar/orgs","repos_url":"https://api.github.com/users/halfgaar/repos","events_url":"https://api.github.com/users/halfgaar/events{/privacy}","received_events_url":"https://api.github.com/users/halfgaar/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":16,"created_at":"2013-03-21t15:38:21z","updated_at":"2013-10-17t13:55:04z","closed_at":"2013-10-17t13:55:03z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"we upgraded to owncloud 5 and with only 4 users, i had 16 apache workers using all 4 cores of my server to 100%. and for the fourth user i installed, the sync client said \"waiting to synchronise\" a lot longer (500 seconds or so) than the first one (almost immediately). it was like it kept waiting for the server.\r\n\r\ncurrently, the server has been running for a few hours and all 30 available apache slots are used up (nothing works anymore because of it):\r\n\r\n    apache server status for localhost\r\n\r\n    server version: apache/2.2.22 (ubuntu) php/5.3.10-1ubuntu3.6 with suhosin-patch\r\n        mod_ssl/2.2.22 openssl/1.0.1\r\n    server built: nov 8 2012 21:37:30\r\n\r\n    â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?â”?\r\n\r\n    current time: thursday, 21-mar-2013 16:22:59 cet\r\n    restart time: wednesday, 20-mar-2013 23:23:09 cet\r\n    parent server generation: 0\r\n    server uptime: 16 hours 59 minutes 49 seconds\r\n    total accesses: 25346 - total traffic: 13.3 mb\r\n    cpu usage: u26116.8 s423.89 cu.12 cs0 - 43.4% cpu load\r\n    .414 requests/sec - 227 b/second - 549 b/request\r\n    30 requests currently being processed, 0 idle workers\r\n\r\n    wwwwwwwwwwwwwwwwwwwwwwwwwwwwww\r\n\r\n    scoreboard key:\r\n    \"_\" waiting for connection, \"s\" starting up, \"r\" reading request,\r\n    \"w\" sending reply, \"k\" keepalive (read), \"d\" dns lookup,\r\n    \"c\" closing connection, \"l\" logging, \"g\" gracefully finishing,\r\n    \"i\" idle cleanup of worker, \".\" open slot with no current process\r\n\r\nload average: 20.36, 20.58, 15.62\r\n\r\n      pid user      pr  ni  virt  res  shr s %cpu %mem    time+  command\r\n      622 mysql     20   0 2341m  99m 3680 s   32  6.7  34:24.14 mysqld\r\n     8921 www-data  20   0  326m  40m 5352 r   19  2.7   2:59.74 apache2\r\n     7026 www-data  20   0  312m  28m 6808 r   18  1.9   2:31.51 apache2\r\n    19249 www-data  20   0  362m  75m 4864 r   18  5.1 150:16.33 apache2\r\n     7025 www-data  20   0  322m  38m 6796 r   17  2.6   3:51.95 apache2\r\n     3974 www-data  20   0  337m  53m 6792 r   16  3.6   6:34.39 apache2\r\n    24111 www-data  20   0  349m  63m 5024 s   16  4.3  12:10.70 apache2\r\n     1192 www-data  20   0  319m  33m 5468 s   16  2.3   3:21.62 apache2\r\n     3149 www-data  20   0  339m  55m 6588 r   16  3.7   6:49.68 apache2\r\n     7046 www-data  20   0  327m  41m 5180 r   16  2.8   3:18.51 apache2\r\n     9536 www-data  20   0  318m  32m 5364 r   16  2.2   1:50.98 apache2\r\n     1191 www-data  20   0  313m  29m 6820 r   15  2.0   3:41.87 apache2\r\n     6970 www-data  20   0  322m  37m 5180 r   15  2.5   2:40.62 apache2\r\n    19242 www-data  20   0  319m  33m 7764 r   15  2.3   3:14.12 apache2\r\n    19248 www-data  20   0  333m  48m 5580 r   15  3.2   6:17.33 apache2\r\n    19250 www-data  20   0  581m 292m 4800 r   15 19.6  99:21.09 apache2\r\n     9492 www-data  20   0  316m  30m 5412 r   15  2.0   1:33.28 apache2\r\n     5947 www-data  20   0  341m  56m 5180 r   15  3.8   6:46.88 apache2\r\n     6453 www-data  20   0  306m  22m 6816 r   14  1.5   0:48.47 apache2\r\n    19245 www-data  20   0  331m  45m 5332 r   14  3.1 125:02.16 apache2\r\n     1190 www-data  20   0  350m  66m 6684 r   14  4.5  70:26.11 apache2\r\n     2695 www-data  20   0  346m  61m 5384 r   14  4.1   7:41.66 apache2\r\n    19247 www-data  20   0  349m  65m 6812 r   14  4.4   9:55.37 apache2\r\n     9494 www-data  20   0  320m  35m 5356 r   13  2.4   2:17.18 apache2\r\n     7185 www-data  20   0  328m  41m 5088 r   13  2.8   3:36.00 apache2\r\n\r\nwhen i did a graceful restart on apache, apache status shows a lot of workers hanging in 'gracefully restarting' a long time, so i guess the processes are hanging.\r\n\r\nwe're making use of shared files a lot. one user has files, the others only access those files through the sharing mechanism.\r\n\r\ni wish i could tell you more, but attaching a debugger to a mod_php apache process is kind of hard...\r\n\r\nphp 5.3.10-1ubuntu3.6\r\nubuntu 12.04 lts\r\nsyncclient 1.2.1, on windows.\r\n\r\nedit: i've been gracefully restarting my apache for about 15 minutes now, and they're all stuck in \"g\" (gracefully restarting).","closed_by":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false}}