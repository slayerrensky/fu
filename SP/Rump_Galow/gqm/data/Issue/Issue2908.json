{"url":"https://api.github.com/repos/owncloud/core/issues/2908","labels_url":"https://api.github.com/repos/owncloud/core/issues/2908/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/2908/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/2908/events","html_url":"https://github.com/owncloud/core/issues/2908","id":13142111,"number":2908,"title":"automatic upgrade 4.5.8 -> 5.0.4: endless loop?","user":{"login":"randolfcarter","id":2631274,"avatar_url":"https://gravatar.com/avatar/e4a5d1c2c314d59e880d83b497a0d719?d=https%3a%2f%2fidenticons.github.com%2f3c3d7236785996f9e5f172ea5cdac91b.png&r=x","gravatar_id":"e4a5d1c2c314d59e880d83b497a0d719","url":"https://api.github.com/users/randolfcarter","html_url":"https://github.com/randolfcarter","followers_url":"https://api.github.com/users/randolfcarter/followers","following_url":"https://api.github.com/users/randolfcarter/following{/other_user}","gists_url":"https://api.github.com/users/randolfcarter/gists{/gist_id}","starred_url":"https://api.github.com/users/randolfcarter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/randolfcarter/subscriptions","organizations_url":"https://api.github.com/users/randolfcarter/orgs","repos_url":"https://api.github.com/users/randolfcarter/repos","events_url":"https://api.github.com/users/randolfcarter/events{/privacy}","received_events_url":"https://api.github.com/users/randolfcarter/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/update","name":"update","color":"e10c02"},{"url":"https://api.github.com/repos/owncloud/core/labels/v4.5.x","name":"v4.5.x","color":"dddddd"},{"url":"https://api.github.com/repos/owncloud/core/labels/v5.x","name":"v5.x","color":"ededed"}],"state":"closed","assignee":null,"milestone":null,"comments":4,"created_at":"2013-04-12t22:22:34z","updated_at":"2013-08-06t23:12:21z","closed_at":"2013-08-06t23:12:21z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\nupgrading from 4.5.8 to 5.0.4 to run smoothly.\r\nssince 5.0.4 was advertised by the automatic updater in my 4.5.8 installation, i thought it was now safe to do so... waited for that since i heard from the 5.0.0-2 upgrade problems.\r\n\r\n### actual behaviour\r\nafter pressing the \"update\" button, and then reloading the page when it told me to, i only get this error message:\r\n```\r\nfatal error: class 'oc_util' not found in /var/www/owncloud/settings/admin.php on line 8\r\n```\r\nedit: turns out that was reported already here: https://github.com/owncloud/apps/issues/1009\r\nsorry for not searching more diligently before...\r\n\r\nwhen going to the index.php of owncloud, i face the real problem: a seemingly neverending loop of output like this:\r\n```\r\nturned on maintenance mode\r\nupdated database\r\nupdating filecache, this may take really long...\r\n... 25% done ...\r\nturned on maintenance mode\r\nupdated database\r\nupdating filecache, this may take really long...\r\n... 25% done ...\r\nturned on maintenance mode\r\n...\r\n```\r\nthis continues since 40 minutes already now, not sure if it will finish. the 25% are always the same, from the beginning on, and not sure why the maintenance mode would be turned on multiple times and the database be updated multiple times? looks like the upgrading process is stuck in a loop?\r\nnote: the version inside the config.php is 4.90.9, is that the value for 4.5.8 or for 5.0.4 or even something in between?\r\n\r\n### steps to reproduce\r\n1. in a 4.5.8 installation, as administrative user, go to the admin settings page\r\n2. search for the \"updater\" entry\r\n3. it proposes to install 5.0.4. press the \"update\" button\r\n4. wait for the update to finish. when asked to reload the page, press f5\r\n5. an error message as mentioned above is shown\r\n6. delete the /settings/admin.php from the url and try loading that\r\n7. the owncloud interface comes up, showing repeatedly the messag as stated above (turned on maintenance mode...)\r\n8. it will output an additional paragraph like that for some time (for me approximately 10 minutes) and then stop.\r\n\r\nthe percentage was 25% in the first run (i.e. in the first second), and the same in every loop afterwards. the page doesn't seem to be updated anymore after some time, but there are still new log entries appearing in the apache error log (see below for examples of the log entries). there is only occasional load on apache2 and mysqld processes, so it doesn't really seem to be doing something...\r\n\r\nwhen reloading the page, it shows \"owncloud is in maintenance mode\".\r\nwhen setting maintenance mode to false via the config, and reloading the page, the process from above (repeating output with the same done percentage) repeats...\r\n\r\n### server configuration\r\noperating system: ubuntu 12.04 64 bit\r\nweb server: apache 2.2.22\r\ndatabase: mysql ver 14.14 distrib 5.5.29\r\nphp version: 5.4.13-2\r\nowncloud version: upgrade from 4.5.8 to 5.0.4\r\n\r\n### client configuration\r\nbrowser: firefox 19.0.2 (also tried with chrome 26.0.1410.64)\r\noperating system: windows 7 64 bit\r\n\r\n### logs\r\n#### web server error log\r\n```\r\nphp fatal error:  class 'oc_filestorage_common' not found in /var/www/owncloud/apps/files_archive/lib/storage.php on line 9\r\n```\r\nmultiple times (10 times every ~30 seconds)\r\n\r\n#### owncloud log (data/owncloud.log)\r\ncan't access that at the moment...\r\n\r\n#### browser log\r\ndidn't think of turning on the js console before upgrade, sorry...","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}