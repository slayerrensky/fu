{"url":"https://api.github.com/repos/owncloud/core/issues/664","labels_url":"https://api.github.com/repos/owncloud/core/issues/664/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/664/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/664/events","html_url":"https://github.com/owncloud/core/issues/664","id":8889976,"number":664,"title":"error while upgrading from 4.5.2 to 4.5.3: failed to update database structure ","user":{"login":"radoeka","id":2937666,"avatar_url":"https://gravatar.com/avatar/711a876513da240a65d1b0b30bfab9dd?d=https%3a%2f%2fidenticons.github.com%2f836bd5cbe958b1cd5cfb383261a5db16.png&r=x","gravatar_id":"711a876513da240a65d1b0b30bfab9dd","url":"https://api.github.com/users/radoeka","html_url":"https://github.com/radoeka","followers_url":"https://api.github.com/users/radoeka/followers","following_url":"https://api.github.com/users/radoeka/following{/other_user}","gists_url":"https://api.github.com/users/radoeka/gists{/gist_id}","starred_url":"https://api.github.com/users/radoeka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/radoeka/subscriptions","organizations_url":"https://api.github.com/users/radoeka/orgs","repos_url":"https://api.github.com/users/radoeka/repos","events_url":"https://api.github.com/users/radoeka/events{/privacy}","received_events_url":"https://api.github.com/users/radoeka/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/1+-+backlog","name":"1 - backlog","color":"ededed"},{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":7,"created_at":"2012-12-01t09:41:03z","updated_at":"2012-12-15t10:38:40z","closed_at":"2012-12-15t10:38:40z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"while upgrading from 4.5.2 to 4.5.3 the following 2 error messages are logged:\n\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: unknown error, _doquery: [error message: could not execute statement]\\n[last executed query: select sql from sqlite_master where type='table' and name='oc_appconfig']\\n[native code: 5]\\n[native message: database is locked]\\n)\",\"level\":4,\"time\":1352926012}\n\nand 2 seconds later:\n{\"app\":\"core\",\"message\":\"failed to get existing database structure for upgrading (mdb2 error: unknown error, _doquery: [error message: could not execute statement]\\n[last executed query: select name from sqlite_master where type='table' and sql not null and name!='sqlite_sequence' order by name]\\n[native code: 5]\\n[native message: database is locked]\\n)\",\"level\":4,\"time\":1352926014}\n\nrepeating the sql statements manually, just works (now):\nprintf \"select sql from sqlite_master where type='table' and name='oc_appconfig';\" | sqlite3 data/owncloud.db\ncreate table \"oc_appconfig\" (\"appid\" varchar(32) default ' ' not null, \"configkey\" varchar(64) default ' ' not null, \"configvalue\" longtext not null)\n\nand\nprintf \"select name from sqlite_master where type='table' and sql not null and name!='sqlite_sequence' order by name;\" | sqlite3 data/owncloud.db\noc_appconfig\noc_bookmarks\n.....\noc_sharing\noc_shorty\noc_users\n\nhow do i verify that the database has been evolved from the 4.5.2 structure to 4.5.3 correctly (or not).  what is still to be done?\n\nmore people are having this problem, e.g:\nhttp://mail.kde.org/pipermail/owncloud/2012-november/006562.html\nbut search the net and there are more messages about it.\n\n- is it possible to make the (sqlite) database migration more robust in this respect?\n- is it possible to rerun the database upgrade again?\n- is it possible to audit the database (structure)\n\n","closed_by":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false}}