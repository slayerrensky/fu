{"url":"https://api.github.com/repos/owncloud/core/issues/4258","labels_url":"https://api.github.com/repos/owncloud/core/issues/4258/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4258/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4258/events","html_url":"https://github.com/owncloud/core/issues/4258","id":17453300,"number":4258,"title":"oc_image->mimetype() always says \"image/png\"","user":{"login":"kondou-ger","id":1410802,"avatar_url":"https://gravatar.com/avatar/917dab919ae812f8252b2f501c514b19?d=https%3a%2f%2fidenticons.github.com%2fd07869ed62cb1b7f88b731956ab913ee.png&r=x","gravatar_id":"917dab919ae812f8252b2f501c514b19","url":"https://api.github.com/users/kondou-ger","html_url":"https://github.com/kondou-ger","followers_url":"https://api.github.com/users/kondou-ger/followers","following_url":"https://api.github.com/users/kondou-ger/following{/other_user}","gists_url":"https://api.github.com/users/kondou-ger/gists{/gist_id}","starred_url":"https://api.github.com/users/kondou-ger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kondou-ger/subscriptions","organizations_url":"https://api.github.com/users/kondou-ger/orgs","repos_url":"https://api.github.com/users/kondou-ger/repos","events_url":"https://api.github.com/users/kondou-ger/events{/privacy}","received_events_url":"https://api.github.com/users/kondou-ger/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/junior+job","name":"junior job","color":"d7e102"}],"state":"closed","assignee":null,"milestone":null,"comments":23,"created_at":"2013-07-31t14:08:16z","updated_at":"2013-09-01t15:46:27z","closed_at":"2013-09-01t15:46:27z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"when calling the mimetype check on an `oc_image` it always says \"image/png\", even if the image is jpeg/gif/whatever.\r\n\r\nexample:\r\n```php\r\n<?php\r\nrequire_once 'lib/base.php';\r\n$img = new oc_image(oc::$serverroot.'/core/img/favicon.png');\r\nvar_dump($img->mimetype());\r\n?>\r\n```\r\n\r\nprobably happens, because the imagetype is set [once](https://github.com/owncloud/core/blob/master/lib/image.php#l28) and then never updated …\r\n\r\non a sidenote the phpdoc of `mimetype()` seems a bit messed up …\r\n`@returns int` … \"image/png\" isn't really a (decimal, base 27 is quite uncommon) number.\r\n\r\n@tanghus @icewind1991 @bartv2 \r\n\r\n----\r\n\r\n### tl;dr of the following comments (if anyone wants to deal with this):\r\n\r\nthis only happens, when loading from raw-data, base64 or `imagecreate()`.\r\n\r\n`imagecreate()` internally uses raw-data, so there the mimetype gets lost, but otherwise we could feed the data-string to [fileinfo](http://php.net/manual/en/function.finfo-buffer.php), which is a soft-dependency of owncloud.\r\n\r\nfurthermore `\\oc_image->data()` converts to png before outputting data. this has to be fixed as well.","closed_by":{"login":"kondou-ger","id":1410802,"avatar_url":"https://gravatar.com/avatar/917dab919ae812f8252b2f501c514b19?d=https%3a%2f%2fidenticons.github.com%2fd07869ed62cb1b7f88b731956ab913ee.png&r=x","gravatar_id":"917dab919ae812f8252b2f501c514b19","url":"https://api.github.com/users/kondou-ger","html_url":"https://github.com/kondou-ger","followers_url":"https://api.github.com/users/kondou-ger/followers","following_url":"https://api.github.com/users/kondou-ger/following{/other_user}","gists_url":"https://api.github.com/users/kondou-ger/gists{/gist_id}","starred_url":"https://api.github.com/users/kondou-ger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kondou-ger/subscriptions","organizations_url":"https://api.github.com/users/kondou-ger/orgs","repos_url":"https://api.github.com/users/kondou-ger/repos","events_url":"https://api.github.com/users/kondou-ger/events{/privacy}","received_events_url":"https://api.github.com/users/kondou-ger/received_events","type":"user","site_admin":false}}