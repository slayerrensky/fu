{"url":"https://api.github.com/repos/owncloud/core/issues/786","labels_url":"https://api.github.com/repos/owncloud/core/issues/786/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/786/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/786/events","html_url":"https://github.com/owncloud/core/issues/786","id":9114761,"number":786,"title":"nginx config tweak for path_info","user":{"login":"pgeorgi","id":47232,"avatar_url":"https://gravatar.com/avatar/8e6a800e7d44284ca4ed77ee8492d01d?d=https%3a%2f%2fidenticons.github.com%2f6f95ee300c10b1c82df0e26180fb13d8.png&r=x","gravatar_id":"8e6a800e7d44284ca4ed77ee8492d01d","url":"https://api.github.com/users/pgeorgi","html_url":"https://github.com/pgeorgi","followers_url":"https://api.github.com/users/pgeorgi/followers","following_url":"https://api.github.com/users/pgeorgi/following{/other_user}","gists_url":"https://api.github.com/users/pgeorgi/gists{/gist_id}","starred_url":"https://api.github.com/users/pgeorgi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgeorgi/subscriptions","organizations_url":"https://api.github.com/users/pgeorgi/orgs","repos_url":"https://api.github.com/users/pgeorgi/repos","events_url":"https://api.github.com/users/pgeorgi/events{/privacy}","received_events_url":"https://api.github.com/users/pgeorgi/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2012-12-08t21:12:15z","updated_at":"2013-01-08t09:06:24z","closed_at":"2013-01-08t09:06:24z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"the recommended handling of php in nginx includes \"try_files $uri =404;\", which matches exact file names, so /uploads/somelegal.git/with-malicious-code.php doesn't lead to code execution. unfortunately that breaks with /remote.php/some-more-path-elements.\n\nthe following nginx configuration allows for the try_files test and path_info to be set correctly. this depend on __internal_path to never be used by owncloud itself.\n\n        error_page 403 = /core/templates/403.php;\n        error_page 404 = /core/templates/404.php;\n\n        location /  {\n                index index.php;\n                try_files $uri $uri/ =404;\n\n                rewrite /.well-known/host-meta /public.php?service=host-meta;\n                rewrite /.well-known/carddav /remote.php/carddav/;\n                rewrite /.well-known/caldav /remote.php/caldav/;\n                rewrite /apps/calendar/caldav.php /remote.php/caldav/;\n                rewrite /apps/contacts/carddav.php /remote.php/carddav/;\n                rewrite /apps/([^/]*)/(.*\\.(css|php))$ /index.php?app=$1&getfile=$2;\n\n                rewrite /remote/(.*)$ /remote.php/$1;\n        }\n\n        location ~ ^/(config|data|db_structure\\.xml|readme) {\n                deny all;\n        }\n\n        location ~* \\.php$ {\n                try_files $uri =404;\n                fastcgi_pass 127.0.0.1:9000;\n                fastcgi_index index.php;\n                fastcgi_param script_filename $document_root$fastcgi_script_name;\n                include fastcgi_params;\n                fastcgi_param  path_info          $path_info;\n        }\n\n        location /remote.php/ {\n                rewrite /remote.php(/.*)$ /remote.php?__internal_path=$1;\n                if ($args ~ (?:^|(&))__internal_path=(.+)($|&)) {\n                        set $path_info $2;\n                }\n        }\n","closed_by":{"login":"lukasreschke","id":878997,"avatar_url":"https://gravatar.com/avatar/f080e75d370a4d8e550983a4898bcf3b?d=https%3a%2f%2fidenticons.github.com%2ff12e47d5bb5359a9f58e8217413be790.png&r=x","gravatar_id":"f080e75d370a4d8e550983a4898bcf3b","url":"https://api.github.com/users/lukasreschke","html_url":"https://github.com/lukasreschke","followers_url":"https://api.github.com/users/lukasreschke/followers","following_url":"https://api.github.com/users/lukasreschke/following{/other_user}","gists_url":"https://api.github.com/users/lukasreschke/gists{/gist_id}","starred_url":"https://api.github.com/users/lukasreschke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukasreschke/subscriptions","organizations_url":"https://api.github.com/users/lukasreschke/orgs","repos_url":"https://api.github.com/users/lukasreschke/repos","events_url":"https://api.github.com/users/lukasreschke/events{/privacy}","received_events_url":"https://api.github.com/users/lukasreschke/received_events","type":"user","site_admin":false}}