{"url":"https://api.github.com/repos/owncloud/core/issues/4425","labels_url":"https://api.github.com/repos/owncloud/core/issues/4425/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4425/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4425/events","html_url":"https://github.com/owncloud/core/issues/4425","id":18057394,"number":4425,"title":"special chars in path names bug cause lose of file versions","user":{"login":"tapete","id":5229149,"avatar_url":"https://gravatar.com/avatar/4f54264b945f0f27a1d4caac2984bc25?d=https%3a%2f%2fidenticons.github.com%2f8e95453fc551ec54b190cd0ec225fd23.png&r=x","gravatar_id":"4f54264b945f0f27a1d4caac2984bc25","url":"https://api.github.com/users/tapete","html_url":"https://github.com/tapete","followers_url":"https://api.github.com/users/tapete/followers","following_url":"https://api.github.com/users/tapete/following{/other_user}","gists_url":"https://api.github.com/users/tapete/gists{/gist_id}","starred_url":"https://api.github.com/users/tapete/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tapete/subscriptions","organizations_url":"https://api.github.com/users/tapete/orgs","repos_url":"https://api.github.com/users/tapete/repos","events_url":"https://api.github.com/users/tapete/events{/privacy}","received_events_url":"https://api.github.com/users/tapete/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/app%3afiles_versions","name":"app:files_versions","color":"02d7e1"}],"state":"closed","assignee":{"login":"schiesbn","id":1589737,"avatar_url":"https://gravatar.com/avatar/8912b598c7b32dd25b87fd168e0b06b2?d=https%3a%2f%2fidenticons.github.com%2f0a323047dbe8329db30eae8dbe96e55e.png&r=x","gravatar_id":"8912b598c7b32dd25b87fd168e0b06b2","url":"https://api.github.com/users/schiesbn","html_url":"https://github.com/schiesbn","followers_url":"https://api.github.com/users/schiesbn/followers","following_url":"https://api.github.com/users/schiesbn/following{/other_user}","gists_url":"https://api.github.com/users/schiesbn/gists{/gist_id}","starred_url":"https://api.github.com/users/schiesbn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schiesbn/subscriptions","organizations_url":"https://api.github.com/users/schiesbn/orgs","repos_url":"https://api.github.com/users/schiesbn/repos","events_url":"https://api.github.com/users/schiesbn/events{/privacy}","received_events_url":"https://api.github.com/users/schiesbn/received_events","type":"user","site_admin":false},"milestone":null,"comments":11,"created_at":"2013-08-14t15:07:42z","updated_at":"2013-08-21t08:01:17z","closed_at":"2013-08-17t15:09:07z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\nusing the sync client 1.3 to sync a folder like:\r\n\"fotos/lã¼neburg/picture1.jpg\"\r\nand change the file content should bring owncloud to save a new file version.\r\n\r\n### actual behaviour\r\nno new file version is saved.\r\n\r\n### steps to reproduce\r\n1. create a folder name with german \"umlaute\" or other special chars\r\n2. change the file content and wait for owncloud client to sync\r\n3. check if a new file version has been created\r\n\r\n### server configuration\r\noperating system: windows 7 prof\r\n\r\nweb server: apache\r\n\r\ndatabase: mysql or sqlite\r\n\r\nphp version: 5.4\r\n\r\nowncloud version: 5.0.10 or 5.0.9\r\n\r\n### client configuration\r\nbrowser: any\r\n\r\noperating system: windows 7, xp\r\n\r\n### logs\r\nno logs\r\n\r\n### debug\r\nthe bug is in:\r\nowncloud\\apps\\files_versions\\lib\\versions.php (line 116)\r\n\r\n         if(!file_exists($versionsfoldername.'/'.$info['dirname'])) {\r\n            mkdir($versionsfoldername.'/'.$info['dirname'], 0750, true);\r\n         }\r\n\r\n#### short description  (symbolic): \r\n##### how it should be:\r\nwriting data:\r\n >  createdir(slugify($path))\r\n >  copy(..,slugify($path).slugify($new_version))\r\n\r\nreading data:\r\n>   readdata(slugify($path).slugify($new_version))\r\n\r\n##### how it is now:\r\nwriting data:\r\n> createdir($path)\r\n> copy(..,slugify($path).slugify($new_version)) --> can' copy (dir doesn't exist)\r\n\r\nreading data:\r\n> readdata(slugify($path).slugify($new_version))  --> can't read file\r\n\r\n### solution ideas (no perfect solution found yet):\r\nuse: $users_view->mkdir();  instead of: mkdir();\r\n\r\nunfortunately this does not work because:\r\n- mkdir() in owncloud\\lib\\files\\storage\\mappedlocal.php does not create directorys in a recursive way. \r\n- $versionsfoldername sometimes ends with a \"/\". in this case\r\n$versionsfoldername.'/'.$info['dirname'] results in a path like \"path1/path2//file.txt\".\r\n\r\ni fixed both issues and it mostly worked but unfortunately there were still some files with this problem. didn't fix the whole issue. hope this helps.","closed_by":{"login":"kabum","id":245432,"avatar_url":"https://gravatar.com/avatar/a1dea19f88f38ea0b5b5b4d19d5b3107?d=https%3a%2f%2fidenticons.github.com%2f53d8cbb3dbc087a02951dec47438ccdf.png&r=x","gravatar_id":"a1dea19f88f38ea0b5b5b4d19d5b3107","url":"https://api.github.com/users/kabum","html_url":"https://github.com/kabum","followers_url":"https://api.github.com/users/kabum/followers","following_url":"https://api.github.com/users/kabum/following{/other_user}","gists_url":"https://api.github.com/users/kabum/gists{/gist_id}","starred_url":"https://api.github.com/users/kabum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kabum/subscriptions","organizations_url":"https://api.github.com/users/kabum/orgs","repos_url":"https://api.github.com/users/kabum/repos","events_url":"https://api.github.com/users/kabum/events{/privacy}","received_events_url":"https://api.github.com/users/kabum/received_events","type":"user","site_admin":false}}