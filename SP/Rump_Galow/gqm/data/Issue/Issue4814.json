{"url":"https://api.github.com/repos/owncloud/core/issues/4814","labels_url":"https://api.github.com/repos/owncloud/core/issues/4814/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4814/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4814/events","html_url":"https://github.com/owncloud/core/issues/4814","id":19340407,"number":4814,"title":"postgresql errors after 5.0.10 to 5.0.11 upgrade","user":{"login":"wenzler","id":4737638,"avatar_url":"https://gravatar.com/avatar/e12e0e48cff2e9fa7aeb8d8ea3adccf0?d=https%3a%2f%2fidenticons.github.com%2f2d30b7595599912ee4690a7716d12268.png&r=x","gravatar_id":"e12e0e48cff2e9fa7aeb8d8ea3adccf0","url":"https://api.github.com/users/wenzler","html_url":"https://github.com/wenzler","followers_url":"https://api.github.com/users/wenzler/followers","following_url":"https://api.github.com/users/wenzler/following{/other_user}","gists_url":"https://api.github.com/users/wenzler/gists{/gist_id}","starred_url":"https://api.github.com/users/wenzler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenzler/subscriptions","organizations_url":"https://api.github.com/users/wenzler/orgs","repos_url":"https://api.github.com/users/wenzler/repos","events_url":"https://api.github.com/users/wenzler/events{/privacy}","received_events_url":"https://api.github.com/users/wenzler/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":0,"created_at":"2013-09-11t19:16:40z","updated_at":"2013-09-11t20:24:15z","closed_at":"2013-09-11t20:24:15z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"hi,\r\n#### expected behaviour\r\nbe able to upload files to owncloud\r\n\r\n#### steps to reproduce\r\nupgrading from 5.0.10 via http://download.opensuse.org/repositories/isv:owncloud:community/debian_7.0/\r\nto version 5.0.11-0 \r\n\r\nupload a file in webui \r\n\r\nupload does not finish but seems to take forever\r\n\r\nreloading the page or opening another tab shows a white page for the directory the file was uploaded\r\n\r\ndeleting the file manually on shell recovers the web view on the folder.\r\n\r\nlooks like the filecache is broken.\r\n\r\n#### logs\r\nlooking at the postgresql log, i found this error beginning with the date of upgrade:\r\n   ```sql\r\n2013-09-11 19:58:42 cest error:  relation \"oc_fscache\" does not exist at character 38\r\n2013-09-11 19:58:42 cest statement:  \r\n                                        select distinct \"user\"\r\n                                        from \"oc_fscache\"\r\n                                \r\n2013-09-11 20:13:57 cest log:  could not receive data from client: connection reset by peer\r\n2013-09-11 20:13:57 cest log:  unexpected eof on client connection\r\n2013-09-11 20:14:01 cest error:  null value in column \"unencrypted_size\" violates not-null constraint\r\n2013-09-11 20:14:01 cest statement:  insert into \"oc_filecache\"(\"mimepart\", \"mimetype\", \"mtime\", \"size\", \"etag\", \"path_hash\", \"path\", \"parent\", \"name\", \"encrypted\", \"storage\") values($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\r\n2013-09-11 20:14:01 cest error:  null value in column \"unencrypted_size\" violates not-null constraint\r\n2013-09-11 20:14:01 cest statement:  insert into \"oc_filecache\"(\"mimepart\", \"mimetype\", \"mtime\", \"size\", \"etag\", \"path_hash\", \"path\", \"parent\", \"name\", \"encrypted\", \"storage\") values($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\r\n2013-09-11 20:14:04 cest error:  null value in column \"unencrypted_size\" violates not-null constraint\r\n2013-09-11 20:14:04 cest statement:  insert into \"oc_filecache\"(\"mimepart\", \"mimetype\", \"mtime\", \"size\", \"etag\", \"path_hash\", \"path\", \"parent\", \"name\", \"encrypted\", \"storage\") values($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\r\n2013-09-11 20:15:17 cest error:  null value in column \"unencrypted_size\" violates not-null constraint\r\n2013-09-11 20:15:17 cest statement:  insert into \"oc_filecache\"(\"mimepart\", \"mimetype\", \"mtime\", \"size\", \"etag\", \"path_hash\", \"path\", \"parent\", \"name\", \"encrypted\", \"storage\") values($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\r\n2013-09-11 20:16:27 cest error:  null value in column \"unencrypted_size\" violates not-null constraint\r\n2013-09-11 20:16:27 cest statement:  insert into \"oc_filecache\"(\"mimepart\", \"mimetype\", \"mtime\", \"size\", \"etag\", \"path_hash\", \"path\", \"parent\", \"name\", \"encrypted\", \"storage\") values($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\r\n2013-09-11 20:16:27 cest error:  current transaction is aborted, commands ignored until end of transaction block\r\n2013-09-11 20:16:27 cest statement:  deallocate pdo_stmt_00000001\r\n2013-09-11 20:16:27 cest error:  current transaction is aborted, commands ignored until end of transaction block\r\n2013-09-11 20:16:27 cest statement:  deallocate pdo_stmt_00000002\r\n2013-09-11 20:16:27 cest error:  current transaction is aborted, commands ignored until end of transaction block\r\n   ```\r\nsurprisingly there's nothing in apache error.log or suphp.log.\r\n\r\n#### server configuration\r\ndebian 7.1-64bit with\r\n* apache 2.2.22\r\n* suphp 0.7.1\r\n* postgresql 9.1\r\n* all os updates applied.\r\n\r\nthe installation has been upgraded several times starting with 5.0.9.\r\n\r\n#### client configuration\r\nfirefox 23.0\r\nubuntu 12.10 64 bit\r\n\r\nthanks & br\r\nsw","closed_by":{"login":"wenzler","id":4737638,"avatar_url":"https://gravatar.com/avatar/e12e0e48cff2e9fa7aeb8d8ea3adccf0?d=https%3a%2f%2fidenticons.github.com%2f2d30b7595599912ee4690a7716d12268.png&r=x","gravatar_id":"e12e0e48cff2e9fa7aeb8d8ea3adccf0","url":"https://api.github.com/users/wenzler","html_url":"https://github.com/wenzler","followers_url":"https://api.github.com/users/wenzler/followers","following_url":"https://api.github.com/users/wenzler/following{/other_user}","gists_url":"https://api.github.com/users/wenzler/gists{/gist_id}","starred_url":"https://api.github.com/users/wenzler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenzler/subscriptions","organizations_url":"https://api.github.com/users/wenzler/orgs","repos_url":"https://api.github.com/users/wenzler/repos","events_url":"https://api.github.com/users/wenzler/events{/privacy}","received_events_url":"https://api.github.com/users/wenzler/received_events","type":"user","site_admin":false}}