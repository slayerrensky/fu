{"url":"https://api.github.com/repos/owncloud/core/issues/893","labels_url":"https://api.github.com/repos/owncloud/core/issues/893/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/893/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/893/events","html_url":"https://github.com/owncloud/core/issues/893","id":9297760,"number":893,"title":"oc-1253  -  mimetype issues","user":{"login":"msrex","id":2625328,"avatar_url":"https://gravatar.com/avatar/24738c0908dad69b83af9cc534bcca80?d=https%3a%2f%2fidenticons.github.com%2ff02814cb1648a9552774c0f932619e91.png&r=x","gravatar_id":"24738c0908dad69b83af9cc534bcca80","url":"https://api.github.com/users/msrex","html_url":"https://github.com/msrex","followers_url":"https://api.github.com/users/msrex/followers","following_url":"https://api.github.com/users/msrex/following{/other_user}","gists_url":"https://api.github.com/users/msrex/gists{/gist_id}","starred_url":"https://api.github.com/users/msrex/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/msrex/subscriptions","organizations_url":"https://api.github.com/users/msrex/orgs","repos_url":"https://api.github.com/users/msrex/repos","events_url":"https://api.github.com/users/msrex/events{/privacy}","received_events_url":"https://api.github.com/users/msrex/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2012-12-14t21:16:13z","updated_at":"2013-02-09t12:27:26z","closed_at":"2013-02-09t12:27:26z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"from http://bugs.owncloud.org/thebuggenie/owncloud/issues/oc-1253\r\n\r\ni can't judge whether this is resolved or not.\r\n\r\ndescription:\r\nowncloud 4.0.4 to owncloud 4.0.7, linux, mysql 5.0.95, php 5.3.10,\r\n\r\nmimetype from mimetypes.list.php aren't writing in db->oc_fscache.\r\n\r\n\r\nreproduction steps:\r\nlook into database -> oc_fscache if all mimetypes are set.\r\n\r\n#1 comment posted by yoh jul 13, 10:18\r\nin lib/helper.php line 460, strncmp function is used. return values of this function (php.net) is :\r\n\r\nreturns < 0 if str1 is less than str2; > 0 if str1 is greater than str2, and 0 if they are equal.\r\n\r\nif i replace :\r\n\r\n    if (!strncmp(php_os, \"win\", 3)) {\r\n\r\nby :\r\n\r\n    if (strncmp(php_os, \"win\", 3)!=0) {\r\n\r\nand then delete all db->oc_fscache entries\r\nthis solves my problem.\r\n\r\n#3 comment posted by bjã¶rn jul 19, 09:17\r\ni just looked at it but i don't really understand your solution. the if-statement should be true if php_os is \"win\", but your modification does exactly the opposite.\r\n\r\n#4 comment posted by yoh jul 19, 13:53\r\nhave you seen ! before strncmp ?\r\n\r\n#5 comment posted by bjã¶rn aug 02, 14:14\r\n@yoh:\r\n\r\nyes, but the if-branch should be executed if php_os equals \"win\". that means that the if-statement should be evaluated to 'true' if strncmp() returns '0'. so the right expression should be either \"if (!strncmp(php_os, \"win\", 3))\" (because '0' is interpreted as 'false') or \"if (strncmp(php_os, \"win\", 3)==0)\".\r\n\r\ni don't know why it works on your system with \"if (strncmp(php_os, \"win\", 3)!=0)\" but it doesn't look like a general solution. maybe you can verify which branch gets executed on your system? running on gnu/linux owncloud should execute the else branch.\r\n\r\n#6 comment posted by yoh aug 03, 06:26\r\nhi,\r\n\r\nrunning on linux.\r\n\r\necho strncmp(php_os, \"win\", 3); -> -1\r\n\r\nnegate -1 -> ????? (it's not boolean)\r\n\r\nand the other branch isn't execute for me.\r\n\r\n#8 comment posted by bjã¶rn sep 18, 10:56\r\nsee the php documentation: http://www.php.net/manual/en/language.types.boolean.php\r\n\r\nevery number different to '0'should be interpreted as true, including negative numbers. even if this doesn't work on your system, than this changes:\r\n\r\n    if (strncmp(php_os, \"win\", 3)!=0) {\r\n\r\nstill don't work. as you said you get '-1' for non windows systems, so the if statement would be true and would lead you in the \"windows-branch\" instead of the \"linux-branch\". i could make the comparison explicit but than the statement needs to be:\r\n\r\n    if (strncmp(php_os, \"win\", 3)==0) {\r\n\r\nif this helps i can make this changes to to code.\r\n\r\n#9 comment posted by frank oct 02, 10:52\r\ncan you check if the proposed fix from bjã¶rn is working?\r\n","closed_by":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false}}