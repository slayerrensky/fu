{"url":"https://api.github.com/repos/owncloud/core/issues/3885","labels_url":"https://api.github.com/repos/owncloud/core/issues/3885/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3885/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3885/events","html_url":"https://github.com/owncloud/core/issues/3885","id":16141983,"number":3885,"title":"huge php memory usage with big files","user":{"login":"valeriansaliou","id":1451907,"avatar_url":"https://gravatar.com/avatar/b4cb8302ee37f985cc76190aaae1b40b?d=https%3a%2f%2fidenticons.github.com%2fa3adeb142b5b6944d931786eb71d017e.png&r=x","gravatar_id":"b4cb8302ee37f985cc76190aaae1b40b","url":"https://api.github.com/users/valeriansaliou","html_url":"https://github.com/valeriansaliou","followers_url":"https://api.github.com/users/valeriansaliou/followers","following_url":"https://api.github.com/users/valeriansaliou/following{/other_user}","gists_url":"https://api.github.com/users/valeriansaliou/gists{/gist_id}","starred_url":"https://api.github.com/users/valeriansaliou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valeriansaliou/subscriptions","organizations_url":"https://api.github.com/users/valeriansaliou/orgs","repos_url":"https://api.github.com/users/valeriansaliou/repos","events_url":"https://api.github.com/users/valeriansaliou/events{/privacy}","received_events_url":"https://api.github.com/users/valeriansaliou/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2013-06-28t13:39:40z","updated_at":"2013-10-17t13:07:27z","closed_at":"2013-10-17t13:07:27z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"hello,\r\n\r\nit seems that owncloud client api is very hungry on memory when dealing with big files (1gb in my case). i manually uploaded a big mp4 video to my owncloud via ssh, in my data/username/sub folder.\r\n\r\nthen, my running owncloud mac client started to sync the file to my local computer. later, i noticed that the server was slowing down, swapping and finally crashing. i retried the sync with a fresh server reboot, same behavior. 2 of my 4 php processes were consuming 500mb of memory, a number which was quickly growing as the sync was going on.\r\n\r\nseems that your sync web api is leaking for some buffer empty code. why not reading the file progressively as the sync goes on, using buffers, while flushing the transmitted data buffers?\r\n\r\n### expected behaviour\r\nnormal php memory footprint.\r\n\r\n### actual behaviour\r\nseems that the file is entirely read in php memory to be then dispatched to the sync client.\r\n\r\n### steps to reproduce\r\n1. manually upload a file via ssh/ftp to your server's owncloud data folder\r\n2. wait for the sync client to begin sync\r\n3. see the php processes memory usage going up\r\n\r\n### server configuration\r\noperating system: debian 7 64 bits\r\n\r\nweb server: lighttpd 1.4.x\r\n\r\ndatabase: mysql\r\n\r\nphp version: php 5.4.4-14\r\n\r\nowncloud version: 5.0.7\r\n\r\n### client configuration\r\nbrowser: n/a\r\n\r\noperating system: mac os x 10.8.4","closed_by":{"login":"karlitschek","id":867445,"avatar_url":"https://gravatar.com/avatar/87ce2b4531ee1a0c32b50e0d8f049224?d=https%3a%2f%2fidenticons.github.com%2f06e7098636caebfc9c30c9f52eb905df.png&r=x","gravatar_id":"87ce2b4531ee1a0c32b50e0d8f049224","url":"https://api.github.com/users/karlitschek","html_url":"https://github.com/karlitschek","followers_url":"https://api.github.com/users/karlitschek/followers","following_url":"https://api.github.com/users/karlitschek/following{/other_user}","gists_url":"https://api.github.com/users/karlitschek/gists{/gist_id}","starred_url":"https://api.github.com/users/karlitschek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/karlitschek/subscriptions","organizations_url":"https://api.github.com/users/karlitschek/orgs","repos_url":"https://api.github.com/users/karlitschek/repos","events_url":"https://api.github.com/users/karlitschek/events{/privacy}","received_events_url":"https://api.github.com/users/karlitschek/received_events","type":"user","site_admin":false}}