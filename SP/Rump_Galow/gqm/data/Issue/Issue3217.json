{"url":"https://api.github.com/repos/owncloud/core/issues/3217","labels_url":"https://api.github.com/repos/owncloud/core/issues/3217/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3217/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3217/events","html_url":"https://github.com/owncloud/core/issues/3217","id":13892551,"number":3217,"title":"enhancement - filter and change ldap group names by re","user":{"login":"roaima","id":3172148,"avatar_url":"https://gravatar.com/avatar/730eca5d4c0bf12c75ee57452e1c9f36?d=https%3a%2f%2fidenticons.github.com%2f730aed3ce0a42f57c828bf77233aff69.png&r=x","gravatar_id":"730eca5d4c0bf12c75ee57452e1c9f36","url":"https://api.github.com/users/roaima","html_url":"https://github.com/roaima","followers_url":"https://api.github.com/users/roaima/followers","following_url":"https://api.github.com/users/roaima/following{/other_user}","gists_url":"https://api.github.com/users/roaima/gists{/gist_id}","starred_url":"https://api.github.com/users/roaima/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roaima/subscriptions","organizations_url":"https://api.github.com/users/roaima/orgs","repos_url":"https://api.github.com/users/roaima/repos","events_url":"https://api.github.com/users/roaima/events{/privacy}","received_events_url":"https://api.github.com/users/roaima/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/app%3auser_ldap","name":"app:user_ldap","color":"02d7e1"},{"url":"https://api.github.com/repos/owncloud/core/labels/enhancement","name":"enhancement","color":"02e10c"}],"state":"closed","assignee":{"login":"blizzz","id":2184312,"avatar_url":"https://gravatar.com/avatar/1898b25a9cb3aa1a0f0febd1359910b9?d=https%3a%2f%2fidenticons.github.com%2fca03acec6deadf508b75eb0cf9ba036c.png&r=x","gravatar_id":"1898b25a9cb3aa1a0f0febd1359910b9","url":"https://api.github.com/users/blizzz","html_url":"https://github.com/blizzz","followers_url":"https://api.github.com/users/blizzz/followers","following_url":"https://api.github.com/users/blizzz/following{/other_user}","gists_url":"https://api.github.com/users/blizzz/gists{/gist_id}","starred_url":"https://api.github.com/users/blizzz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blizzz/subscriptions","organizations_url":"https://api.github.com/users/blizzz/orgs","repos_url":"https://api.github.com/users/blizzz/repos","events_url":"https://api.github.com/users/blizzz/events{/privacy}","received_events_url":"https://api.github.com/users/blizzz/received_events","type":"user","site_admin":false},"milestone":null,"comments":3,"created_at":"2013-05-02t14:05:31z","updated_at":"2013-06-11t17:53:13z","closed_at":"2013-06-04t10:35:03z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"this is an enhancement request for the ldap subsystem, with implications for the sharing feature and authentication.\r\n\r\ndescription\r\n----------------\r\nwe have an instance of owncloud connected to active directory via ldap. there are many groups and users within ad that should not be displayed to user. i should like to be able to create a regular expression that defines the set of valid groups that owncloud is to accept. by implication this would also define a subset of the users that can use owncloud (users can only access owncloud if they are a member of one or more of these groups).\r\n\r\nthis group filtering behaviour would only be triggered if the re was non-empty. it would be further modified by the toggle option \"allow users to share with anyone\" vs \"allow users to only share with users in their groups\" as i believe this remains a valid configuration setting.\r\n\r\nhere is an example. the system group \"iis_wpg\" and system user \"backupoperator\" should not figure within the owncloud installation. however, i want to be able to create groups such as \"owncloud uk accounts\" or \"owncloud all accounts\" and assign users to them. such groups and users would be represented and available within owncloud. this requirement could be satisfied by requiring user accounts to be within a permitted group, and filtering group names against an re such as \"^owncloud.*accounts$\".\r\n\r\nadditionally, i should like the display presentation of group names matched by the re to be modified, so that unwanted parts of the group name could be stripped. (this would be useful in a corporate environment where group names are often prefixed similarly within ad but do not need the prefix within the application itself.)\r\n\r\nusing the example above, the \"owncloud\" prefix for the groups is not required within owncloud. this could be achieved by allowing brackets within the re to match the relevant part of the group name: \"^owncloud\\s+(.*accounts)$\". here, \"owncloud all accounts\" would be presented within owncloud simply as \"all accounts\".\r\n\r\nif you wanted to go full out for a complex solution, you could allow for match and replace options. in this scenario we could take a match of \"^owncloud\\s+(.*?)\\s+accounts)$\" and a replacement of \"$1 users\" to translate group names within ad/ldap such as \"owncloud uk accounts\" to corresponding owncloud-friendly names such as \"uk users\".\r\n\r\nthis last scenario would be my preferred solution, but i wanted to build up to it.\r\n\r\n\r\nimplementation\r\n----------------\r\ni have implemented some of this directly in the php code for the 4.5.x series (specifically, i'm running 4.5.7 at the moment). the places i changed were as follows:\r\n\r\n1. apps/user_ldap/lib/access.php: function searchgroups() - filter group names by re\r\n2. apps/user_ldap/user_ldap.php: function checkpassword() - user must be within at least one \"owncloud\" group\r\n\r\ni don't think my code is fit for publication but i'm happy to include patches to illustrate the points.\r\n","closed_by":{"login":"blizzz","id":2184312,"avatar_url":"https://gravatar.com/avatar/1898b25a9cb3aa1a0f0febd1359910b9?d=https%3a%2f%2fidenticons.github.com%2fca03acec6deadf508b75eb0cf9ba036c.png&r=x","gravatar_id":"1898b25a9cb3aa1a0f0febd1359910b9","url":"https://api.github.com/users/blizzz","html_url":"https://github.com/blizzz","followers_url":"https://api.github.com/users/blizzz/followers","following_url":"https://api.github.com/users/blizzz/following{/other_user}","gists_url":"https://api.github.com/users/blizzz/gists{/gist_id}","starred_url":"https://api.github.com/users/blizzz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/blizzz/subscriptions","organizations_url":"https://api.github.com/users/blizzz/orgs","repos_url":"https://api.github.com/users/blizzz/repos","events_url":"https://api.github.com/users/blizzz/events{/privacy}","received_events_url":"https://api.github.com/users/blizzz/received_events","type":"user","site_admin":false}}