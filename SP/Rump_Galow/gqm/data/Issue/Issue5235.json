{"url":"https://api.github.com/repos/owncloud/core/issues/5235","labels_url":"https://api.github.com/repos/owncloud/core/issues/5235/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/5235/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/5235/events","html_url":"https://github.com/owncloud/core/issues/5235","id":20744282,"number":5235,"title":"delta upload/download","user":{"login":"zatricky","id":3970906,"avatar_url":"https://gravatar.com/avatar/8f1abbebfccca89beabcc58bda7887c1?d=https%3a%2f%2fidenticons.github.com%2f704290d64eb633787cca98b863c490c5.png&r=x","gravatar_id":"8f1abbebfccca89beabcc58bda7887c1","url":"https://api.github.com/users/zatricky","html_url":"https://github.com/zatricky","followers_url":"https://api.github.com/users/zatricky/followers","following_url":"https://api.github.com/users/zatricky/following{/other_user}","gists_url":"https://api.github.com/users/zatricky/gists{/gist_id}","starred_url":"https://api.github.com/users/zatricky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zatricky/subscriptions","organizations_url":"https://api.github.com/users/zatricky/orgs","repos_url":"https://api.github.com/users/zatricky/repos","events_url":"https://api.github.com/users/zatricky/events{/privacy}","received_events_url":"https://api.github.com/users/zatricky/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/1+-+backlog","name":"1 - backlog","color":"ededed"},{"url":"https://api.github.com/repos/owncloud/core/labels/enhancement","name":"enhancement","color":"02e10c"}],"state":"open","assignee":null,"milestone":null,"comments":1,"created_at":"2013-10-09t14:09:23z","updated_at":"2013-11-29t14:03:30z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"#### situation/issue\r\nin reference to #523, the submitter mentions rsync but specifically refers to using md5sum hashes in order only to verify whether or not a file has changed. rsync uses a different mechanism to achieve a similar-yet-different optimisation. reference at bottom.\r\n\r\nin the case where a file has changed only *slightly*, rsync can synchronise the content with minimal bandwidth. it does however cause high i/o on both ends due to having to read and hash the entirety of the content one chunk at a time. #523 refers to a similar aim (but where content has *not* changed) with almost no sync-time i/o needed server-side.\r\n\r\n#### possible solution\r\nwithin owncloud/mirall, a similar mechanism can be achieved using a combination of two methods, effectively implementing an \"rsync algorithm\" over http:\r\n* hashing of content chunks in a method similar to the rsync algorithm (high sync-time i/o)\r\n* partial upload/download (see the implementation example in the notes below)\r\n\r\nthis would then allow large files with small changes to be synchronised using api/http protocols with minimal bandwidth.\r\n\r\n#### caveats/dependencies/notes\r\n* rsync algorithm explained: https://en.wikipedia.org/wiki/rsync#algorithm\r\n* partial upload - example implementation done in php: http://html5uploader.filkor.org/faq.html / https://github.com/filad/html5uploader\r\n* the sync-time server hashing can cause high i/o. this could be mitigated by creating a new table for storing these hashes in the database. there are two (long-term) non-issues this creates. 1. this adds complexity. 2. the database server would have to store a lot more metadata than previously. at this point the right thing to do might be to ignore this specific performance issue and defer it to a future separate fix. if it can be tackled at the same time, that would be a bonus. :)","closed_by":null}