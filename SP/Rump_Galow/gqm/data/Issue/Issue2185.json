{"url":"https://api.github.com/repos/owncloud/core/issues/2185","labels_url":"https://api.github.com/repos/owncloud/core/issues/2185/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/2185/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/2185/events","html_url":"https://github.com/owncloud/core/issues/2185","id":11794209,"number":2185,"title":"drive deletion doesnt clean up database cache + deleted folder orphants causing oc-db problemss","user":{"login":"mmattel","id":3321281,"avatar_url":"https://gravatar.com/avatar/2d576241f3ac901ec52f1ec4a9c3b77b?d=https%3a%2f%2fidenticons.github.com%2f62fba4fe6711d41fdbfc7ccc04efb8f4.png&r=x","gravatar_id":"2d576241f3ac901ec52f1ec4a9c3b77b","url":"https://api.github.com/users/mmattel","html_url":"https://github.com/mmattel","followers_url":"https://api.github.com/users/mmattel/followers","following_url":"https://api.github.com/users/mmattel/following{/other_user}","gists_url":"https://api.github.com/users/mmattel/gists{/gist_id}","starred_url":"https://api.github.com/users/mmattel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mmattel/subscriptions","organizations_url":"https://api.github.com/users/mmattel/orgs","repos_url":"https://api.github.com/users/mmattel/repos","events_url":"https://api.github.com/users/mmattel/events{/privacy}","received_events_url":"https://api.github.com/users/mmattel/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/app%3afiles_external","name":"app:files_external","color":"02d7e1"},{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"}],"state":"closed","assignee":null,"milestone":null,"comments":4,"created_at":"2013-03-08t07:11:06z","updated_at":"2013-08-07t18:28:49z","closed_at":"2013-08-07t18:28:49z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"ubuntu 12.04, oc downloaded from github master (core, apps, 3rdparty) from yesterday\r\napp: external local storage\r\nmounted via ubuntu multiple drives via smb, these drives are added via the app as local drives.\r\nall tests were made with opera, and double checked by clearing operas cache.\r\n\r\nproblem 1:\r\nwhen a sub folder in in the mounted drive got deleted via smb, no update in oc is made. oc doesnt recognize the change and doesnt clean up its cache. even worse, trying to just list the path where the deleted folder was in, letâ´s oc jump back to files root! (not drive root...)\r\n\r\nproblem 2:\r\nwhen the drive gets dismounted via the app (checked via files app) and re-added with the same name, the drive doesnt get rescanned and the same old cached data is tried to be presented ending in problem 1\r\n\r\nthis leads me to the conclusion that:\r\na.) drive deletion does not clean up the database.\r\nb.) drive sub folder change is not recognized and cleaned up in the database.\r\n\r\nad a) i also checked by restarting apache, but this has no impact. it seems to me, that what is in mount.json versus what is in the database is only checked for added drives, but not for deleted drives. what would happen if you do not use the app but manage mount.json manually? i guess the same as the deletion is not fully recognized (db-orphants left over)...\r\n\r\nboth issues can cause heavy problems for <all> applications using mapped drives if changes (delete, remove subfolder) are not properly managed by oc.\r\n\r\nbtw: if a drive got deleted/sub structure changed, you also must manage created folders in  owncloud/data/user/drive so that the gallery app does not get confused.\r\n","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}