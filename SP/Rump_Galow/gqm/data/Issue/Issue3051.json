{"url":"https://api.github.com/repos/owncloud/core/issues/3051","labels_url":"https://api.github.com/repos/owncloud/core/issues/3051/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3051/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3051/events","html_url":"https://github.com/owncloud/core/pull/3051","id":13441468,"number":3051,"title":"reworked background job system.","user":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":27,"created_at":"2013-04-20t21:40:21z","updated_at":"2013-06-03t20:46:58z","closed_at":"2013-06-02t21:29:59z","pull_request":{"html_url":"https://github.com/owncloud/core/pull/3051","diff_url":"https://github.com/owncloud/core/pull/3051.diff","patch_url":"https://github.com/owncloud/core/pull/3051.patch"},"body":"this replaces the old background job system with a new object oriented system.\r\n\r\neach job is represented by a class that inherits from `oc\\backgroundjob\\job` and is registered by calling `ocp\\backgroundjob::registerjob($job, $argument=null)` where $job is either an instance of the job class or the classname of the job class, it also accepts one argument which is passed to the job on execution, this argument is json encoded before it's stored in the db so it can hold any variable that can be json encoded.\r\n\r\nwhen a job is executed `$job->run($argument)` is called.\r\n\r\ninstead of extending `oc\\backgroundjob\\job` there is also the option of extending `oc\\backgroundjob\\queuedjob` or `oc\\backgroundjob\\timedjob`.\r\n - a `queuedjob` is only run once and automatically removed from the job list afterwards.\r\n - a `timedjob` is only run at most once every specific interval, this interval is to be set in the contructor using `$this->setinterval($interval)` with $interval in secconds\r\n\r\n--\r\n\r\nexample:\r\n\r\n```\r\nclass examplejob extends \\oc\\backgroundjob\\job{\r\n    public function run($argument){\r\n        error_log($argument);\r\n    }\r\n}\r\n\r\n\\ocp\\backgroundjob::register('examplejob', 'foobar');\r\n```\r\n\r\nor with a timed job:\r\n\r\n```\r\nclass exampletimedjob extends \\oc\\backgroundjob\\timedjob{\r\n    public function __construct(){\r\n        $this->setinterval(60);\r\n    }\r\n    public function run($argument){\r\n        error_log(time());\r\n    }\r\n}\r\n\r\n\\ocp\\backgroundjob::register('exampletimedjob');\r\n```\r\n\r\n--\r\n\r\nthis new system provides a common implementation of a system that currently needs to be re-implemented for every app that needs it, the timedjob and makes it easy to add more job types later if needed.","closed_by":{"login":"icewind1991","id":1283854,"avatar_url":"https://gravatar.com/avatar/7c20f90ca5df67dd2cad22a8e2f80d8f?d=https%3a%2f%2fidenticons.github.com%2fc818423776eba38604496a7caddc0251.png&r=x","gravatar_id":"7c20f90ca5df67dd2cad22a8e2f80d8f","url":"https://api.github.com/users/icewind1991","html_url":"https://github.com/icewind1991","followers_url":"https://api.github.com/users/icewind1991/followers","following_url":"https://api.github.com/users/icewind1991/following{/other_user}","gists_url":"https://api.github.com/users/icewind1991/gists{/gist_id}","starred_url":"https://api.github.com/users/icewind1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icewind1991/subscriptions","organizations_url":"https://api.github.com/users/icewind1991/orgs","repos_url":"https://api.github.com/users/icewind1991/repos","events_url":"https://api.github.com/users/icewind1991/events{/privacy}","received_events_url":"https://api.github.com/users/icewind1991/received_events","type":"user","site_admin":false}}