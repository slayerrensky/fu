{"url":"https://api.github.com/repos/owncloud/core/issues/3491","labels_url":"https://api.github.com/repos/owncloud/core/issues/3491/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3491/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3491/events","html_url":"https://github.com/owncloud/core/issues/3491","id":14757099,"number":3491,"title":"oc 5.0.6 - external storage - smb/cifs - temporary files not deleted","user":{"login":"j-ed","id":2572764,"avatar_url":"https://gravatar.com/avatar/2578b8d55efee3aa1bd7dec59d4c18c3?d=https%3a%2f%2fidenticons.github.com%2f5c998343ba958bae7db884388465bec3.png&r=x","gravatar_id":"2578b8d55efee3aa1bd7dec59d4c18c3","url":"https://api.github.com/users/j-ed","html_url":"https://github.com/j-ed","followers_url":"https://api.github.com/users/j-ed/followers","following_url":"https://api.github.com/users/j-ed/following{/other_user}","gists_url":"https://api.github.com/users/j-ed/gists{/gist_id}","starred_url":"https://api.github.com/users/j-ed/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/j-ed/subscriptions","organizations_url":"https://api.github.com/users/j-ed/orgs","repos_url":"https://api.github.com/users/j-ed/repos","events_url":"https://api.github.com/users/j-ed/events{/privacy}","received_events_url":"https://api.github.com/users/j-ed/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/app%3afiles_external","name":"app:files_external","color":"02d7e1"}],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2013-05-25t12:06:43z","updated_at":"2013-07-28t18:05:41z","closed_at":"2013-07-28t18:05:41z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"## expected behaviour\r\n\r\nif you've created a smb mount configuration temporary files, which are created by\r\ninternal oc functions, should automatically be removed.\r\n\r\n\r\n## actual behaviour\r\n\r\na lot of temporary files are not deleted automatically.\r\n\r\n## steps to reproduce\r\n\r\n1) create a `mount.php` file containing the following entry:\r\n\r\n```php\r\n<?php\r\nreturn array(\r\n  'user' => array(\r\n    'jed' => array(\r\n      '/$user/files/music'=>array('class'=>'oc_filestorage_smb','options'=>array('host'=>'server.privat.lan','user'=>'smbtest','password'=>'smppass','share'=>'/archive','/mp3')),\r\n    ),\r\n  ),\r\n);\r\n```\r\n\r\n2) check the content of the /tmp folder and you will find a lot of `smb.down.xxxx` files, appr. 11 per minute, which are not being deleted automatically.\r\n\r\n```shell\r\n# ls -alt smb.down*\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.ybolxl\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.9vkcwe\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.vvq3fj\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.5o2rof\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.mmn63v\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.8k0pj9\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.fgqqv2\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.woekp3\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:59 smb.down.w90aaz\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.5wv7fq\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.uhjtob\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.iauqnr\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.9dvn2o\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.m2mrdv\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.yjwwxq\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.fnwblb\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.wrevag\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.sfjosz\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.hjcloa\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:58 smb.down.jscrx3\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:57 smb.down.92li6f\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:57 smb.down.ewgbwk\r\n-rw------- 1 wwwrun nogroup 0 may 25 13:57 smb.down.soe1ub\r\n...\r\n```\r\n3) it looks like that these files are being created by the `stream_open`function in `../owncloud/3rdparty/smb4php/smb.php`.\r\n\r\n## environment\r\n\r\n#### server configuration\r\n\r\nos: linux 2.6.24-24\r\nweb server: apache/ 2.2.22\r\ndatabase: mysql\r\nphp version: 5.3.13\r\nowncloud version: 5.0.6\r\n\r\n#### client configuration\r\n\r\nbrowser: firefox 21.0\r\noperating system: windows 7","closed_by":{"login":"j-ed","id":2572764,"avatar_url":"https://gravatar.com/avatar/2578b8d55efee3aa1bd7dec59d4c18c3?d=https%3a%2f%2fidenticons.github.com%2f5c998343ba958bae7db884388465bec3.png&r=x","gravatar_id":"2578b8d55efee3aa1bd7dec59d4c18c3","url":"https://api.github.com/users/j-ed","html_url":"https://github.com/j-ed","followers_url":"https://api.github.com/users/j-ed/followers","following_url":"https://api.github.com/users/j-ed/following{/other_user}","gists_url":"https://api.github.com/users/j-ed/gists{/gist_id}","starred_url":"https://api.github.com/users/j-ed/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/j-ed/subscriptions","organizations_url":"https://api.github.com/users/j-ed/orgs","repos_url":"https://api.github.com/users/j-ed/repos","events_url":"https://api.github.com/users/j-ed/events{/privacy}","received_events_url":"https://api.github.com/users/j-ed/received_events","type":"user","site_admin":false}}