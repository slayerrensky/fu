{"url":"https://api.github.com/repos/owncloud/core/issues/4085","labels_url":"https://api.github.com/repos/owncloud/core/issues/4085/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4085/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4085/events","html_url":"https://github.com/owncloud/core/issues/4085","id":16816982,"number":4085,"title":"auto upgrade from 5.0.7 to 5.0.8 fails with mysql query error","user":{"login":"valleygeek","id":5023191,"avatar_url":"https://gravatar.com/avatar/cc4caf88c02c37a391cf31ac66c72a22?d=https%3a%2f%2fidenticons.github.com%2fdc47389544535b41a12decad5216d019.png&r=x","gravatar_id":"cc4caf88c02c37a391cf31ac66c72a22","url":"https://api.github.com/users/valleygeek","html_url":"https://github.com/valleygeek","followers_url":"https://api.github.com/users/valleygeek/followers","following_url":"https://api.github.com/users/valleygeek/following{/other_user}","gists_url":"https://api.github.com/users/valleygeek/gists{/gist_id}","starred_url":"https://api.github.com/users/valleygeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valleygeek/subscriptions","organizations_url":"https://api.github.com/users/valleygeek/orgs","repos_url":"https://api.github.com/users/valleygeek/repos","events_url":"https://api.github.com/users/valleygeek/events{/privacy}","received_events_url":"https://api.github.com/users/valleygeek/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/update","name":"update","color":"e10c02"},{"url":"https://api.github.com/repos/owncloud/core/labels/v5.x","name":"v5.x","color":"ededed"}],"state":"open","assignee":null,"milestone":null,"comments":38,"created_at":"2013-07-16t15:46:32z","updated_at":"2013-12-14t12:11:59z","closed_at":null,"pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"i attempted an auto upgrade from the admin interface which has resulted in the below error. i didn't see any other similar issues out there and i am not certain how i should proceed to resolve this - possibly something to do with with calendar app.\r\n\r\n__workaround methods listed in comments__\r\n\r\n### expected behaviour\r\na successful update to version 5.0.8\r\n\r\n### actual behaviour\r\nupgrade fails and error displayed.\r\n![owncloud message on update](https://f.cloud.github.com/assets/5023191/805719/097503a2-ee2c-11e2-86e0-78ec05f85311.png)\r\n\r\n### steps to reproduce\r\nunknown - i did modify a couple files to make the files sizes display better a while back but have had no issues until this update.\r\n```\r\nhttps://github.com/owncloud/core/issues/633\r\n\r\ndisplaying human readable file sizes is more useful for me, and a number of other users. i understand the reasoning behind not displaying the human readable size by default, but could it the change be implemented as an option to switch between the two options globally or per user?\r\n\r\ni made a couple small changes on my install to display the human readable sizes that worked well.\r\n\r\nedit core/js/js.js\r\ncomment out the existing simplefilesize function (line ~642) using // on each line or /** on first line and **/ on last line\r\nadd your own function as follows:\r\n\r\nfunction simplefilesize(size) {\r\n        return humanfilesize(size);\r\n}\r\n\r\nedit lib/template.php\r\ncomment out the existing simple_file_size function (line ~71)\r\nadd your own function as follows:\r\n\r\nfunction simple_file_size( $bytes ) {\r\n        return oc_helper::humanfilesize( $bytes );\r\n}\r\n```\r\n\r\n### server configuration\r\noperating system: ubuntu 13.04\r\n\r\nweb server: apache 2.2.22 (ubuntu)\r\n\r\ndatabase: mysql 5.5.31\r\n\r\nphp version: php version 5.4.9\r\n\r\nowncloud version: should be 5.0.8 (config.php: 'version' => '5.0.12',)\r\n\r\n### client configuration\r\nbrowser: firefox v22.0\r\n\r\noperating system: windows 7 x64\r\n\r\n### logs\r\n#### web server error log\r\n```\r\nno output generated\r\n```\r\n\r\n#### owncloud log (data/owncloud.log) - set to debug level\r\n```\r\n{\"app\":\"core\",\"message\":\"adding user backend instance of oc_user_database.\",\"level\":0,\"time\":1373988159}\r\n{\"app\":\"core\",\"message\":\"adding user backend instance of oc_user_database.\",\"level\":0,\"time\":1373988159}\r\n{\"app\":\"calendar\",\"message\":\"starting app upgrade from 0.6.1 to 0.6.3\",\"level\":0,\"time\":1373988159}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: unknown error, _doquery: [error message: could not execute statement]\\n[last executed query: alter table `oc_calendar_objects` rename to `oc_clndr_objects`, change `id` `id` int unsigned not null auto_increment primary key, change `calendarid` `calendarid` int unsigned default 0 not null, change `startdate` `startdate` datetime default '1970-01-01 00:00:00', change `enddate` `enddate` datetime default '1970-01-01 00:00:00']\\n[native code: 1068]\\n[native message: multiple primary key defined]\\n)\",\"level\":4,\"time\":1373988160}\r\n{\"app\":\"core\",\"message\":\"adding user backend instance of oc_user_database.\",\"level\":0,\"time\":1373988160}\r\n{\"app\":\"core\",\"message\":\"adding user backend instance of oc_user_database.\",\"level\":0,\"time\":1373988160}\r\n{\"app\":\"core\",\"message\":\"starting upgrade from 5.0.12 to 5.0.14\",\"level\":2,\"time\":1373988160}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: unknown error, _doquery: [error message: could not execute statement]\\n[last executed query: alter table `oc_locks` change `id` `id` int unsigned not null auto_increment primary key, change `timeout` `timeout` int unsigned default 0, change `created` `created` bigint default 0, change `scope` `scope` tinyint default 0, change `depth` `depth` tinyint default 0]\\n[native code: 1068]\\n[native message: multiple primary key defined]\\n)\",\"level\":4,\"time\":1373988161}\r\n{\"app\":\"core\",\"message\":\"adding user backend instance of oc_user_database.\",\"level\":0,\"time\":1373988161}\r\n```\r\n\r\n#### browser log\r\n```\r\nn/a\r\n```","closed_by":null}