{"url":"https://api.github.com/repos/owncloud/core/issues/2580","labels_url":"https://api.github.com/repos/owncloud/core/issues/2580/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/2580/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/2580/events","html_url":"https://github.com/owncloud/core/issues/2580","id":12456254,"number":2580,"title":"owncloud throws error 500 after upgrade to 5.0 when accessed via webdav first","user":{"login":"danimo","id":1315934,"avatar_url":"https://gravatar.com/avatar/9467db6bbeaac42484603e0788aec39d?d=https%3a%2f%2fidenticons.github.com%2f296ab09e5a31dcf357f4d4784453db99.png&r=x","gravatar_id":"9467db6bbeaac42484603e0788aec39d","url":"https://api.github.com/users/danimo","html_url":"https://github.com/danimo","followers_url":"https://api.github.com/users/danimo/followers","following_url":"https://api.github.com/users/danimo/following{/other_user}","gists_url":"https://api.github.com/users/danimo/gists{/gist_id}","starred_url":"https://api.github.com/users/danimo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danimo/subscriptions","organizations_url":"https://api.github.com/users/danimo/orgs","repos_url":"https://api.github.com/users/danimo/repos","events_url":"https://api.github.com/users/danimo/events{/privacy}","received_events_url":"https://api.github.com/users/danimo/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/bug","name":"bug","color":"fc2929"},{"url":"https://api.github.com/repos/owncloud/core/labels/v5.x","name":"v5.x","color":"ededed"}],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2013-03-26t16:07:33z","updated_at":"2013-08-07t14:17:39z","closed_at":"2013-08-07t14:17:39z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\n\r\nowncloud should detect that upgrade scripts need to be run and return a 503 (service not available), e.g. by entering maintenance mode.\r\n\r\n### actual behaviour\r\n\r\nowncloud only enters maintenance mode _after_ someone has accessed the webinterface. before, it returns\r\n\r\n```\r\n* about to connect() to localhost port 80 (#0)\r\n*   trying 127.0.0.1... connected\r\n* server auth using basic with user 'admin'\r\n> get /~danimo/owncloud/remote.php/webdav http/1.1\r\n> authorization: basic ywrtaw46ywrtaw4=\r\n> user-agent: curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 openssl/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3\r\n> host: localhost\r\n> accept: */*\r\n> \r\n< http/1.1 500 internal server error\r\n< date: tue, 26 mar 2013 15:59:07 gmt\r\n< server: apache/2.2.22 (ubuntu)\r\n< x-powered-by: php/5.3.10-1ubuntu3.6\r\n< set-cookie: 5151b920c75b8=otcrkn1utocjk1m6927qn3mf72; path=/; httponly\r\n< expires: thu, 19 nov 1981 08:52:00 gmt\r\n< cache-control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0\r\n< pragma: no-cache\r\n< set-cookie: 5151b920c75b8=vr8mgb86462ubcmi4ebrmqdk17; path=/; httponly\r\n< content-length: 291\r\n< connection: close\r\n< content-type: application/xml; charset=utf-8\r\n< \r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<d:error xmlns:d=\"dav:\" xmlns:s=\"http://sabredav.org/ns\">\r\n  <s:exception>databaseexception</s:exception>\r\n  <s:message>sqlstate[hy000]: general error: 1 no such column: displayname</s:message>\r\n  <s:sabredav-version>1.7.5</s:sabredav-version>\r\n</d:error>\r\n```\r\n\r\n### steps to reproduce\r\n1. have an existing 4.5 install\r\n2. upgrade to 5.0.0 packages\r\n3. connect to remote.php/webdav\r\n\r\n### server configuration\r\noperating system: ubuntu 12.04\r\n\r\nweb server: apache\r\n\r\ndatabase: sqlite\r\n\r\nphp version: php 5.3.10-1ubuntu3.6 with suhosin-patch\r\n\r\nowncloud version: 5.0.0\r\n\r\n### client configuration\r\nbrowser: chrome \r\n\r\noperating system: ubuntu 12.04\r\n\r\n### logs\r\n#### web server error log\r\n```\r\n127.0.0.1 - admin [26/mar/2013:16:59:07 +0100] \"get /~danimo/owncloud/remote.php/webdav http/1.1\" 500 802 \"-\" \"curl/7.22.0 (x86_64-pc-linux-gnu) libcurl/7.22.0 openssl/1.0.1 zlib/1.2.3.4 libidn/1.23 librtmp/2.3\"\r\n```\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n{\"app\":\"hook\",\"message\":\"error while running hook (\\\\oc\\\\files\\\\storage\\\\shared::setup): sqlstate[hy000]: general error: 1 no such table: oc_filecache\",\"level\":3,\"time\":1364313520}\r\n```\r\n\r\n#### browser log\r\n\r\nn/a","closed_by":{"login":"jancborchardt","id":925062,"avatar_url":"https://gravatar.com/avatar/2fd3f4d5d762955e5b603794a888fa97?d=https%3a%2f%2fidenticons.github.com%2f84ec51f9ceed468217d4e13abf78da9c.png&r=x","gravatar_id":"2fd3f4d5d762955e5b603794a888fa97","url":"https://api.github.com/users/jancborchardt","html_url":"https://github.com/jancborchardt","followers_url":"https://api.github.com/users/jancborchardt/followers","following_url":"https://api.github.com/users/jancborchardt/following{/other_user}","gists_url":"https://api.github.com/users/jancborchardt/gists{/gist_id}","starred_url":"https://api.github.com/users/jancborchardt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jancborchardt/subscriptions","organizations_url":"https://api.github.com/users/jancborchardt/orgs","repos_url":"https://api.github.com/users/jancborchardt/repos","events_url":"https://api.github.com/users/jancborchardt/events{/privacy}","received_events_url":"https://api.github.com/users/jancborchardt/received_events","type":"user","site_admin":false}}