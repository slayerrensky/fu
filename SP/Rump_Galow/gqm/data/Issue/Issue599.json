{"url":"https://api.github.com/repos/owncloud/core/issues/599","labels_url":"https://api.github.com/repos/owncloud/core/issues/599/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/599/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/599/events","html_url":"https://github.com/owncloud/core/issues/599","id":8722747,"number":599,"title":"ical/osxcalendar displays only the first vevent of a public shared calendar.","user":{"login":"christianguillon","id":2900078,"avatar_url":"https://gravatar.com/avatar/93f6b88a406029a1dbdb62a75af68552?d=https%3a%2f%2fidenticons.github.com%2f3814eab39bf93ee24c0f097516013f94.png&r=x","gravatar_id":"93f6b88a406029a1dbdb62a75af68552","url":"https://api.github.com/users/christianguillon","html_url":"https://github.com/christianguillon","followers_url":"https://api.github.com/users/christianguillon/followers","following_url":"https://api.github.com/users/christianguillon/following{/other_user}","gists_url":"https://api.github.com/users/christianguillon/gists{/gist_id}","starred_url":"https://api.github.com/users/christianguillon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/christianguillon/subscriptions","organizations_url":"https://api.github.com/users/christianguillon/orgs","repos_url":"https://api.github.com/users/christianguillon/repos","events_url":"https://api.github.com/users/christianguillon/events{/privacy}","received_events_url":"https://api.github.com/users/christianguillon/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2012-11-27t14:51:49z","updated_at":"2012-11-27t16:07:14z","closed_at":"2012-11-27t16:07:14z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"wncloud **4.0.9** shares public calendar in ics format.\n\nassuming we share **a** calendar with **n** events then owncloud will outputs **n** calendars with only **1** event in each:\n```(...)\nbegin:vcalendar\nbegin:vevent\n(...)\nend:vevent\nend:vcalendar\n\nbegin:vcalendar\nbegin:vevent\n(... )\nend:vevent\nend:vcalendar\n(repeated n times)\n```\nbut ical/osxcalendar is waiting for 1 calendar with n events inside.\n```(...)\nbegin:vcalendar\n\nbegin:vevent\n(...)\nend:vevent\n\nbegin:vevent\n(...)\nend:vevent\n\nend:vcalendar\n```\ni solve this for my company. here is the patch for apps/calendar/share.php ( branch 4.0.9 )\n```php\n4,6c4\n< $calendar_preamble=\"\";\n< $nl = \"\\n\";\n<\n---\n> $nl = \"\\n\\r\";\n12d9\n<\n14,43c11\n<\n<               // normalize new line in unix format\n<               $calobject['calendardata'] = str_replace(array(\"\\r\\n\",\"\\r\\n\"),$nl,$calobject['calendardata']);\n<\n<               // split calendardata in simple lines\n<               $splittedcalobject = explode($nl,$calobject['calendardata']);\n<\n<               // if calendardata contains an event then grab begin:event (and end) line number\n<               $positionbeginvevent=array_search(\"begin:vevent\",$splittedcalobject);\n<               $positionendvevent=array_search(\"end:vevent\",$splittedcalobject);\n<\n<               // if no begin or end event found, probably an empty calobject so we ignore.\n<               if (!$positionbeginvevent || !$positionendvevent)\n<                       continue;\n<\n<\n<               // will run only one time\n<               if ($calendar_preamble==\"\") {\n<                       // grab all lines before the begin statement\n<                       $preamble = array_slice($splittedcalobject ,0,$positionbeginvevent);\n<                       $calendar_preamble=implode($nl,$preamble).$nl;\n<\n<                       // ical/osxcalendar goodies : name & color\n<                       $calendar_preamble.=\"x-wr-calname:\".$calendar['displayname'].$nl;\n<                       $calendar_preamble.=\"x-apple-calendar-color:\".$calendar['calendarcolor'].$nl;\n<                       print $calendar_preamble.$nl;\n<               }\n<\n<               $event = array_slice($splittedcalobject ,$positionbeginvevent,$positionendvevent-$positionbeginvevent+1);\n<               print(implode($nl,$event).$nl.$nl);\n<               #echo $calobject['calendardata'] . $nl;\n---\n>               echo $calobject['calendardata'] . $nl;\n45,46d12\n<       if ($calendar_preamble!=\"\")\n<               print \"end:vcalendar\".$nl;\n```\n\nhope it will helps someone somewhere.","closed_by":{"login":"georgehrke","id":1250540,"avatar_url":"https://gravatar.com/avatar/6cfab50556db1530130dfd5d0398b069?d=https%3a%2f%2fidenticons.github.com%2fd32c0eeb36fb0c7401756c23e51e50fb.png&r=x","gravatar_id":"6cfab50556db1530130dfd5d0398b069","url":"https://api.github.com/users/georgehrke","html_url":"https://github.com/georgehrke","followers_url":"https://api.github.com/users/georgehrke/followers","following_url":"https://api.github.com/users/georgehrke/following{/other_user}","gists_url":"https://api.github.com/users/georgehrke/gists{/gist_id}","starred_url":"https://api.github.com/users/georgehrke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/georgehrke/subscriptions","organizations_url":"https://api.github.com/users/georgehrke/orgs","repos_url":"https://api.github.com/users/georgehrke/repos","events_url":"https://api.github.com/users/georgehrke/events{/privacy}","received_events_url":"https://api.github.com/users/georgehrke/received_events","type":"user","site_admin":false}}