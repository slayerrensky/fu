{"url":"https://api.github.com/repos/owncloud/core/issues/6484","labels_url":"https://api.github.com/repos/owncloud/core/issues/6484/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/6484/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/6484/events","html_url":"https://github.com/owncloud/core/issues/6484","id":24485936,"number":6484,"title":"upgrade 5.0.13 -> 5.0.14: failed to upgrade \"search_lucene\"","user":{"login":"wunderlich","id":4471366,"avatar_url":"https://gravatar.com/avatar/f66c3c97b597cc606b306ed2455ff987?d=https%3a%2f%2fidenticons.github.com%2f01cccd36fde7f2b4066512533cca8bc2.png&r=x","gravatar_id":"f66c3c97b597cc606b306ed2455ff987","url":"https://api.github.com/users/wunderlich","html_url":"https://github.com/wunderlich","followers_url":"https://api.github.com/users/wunderlich/followers","following_url":"https://api.github.com/users/wunderlich/following{/other_user}","gists_url":"https://api.github.com/users/wunderlich/gists{/gist_id}","starred_url":"https://api.github.com/users/wunderlich/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wunderlich/subscriptions","organizations_url":"https://api.github.com/users/wunderlich/orgs","repos_url":"https://api.github.com/users/wunderlich/repos","events_url":"https://api.github.com/users/wunderlich/events{/privacy}","received_events_url":"https://api.github.com/users/wunderlich/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":5,"created_at":"2013-12-18t12:08:48z","updated_at":"2013-12-18t12:27:06z","closed_at":"2013-12-18t12:17:07z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\noc should be upgraded to 5.0.14 and work normal.\r\n\r\n### actual behaviour\r\ni just added the new repository for oc 4 in my owncloud.list (up-to-date ubuntu 12.04-(v)server) and did `apt-get update` and `apt-get upgrade`. after rebooting the server and accessing oc with firefox, the upgrade message appeared. after a while, i only got the 'maintaince mode on'-message. i set `'maintenance' => false` at `config.php`, but now i get the following message:\r\n\r\n```\r\nfailed to upgrade \"search_lucene\". \r\nexception=\"failed to update database structure \r\n(mdb2 error: constraint violation, _doquery: \r\n[error message: could not execute statement] \r\n[last executed query: \r\nalter table `oc_lucene_status` add primary key (`fileid`)] \r\n[native code: 1062] \r\n[native message: duplicate entry '3' for key 'primary'] )\"\r\n```\r\n\r\n### server configuration\r\noperating system: ubuntu 12.04\r\n\r\nweb server: apache 2.2.22\r\n\r\ndatabase: mysql\r\n\r\nphp version: 5.3.10\r\n\r\nowncloud version: was 5.0.13\r\n\r\nupdated from an older owncloud or fresh install: updated from 5.0.13 to 5.0.13\r\n\r\nlist of activated app: can't access anymore. but only were default apps plus news-app.\r\n\r\nthe content of config/config.php:\r\n\r\n```php\r\n$config = array (\r\n  'instanceid' => 'xxxx',\r\n  'passwordsalt' => 'xxxx',\r\n  'datadirectory' => 'path-to-data',\r\n  'dbtype' => 'mysql',\r\n  'version' => '5.0.27',\r\n  'dbname' => 'owncloud',\r\n  'dbhost' => 'localhost',\r\n  'dbtableprefix' => 'oc_',\r\n  'dbuser' => 'username',\r\n  'dbpassword' => 'password',\r\n  'installed' => true,\r\n  'forcessl' => true,\r\n  'mail_smtpmode' => 'smtp',\r\n  'mail_smtphost' => 'host',\r\n  'mail_smtpport' => 587,\r\n  'mail_smtpsecure' => 'tls',\r\n  'mail_smtpauth' => true,\r\n  'mail_smtpauthtype' => 'login',\r\n  'mail_smtpname' => 'user',\r\n  'mail_smtppassword' => 'password',\r\n  'theme' => '',\r\n  'maintenance' => false,\r\n  'loglevel' => '3',\r\n);\r\n```\r\n\r\n### client configuration\r\nfirefox 25.0.1\r\n\r\noperating system: linux mint 15 kde\r\n\r\n### logs\r\n#### web server error log\r\nnothing new since upgrade here.\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not e\r\nxecute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native mes\r\nsage: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:23:02+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not e\r\nxecute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native mes\r\nsage: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:34:34+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not e\r\nxecute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native mes\r\nsage: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:35:00+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not e\r\nxecute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native message: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:35:03+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not execute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native message: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:35:03+00:00\"}\r\n{\"app\":\"core\",\"message\":\"app \\\"\\\" (files_imageviewer) can't be used because it is not compatible with this version of owncloud\",\"level\":3,\"time\":\"2013-12-18t11:35:04+00:00\"}\r\n{\"app\":\"core\",\"message\":\"can't remove app files_imageviewer. it is not installed.\",\"level\":3,\"time\":\"2013-12-18t11:35:04+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not execute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native message: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:35:04+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not execute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native message: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:36:02+00:00\"}\r\n{\"app\":\"core\",\"message\":\"failed to update database structure (mdb2 error: constraint violation, _doquery: [error message: could not execute statement]\\n[last executed query: alter table `oc_lucene_status` add primary key (`fileid`)]\\n[native code: 1062]\\n[native message: duplicate entry '3' for key 'primary']\\n)\",\"level\":4,\"time\":\"2013-12-18t11:37:02+00:00\"}\r\n... (repeating the last message serveral times)\r\n```\r\n\r\n\r\n","closed_by":{"login":"deepdiver1975","id":1005065,"avatar_url":"https://gravatar.com/avatar/bdba071ed68da9ce8edae53c364902ef?d=https%3a%2f%2fidenticons.github.com%2f67e101ad9531b7d25697b76e503e062e.png&r=x","gravatar_id":"bdba071ed68da9ce8edae53c364902ef","url":"https://api.github.com/users/deepdiver1975","html_url":"https://github.com/deepdiver1975","followers_url":"https://api.github.com/users/deepdiver1975/followers","following_url":"https://api.github.com/users/deepdiver1975/following{/other_user}","gists_url":"https://api.github.com/users/deepdiver1975/gists{/gist_id}","starred_url":"https://api.github.com/users/deepdiver1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepdiver1975/subscriptions","organizations_url":"https://api.github.com/users/deepdiver1975/orgs","repos_url":"https://api.github.com/users/deepdiver1975/repos","events_url":"https://api.github.com/users/deepdiver1975/events{/privacy}","received_events_url":"https://api.github.com/users/deepdiver1975/received_events","type":"user","site_admin":false}}