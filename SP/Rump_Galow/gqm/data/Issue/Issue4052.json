{"url":"https://api.github.com/repos/owncloud/core/issues/4052","labels_url":"https://api.github.com/repos/owncloud/core/issues/4052/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/4052/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/4052/events","html_url":"https://github.com/owncloud/core/issues/4052","id":16715563,"number":4052,"title":"webdav working check causes gateway timeout in admin-interface","user":{"login":"kondou-ger","id":1410802,"avatar_url":"https://gravatar.com/avatar/917dab919ae812f8252b2f501c514b19?d=https%3a%2f%2fidenticons.github.com%2fd07869ed62cb1b7f88b731956ab913ee.png&r=x","gravatar_id":"917dab919ae812f8252b2f501c514b19","url":"https://api.github.com/users/kondou-ger","html_url":"https://github.com/kondou-ger","followers_url":"https://api.github.com/users/kondou-ger/followers","following_url":"https://api.github.com/users/kondou-ger/following{/other_user}","gists_url":"https://api.github.com/users/kondou-ger/gists{/gist_id}","starred_url":"https://api.github.com/users/kondou-ger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kondou-ger/subscriptions","organizations_url":"https://api.github.com/users/kondou-ger/orgs","repos_url":"https://api.github.com/users/kondou-ger/repos","events_url":"https://api.github.com/users/kondou-ger/events{/privacy}","received_events_url":"https://api.github.com/users/kondou-ger/received_events","type":"user","site_admin":false},"labels":[{"url":"https://api.github.com/repos/owncloud/core/labels/settings%3aadmin","name":"settings:admin","color":"02d7e1"}],"state":"closed","assignee":null,"milestone":null,"comments":1,"created_at":"2013-07-13t14:23:57z","updated_at":"2013-10-16t19:33:27z","closed_at":"2013-07-14t05:59:17z","pull_request":{"html_url":null,"diff_url":null,"patch_url":null},"body":"### expected behaviour\r\nadmin interface should load.\r\n\r\n### actual behaviour\r\nafter waiting a while i get a 504, gateway timeout.\r\n\r\n### steps to reproduce\r\n1. go to admin-interface.\r\n2. wait a minute (nginx's default fcgi read timeout).\r\n3. 504\r\n\r\n### server configuration\r\noperating system:\r\nopensuse 12.3\r\nweb server: \r\nnginx 1.5.2\r\ndatabase:\r\nsqlite 3.7.14.1\r\nphp version:\r\n5.5.0\r\nowncloud version:\r\n5.0.8, doesn't happen in master\r\n### client configuration\r\nbrowser:\r\nany (tested with firefox and chromium)\r\noperating system:\r\nany (tested with opensuse 12.3)\r\n### logs\r\n#### web server error log\r\n```\r\n188.109.174.55 - - [13/jul/2013:15:54:58 +0200] \"get /index.php/settings/admin http/1.1\" 504 176 \"https://cloud/index.php/apps/files\" \"mozilla/5.0 (x11; linux x86_64; rv:22.0) gecko/20100101 firefox/22.0\"\r\n2001:41d0:2:c1bc::dead - - [13/jul/2013:15:54:58 +0200] \"propfind /remote.php/webdav/ http/1.1\" 504 176 \"-\" \"-\"\r\n188.109.174.55 - - [13/jul/2013:15:55:12 +0200] \"get /favicon.ico http/1.1\" 499 0 \"-\" \"mozilla/5.0 (x11; linux x86_64; rv:22.0) gecko/20100101 firefox/22.0\"\r\n188.109.174.55 - - [13/jul/2013:15:55:12 +0200] \"get /favicon.ico http/1.1\" 499 0 \"-\" \"mozilla/5.0 (x11; linux x86_64; rv:22.0) gecko/20100101 firefox/22.0\"\r\n188.109.174.55 - - [13/jul/2013:15:55:53 +0200] \"get /index.php/settings/admin http/1.1\" 504 578 \"https://cloud/index.php/settings/apps?installed\" \"mozilla/5.0 (x11; linux x86_64) applewebkit/537.36 (khtml, like gecko) chrome/30.0.1553.0 safari/537.36 suse/30.0.1553.0\"\r\n2001:41d0:2:c1bc::dead - - [13/jul/2013:15:56:00 +0200] \"propfind /remote.php/webdav/ http/1.1\" 504 176 \"-\" \"-\"\r\n```\r\n\r\n#### owncloud log (data/owncloud.log)\r\n```\r\n3rdparty\\/sabre\\/dav\\/client.php:440\\nstack trace:\\n#0 \\/home\\/http\\/owncloud\\/3rdparty\\/sabre\\/dav\\/client.php(179): sabre_dav_client->request('propfind', '', '<?xml version=\\\"...', array)\\n#1 \\/home\\/http\\/owncloud\\/lib\\/util.php(608): sabre_dav_client->propfind('', array)\\n#2 \\/home\\/http\\/owncloud\\/settings\\/admin.php(34): oc_util::iswebdavworking()\\n#3 \\/home\\/http\\/owncloud\\/lib\\/route.php(113) : runtime-created function(1): require_once('\\/home\\/http\\/ownc...')\\n#4 [internal function]: __lambda_func(array)\\n#5 \\/home\\/http\\/owncloud\\/lib\\/router.php(127): call_user_func('?lambda_1078', array)\\n#6 \\/home\\/http\\/owncloud\\/lib\\/base.php(617): oc_router->match('\\/settings\\/admin')\\n#7 \\/home\\/http\\/owncloud\\/index.php(28): oc::handlerequest()\\n#8 {main}\",\"level\":2,\"time\":1373723698}\r\n{\"app\":\"core\",\"message\":\"iswebdavworking: no - reason: exception 'sabre_dav_exception' with message 'http error response. (errorcode 504)' in \\/home\\/http\\/owncloud\\/3rdparty\\/sabre\\/dav\\/client.php:440\\nstack trace:\\n#0 \\/home\\/http\\/owncloud\\/3rdparty\\/sabre\\/dav\\/client.php(179): sabre_dav_client->request('propfind', '', '<?xml version=\\\"...', array)\\n#1 \\/home\\/http\\/owncloud\\/lib\\/util.php(608): sabre_dav_client->propfind('', array)\\n#2 \\/home\\/http\\/owncloud\\/settings\\/admin.php(34): oc_util::iswebdavworking()\\n#3 \\/home\\/http\\/owncloud\\/lib\\/route.php(113) : runtime-created function(1): require_once('\\/home\\/http\\/ownc...')\\n#4 [internal function]: __lambda_func(array)\\n#5 \\/home\\/http\\/owncloud\\/lib\\/router.php(127): call_user_func('?lambda_1121', array)\\n#6 \\/home\\/http\\/owncloud\\/lib\\/base.php(617): oc_router->match('\\/settings\\/admin')\\n#7 \\/home\\/http\\/owncloud\\/index.php(28): oc::handlerequest()\\n#8 {main}\",\"level\":2,\"time\":1373723760}\r\n```\r\n\r\n#### browser log\r\nnothing\r\n\r\n### more info\r\n\r\nincreasing the timeout to 10 minutes, shows 504 after 10 minutes.\r\n\r\nnot sure whether this happens in master too â€¦ sometimes it does, sometimes it doesn't.\r\n\r\ntrying 3rdparty master didn't fix this either.\r\n\r\nas a temporary workaround i commented\r\nmaster: https://github.com/owncloud/core/blob/master/lib/util.php#l628\r\nstable5: https://github.com/owncloud/core/blob/stable5/lib/util.php#l608\r\nout. this obviously doesn't fix it, but it's a hint, to what's going wrong.\r\n\r\n@deepdiver1975 @lukasreschke ","closed_by":{"login":"kondou-ger","id":1410802,"avatar_url":"https://gravatar.com/avatar/917dab919ae812f8252b2f501c514b19?d=https%3a%2f%2fidenticons.github.com%2fd07869ed62cb1b7f88b731956ab913ee.png&r=x","gravatar_id":"917dab919ae812f8252b2f501c514b19","url":"https://api.github.com/users/kondou-ger","html_url":"https://github.com/kondou-ger","followers_url":"https://api.github.com/users/kondou-ger/followers","following_url":"https://api.github.com/users/kondou-ger/following{/other_user}","gists_url":"https://api.github.com/users/kondou-ger/gists{/gist_id}","starred_url":"https://api.github.com/users/kondou-ger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kondou-ger/subscriptions","organizations_url":"https://api.github.com/users/kondou-ger/orgs","repos_url":"https://api.github.com/users/kondou-ger/repos","events_url":"https://api.github.com/users/kondou-ger/events{/privacy}","received_events_url":"https://api.github.com/users/kondou-ger/received_events","type":"user","site_admin":false}}