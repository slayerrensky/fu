{"url":"https://api.github.com/repos/owncloud/core/issues/3865","labels_url":"https://api.github.com/repos/owncloud/core/issues/3865/labels{/name}","comments_url":"https://api.github.com/repos/owncloud/core/issues/3865/comments","events_url":"https://api.github.com/repos/owncloud/core/issues/3865/events","html_url":"https://github.com/owncloud/core/pull/3865","id":16047800,"number":3865,"title":"fix sharing test for oracle","user":{"login":"butonic","id":956847,"avatar_url":"https://gravatar.com/avatar/9760c134cabf66e10dbba06d7525f5c7?d=https%3a%2f%2fidenticons.github.com%2f92925ec1ad893739ed57986f18e2f060.png&r=x","gravatar_id":"9760c134cabf66e10dbba06d7525f5c7","url":"https://api.github.com/users/butonic","html_url":"https://github.com/butonic","followers_url":"https://api.github.com/users/butonic/followers","following_url":"https://api.github.com/users/butonic/following{/other_user}","gists_url":"https://api.github.com/users/butonic/gists{/gist_id}","starred_url":"https://api.github.com/users/butonic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/butonic/subscriptions","organizations_url":"https://api.github.com/users/butonic/orgs","repos_url":"https://api.github.com/users/butonic/repos","events_url":"https://api.github.com/users/butonic/events{/privacy}","received_events_url":"https://api.github.com/users/butonic/received_events","type":"user","site_admin":false},"labels":[],"state":"closed","assignee":null,"milestone":null,"comments":8,"created_at":"2013-06-26t18:16:21z","updated_at":"2013-06-28t13:19:03z","closed_at":"2013-06-28t13:18:57z","pull_request":{"html_url":"https://github.com/owncloud/core/pull/3865","diff_url":"https://github.com/owncloud/core/pull/3865.diff","patch_url":"https://github.com/owncloud/core/pull/3865.patch"},"body":"@mtgap sharing tests are failing on oracle. i tried to debug it and got this far. the select statements are a mess and manually reassembling the result set is even messier. i have no idea if i should just skip the row when `$items[$id]` is not set (first commit) or if the results are just not ordered correctly for this to work. i hope you have a better understanding of what the lines do and can help me out.\r\n\r\nthe second commit introduces an ugly fix that corrects numeric column types if they are present (fixes another test).\r\n\r\nwe need sharing to work for oc5 ee on oracle and i will not test all sharing corner cases manually, because i simply don't know them. i have to rely on the testsuite. unfortunately, the error messages are not really helping me to identify and fix sharing problems on oracle.\r\n\r\n@icewind1991 @deepdiver1975 maybe this is a problem with oc_db::insertid() but i wrote a quick test that passes just fine:\r\n```php\r\n\tpublic function testlastinsertid() {\r\n\t\t$query = oc_db::prepare('insert into `*prefix*'.$this->table2.'` (`fullname`,`uri`) values (?,?)');\r\n\t\t$result = oc_db::executeaudited($query, array('insertid 1','uri_1'));\r\n\t\t$id1 = oc_db::insertid('*prefix*'.$this->table2);\r\n\t\t// we don't know the id we should expect, so insert another row\r\n\t\t$query = oc_db::prepare('insert into `*prefix*'.$this->table2.'` (`fullname`,`uri`) values (?,?)');\r\n\t\t$result = oc_db::executeaudited($query, array('insertid 2','uri_2'));\r\n\t\t$id2 = oc_db::insertid('*prefix*'.$this->table2);\r\n\t\t// now we can check if the two ids are in correct order\r\n\t\t$this->assertequals($id1+1, $id2);\r\n\t}\r\n```","closed_by":{"login":"bartv2","id":2227877,"avatar_url":"https://gravatar.com/avatar/c2d86a0a66a4be2c904e24034e842f44?d=https%3a%2f%2fidenticons.github.com%2f05e8b1362feb118a386dfd282b20fb84.png&r=x","gravatar_id":"c2d86a0a66a4be2c904e24034e842f44","url":"https://api.github.com/users/bartv2","html_url":"https://github.com/bartv2","followers_url":"https://api.github.com/users/bartv2/followers","following_url":"https://api.github.com/users/bartv2/following{/other_user}","gists_url":"https://api.github.com/users/bartv2/gists{/gist_id}","starred_url":"https://api.github.com/users/bartv2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bartv2/subscriptions","organizations_url":"https://api.github.com/users/bartv2/orgs","repos_url":"https://api.github.com/users/bartv2/repos","events_url":"https://api.github.com/users/bartv2/events{/privacy}","received_events_url":"https://api.github.com/users/bartv2/received_events","type":"user","site_admin":false}}